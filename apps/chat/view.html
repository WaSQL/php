<view:default>
<div id="chat_msgs" style="width:100%;min-height:200px;">
	<?=renderView('messages',$messages,'messages');?>
</div>
<form method="post" name="app_chat_form" action="/t/1<?=$chat['chat_url'];?>/msg" onsubmit="return ajaxSubmitForm(this,'chat_msgs');">
	<div style="display:flex;">
		<?=chatToField();?>
		<?=chatInputField();?>
		<button type="submit" class="chat_button" style="flex-grow:1;"><span class="icon-arrow-right"></span></button>
	</div>
	<div style="display:none">
		<input type="hidden" name="setprocessing" value="0" />
		<textarea name="chat_b64"><?=encodeBase64(json_encode($chat));?></textarea>
	</div>
</form>
</view:default>

<view:messages>
<view:message>
	<div style="display:flex;align-items: center;">
		<span class="<?=$message['msg_icon'];?>" style="margin-right:5px;color:<?=$message['msg_from_color'];?>E6;"></span>
		<span style="margin-right:5px;color:<?=$message['msg_from_color'];?>E6;" title="Posted on <?=$message['_cdate'];?>"><?=$message['msg_from_name'];?>: </span>
		<div class="chat_msg"><?=$message['msg'];?></div>
	</div>
</view:message>
<?=renderEach('message',$messages,'message');?>
<?=buildOnLoad("document.app_chat_form.msg.value='';document.app_chat_form.msg.focus();");?>
</view:messages>

<view:login>
<?=userLoginForm(array('-action'=>$chat['chat_url']));?>
</view:login>
