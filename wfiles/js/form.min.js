function setInputFileName(fld){let names=new Array();for(let i=0;i<fld.files.length;i++){names.push(fld.files[i].name)}
if(names.length>1){fileName=names.length+' files: '+implode(', ',names)}else{fileName=implode(', ',names)}
let label=document.querySelector('label[for='+fld.id+']');if(fileName){setText(label,'<span class="icon-upload w_big w_success"></span> '+fileName);label.className='btn btn-default'}else{setText(label,'<span class="icon-upload w_big w_danger"></span> '+fld.getAttribute('data-text'));label.className='btn btn-default'}}
function attachDropFiles(fld){var filesSelected=fld.files;if(filesSelected.length===0){return}
var parentForm=getParentForm(fld);if(undefined==parentForm){return}
var pname=parentForm.getAttribute('name');if(undefined==pname){pname=parentForm.getAttribute('id')}
if(undefined==pname){pname='noname'}
var allow_multiple=!1;if(undefined!=fld.getAttribute('multiple')){allow_multiple=!0}
for(var i=0;i<filesSelected.length;i++){var fileToLoad=filesSelected[i];var fileReader=new FileReader();if(allow_multiple){fileReader.cname=fld.name+'_base64[]'}else{fileReader.cname=fld.name+'_base64'}
fileReader.cid=pname+'_'+fld.name+'_base64';fileReader.allow_multiple=allow_multiple;fileReader.fname=fileToLoad.name;fileReader.fid=pname+'_'+fld.name+'_base64_filename';fileReader.onload=function(fileLoadedEvent){if(this.allow_multiple){var txtarea=document.createElement("textarea");txtarea.name=this.cname;txtarea.id=this.cid;txtarea.setAttribute('data-filename',this.fname);txtarea.innerHTML='filename:'+this.fname+';'+fileLoadedEvent.target.result;txtarea.style.display='none';parentForm.appendChild(txtarea)}else{var txtobj=getObject(this.cid);if(undefined==txtobj){txtarea=document.createElement("textarea");txtarea.name=this.cname;txtarea.id=this.cid;txtarea.style.display='none';parentForm.appendChild(txtarea)}
txtarea.setAttribute('data-filename',this.fname);txtarea.innerHTML='filename:'+this.fname+';'+fileLoadedEvent.target.result}};fileReader.readAsDataURL(fileToLoad)}}
function formSetFrequency(fid,v){let container=document.querySelector('#'+fid+'_container');if(undefined==container){return!1}
let minutes=container.querySelectorAll('#frequency_minute');let hours=container.querySelectorAll('#frequency_hour');let months=container.querySelectorAll('#frequency_month');let days=container.querySelectorAll('#frequency_day');let field=container.querySelector('#'+fid);let nv={minute:[],hour:[],month:[],day:[]};if(undefined!=v){if(typeof(v)=='number'){switch(v){case 1:v={minute:[-1],hour:[-1],month:[-1],day:[-1]};break;case 5:v={minute:[0,5,10,15,20,25,30,35,40,45,50,55],hour:[-1],month:[-1],day:[-1]};break;case 10:v={minute:[0,10,20,30,40,50],hour:[-1],month:[-1],day:[-1]};break;case 15:v={minute:[0,15,30,45],hour:[-1],month:[-1],day:[-1]};break;case 20:v={minute:[0,20,40],hour:[-1],month:[-1],day:[-1]};break;case 30:v={minute:[0,30],hour:[-1],month:[-1],day:[-1]};break;case 60:v={minute:[0],hour:[-1],month:[-1],day:[-1]};break;case 1440:v={minute:[0],hour:[0],month:[-1],day:[-1]};break;case 720:v={minute:[0],hour:[0,12],month:[-1],day:[-1]};break;case 10080:v={minute:[0],hour:[0],month:[-1],day:[1,8,15,22]};break;case 43829:v={minute:[0],hour:[0],month:[-1],day:[1]};break}
console.log('number');console.log(v)}
if(typeof(v)=='string'){if(v.length>0){v=JSON.parse(v)}else{v={minute:[],hour:[],month:[],day:[]}}}
if(v.reset){for(let y=0;y<v.reset.length;y++){switch(v.reset[y]){case 'minute':for(let x=0;x<minutes.length;x++){minutes[x].checked=!1}
let mclear=container.querySelector('span[title="clear minutes"]');if(undefined!=mclear){mclear.style.color='#6c757d'}
break;case 'hour':for(let x=0;x<hours.length;x++){hours[x].checked=!1}
let hclear=container.querySelector('span[title="clear hours"]');if(undefined!=hclear){hclear.style.color='#6c757d'}
break;case 'day':for(let x=0;x<days.length;x++){days[x].checked=!1}
let dclear=container.querySelector('span[title="clear days"]');if(undefined!=dclear){dclear.style.color='#6c757d'}
break;case 'month':for(let x=0;x<months.length;x++){months[x].checked=!1}
let moclear=container.querySelector('span[title="clear months"]');if(undefined!=moclear){moclear.style.color='#6c757d'}
break}}
formSetFrequency(field.id);return!1}
for(let x=0;x<minutes.length;x++){let hval=parseInt(minutes[x].value);if(undefined!=v.minute&&undefined!=v.minute[0]&&v.minute[0]==-1){minutes[x].checked=!0;nv.minute=[-1]}else if(in_array(hval,v.minute)){minutes[x].checked=!0;nv.minute.push(hval)}else{minutes[x].checked=!1}}
for(let x=0;x<hours.length;x++){let hval=parseInt(hours[x].value);if(undefined!=v.hour&&undefined!=v.hour[0]&&v.hour[0]==-1){hours[x].checked=!0;nv.hour=[-1]}else if(in_array(hval,v.hour)){hours[x].checked=!0;nv.hour.push(hval)}else{hours[x].checked=!1}}
for(let x=0;x<months.length;x++){let hval=parseInt(months[x].value);if(undefined!=v.month&&undefined!=v.month[0]&&v.month[0]==-1){months[x].checked=!0;nv.month=[-1]}else if(in_array(hval,v.month)){months[x].checked=!0;nv.month.push(hval)}else{months[x].checked=!1}}
for(let x=0;x<days.length;x++){let hval=parseInt(days[x].value);if(undefined!=v.day&&undefined!=v.day[0]&&v.day[0]==-1){days[x].checked=!0;nv.day=[-1]}else if(in_array(hval,v.day)){days[x].checked=!0;nv.day.push(hval)}else{days[x].checked=!1}}
setText(field,JSON.stringify(nv))}else{for(let x=0;x<minutes.length;x++){let hval=parseInt(minutes[x].value);if(minutes[x].checked){nv.minute.push(hval)}}
if(minutes.length==nv.minute.length){nv.minute=[-1]}else if(nv.minute.length==0){nv.minute=[0]}
for(let x=0;x<hours.length;x++){let hval=parseInt(hours[x].value);if(hours[x].checked){nv.hour.push(hval)}}
if(hours.length==nv.hour.length){nv.hour=[-1]}else if(nv.hour.length==0){nv.hour=[0]}
for(let x=0;x<months.length;x++){let hval=parseInt(months[x].value);if(months[x].checked){nv.month.push(hval)}}
if(months.length==nv.month.length){nv.month=[-1]}else if(nv.month.length==0){nv.month=[-1]}
for(let x=0;x<days.length;x++){let hval=parseInt(days[x].value);if(days[x].checked){nv.day.push(hval)}}
if(days.length==nv.day.length){nv.day=[-1]}else if(nv.day.length==0){nv.day=[1]}
setText(field,JSON.stringify(nv));formSetFrequency(field.id,field.value)}
if(nv.minute.length>0){container.querySelector('span[title="clear minutes"]').style.color='#c51017'}
if(nv.hour.length>0){container.querySelector('span[title="clear hours"]').style.color='#c51017'}
if(nv.day.length>0){container.querySelector('span[title="clear days"]').style.color='#c51017'}
if(nv.month.length>0){container.querySelector('span[title="clear months"]').style.color='#c51017'}}
function formSetFrequencyDisplay(fid,s){let ev=this.event||window.event;ev.stopPropagation();let wizard=document.querySelector('#'+fid+'_wizard');if(undefined==wizard){return!1}
if(s){wizard.style.display='block';commonOpenClose(wizard,'display','none')}else{wizard.style.display='none'}
return!1}
function autoFill(theForm,answerid,ro){if(undefined==ro){ro=0}
var answers=new Array();var slist=GetElementsByAttribute('div','id',answerid);for(i=0;i<slist.length;i++){var en=slist[i].getAttribute('name');if(en!='null'){var val=getText(slist[i]);answers[en]=val}}
for(var i=0;i<theForm.length;i++){var etype=theForm[i].type;var ename=theForm[i].getAttribute('name');var aname=ename.replace(/\[/,"");aname=aname.replace(/\]/,"");var answer=answers[aname];if(ro){theForm[i].style.backgroundColor='#FFFFFF';theForm[i].style.color='#000000';theForm[i].style.border='1px solid #7f9db9';if(etype=='textarea'){theForm[i].readOnly=!0}else if(etype=='text'){theForm[i].readOnly=!0}else{theForm[i].disabled=!0}}
if(undefined!=answers[aname]){if(etype=='checkbox'){var vals=answers[aname].split(':');var evalue=theForm[i].getAttribute('value');for(s=0;s<vals.length;s++){if(evalue==vals[s]){theForm[i].checked=!0}}}else{theForm[i].value=answers[aname]}}}}
function ajaxAddEditForm(table,id,flds,userparams){var params='_action=editform&-table='+table;var xtitle='Add New Record';if(undefined!=id&&id>0){params+='&_id='+id;xtitle='Edit Record'}
if(undefined!=flds){params+='&-fields='+flds}
if(undefined!=userparams){params+='&'+userparams}
ajaxPopup('/php/index.php',params,{id:'centerpop'});return!1}
function ajaxEditField(table,id,fld,params){if(undefined==params){params={}}
params._action='EDITFIELD';params.table=table;params.id=id;params.field=fld;if(undefined==params.div){params.div='centerpop'}
return ajaxGet('/php/index.php',params.div,params)}
function autoGrow(box,maxheight){if(undefined==maxheight){maxheight=400}
if(box.scrollHeight<maxheight&&box.scrollHeight>box.clientHeight&&!window.opera){box.style.height=box.scrollHeight+'px'}}
function initPikadayCalendar(field,params){field=getObject(field);let opts={field:field,position:'bottom right',format:'YYYY-MM-DD',toString(date,format){let day=date.getDate();let month=date.getMonth()+1;let year=date.getFullYear();if(day<10){day='0'+day}
if(month<10){month='0'+month}
return year+'-'+month+'-'+day},parse(dateString,format){const parts=dateString.split('/');const day=parseInt(parts[0],10);const month=parseInt(parts[1],10)-1;const year=parseInt(parts[2],10);return new Date(year,month,day)}};let attrs=getAllAttributes(field);if(undefined!=attrs['data-maxdate']){if(attrs['data-maxdate'].indexOf('-')!=-1){let n=parseInt(attrs['data-maxdate'])*-1;let d=new Date();d.setDate(d.getDate()-n);opts.maxDate=d}else{switch(attrs['data-maxdate'].toLowerCase()){case 'now':case 'today':opts.maxDate=new Date();break;default:opts.maxDate=new Date(attrs['data-maxdate']);break}}}
if(undefined!=attrs['data-mindate']){if(attrs['data-mindate'].indexOf('-')!=-1){let n=parseInt(attrs['data-mindate'])*-1;let d=new Date();d.setDate(d.getDate()-n);opts.minDate=d}else{switch(attrs['data-mindate'].toLowerCase()){case 'now':case 'today':opts.minDate=new Date();break;default:opts.minDate=new Date(attrs['data-mindate']);break}}}
if(undefined!=attrs['data-trigger']){let tobj=getObject(attrs['data-trigger']);if(undefined!=tobj){opts.trigger=tobj}}
if(undefined!=attrs['data-firstday']){opts.firstDay=parseInt(attrs['data-firstday'])}
if(undefined!=attrs['data-disableweekends']){opts.disableWeekends=!0}
if(undefined!=attrs['data-showalldays']){opts.showDaysInNextAndPreviousMonths=!0;opts.enableSelectionDaysInNextAndPreviousMonths=!0}
if(undefined!=attrs['data-numberofmonths']){opts.numberOfMonths=attrs['data-numberofmonths'];if(undefined!=attrs['data-maincalendar']){opts.mainCalendar=attrs['data-maincalendar']}}
if(undefined!=attrs['data-pickwholeweek']){opts.pickWholeWeek=!0}
if(undefined!=attrs['data-theme']){opts.theme=attrs['data-theme']}
if(undefined!=attrs['data-yearrange']){let r=attrs['data-yearrange'].split(/\,/);if(r.length==1){let n=parseInt(attrs['data-yearrange']);opts.yearRange=n}else{r[0]=parseInt(r[0]);r[1]=parseInt(r[1]);opts.yearRange=r}}
if(undefined!=attrs['data-debug']){console.log(opts)}
let p=new Pikaday(opts);let icon=getObject(field.id+'_icon');if(undefined!=icon){icon.p=p;icon.onclick=function(){this.p.show()}}}
function buildFormCalendar(fieldname,params){return buildFormDate(fieldname,params)}
function buildFormCheckAll(att,attval,params){var tagdiv=document.createElement("div");if(undefined==params){params={}}
if(undefined==params.id){params.id='c'+guid()}
var tag=document.createElement("input");tag.type='checkbox';tag.id=params.id;var onclick='';if(undefined!=params.onchange){onclick=params.onchange}else if(undefined!=params.onclick){onclick=params.onclick}
onclick="checkAllElements('"+att+"','"+attval+"',this.checked);"+onclick+";";tag.setAttribute('onclick',onclick);tagdiv.appendChild(tag);if(undefined==params.label){params.label='Check All'}
var taglabel=document.createElement("label");taglabel.setAttribute('for',tag.id);taglabel.innerHTML='&nbsp;'+params.label;tagdiv.appendChild(taglabel);if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tagdiv)}else{console.log(params['-parent']+' does not exist')}}
return tagdiv}
function buildFormCheckbox(fieldname,opts,params){if(undefined==fieldname||!fieldname.length){alert('buildFormCheckbox Error: no name');return undefined}
fieldname=fieldname.replace('/[\[\]]+$/','');if(undefined==params){params={}}
if(undefined==opts){alert('buildFormCheckbox Error: no opts');return undefined}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.group){params.group=params['-formname']+'_'+fieldname+'_group'}
if(undefined==params.width){params.width=4}
if(undefined==params['-values']){params['-values']={}}
if(undefined!=params.value){var vtype=typeof(params.value);if(vtype.toLowerCase()=='string'){var vals=params.value.split(':');for(v=0;v<vals.length;v++){params['-values'][vals[v]]=!0}}else{params['-values']=params.value}
params.value=''}
if(undefined!=params['-values']){var pvtype=typeof(params['-values']);if(pvtype.toLowerCase()=='string'){var pvals=params['-values'].split(':');params['-values']={};for(v=0;v<pvals.length;v++){params['-values'][pvals[v]]=!0}}}
var rowdiv=document.createElement("div");rowdiv.className='row';if(undefined!=params['-checkall']&&undefined==params['-radio']){var checkalldiv=buildFormCheckAll('data-group',params.group,{'-parent':rowdiv})}
var col_opts={};var x=0;var tval;var dval;for(tval in opts){if(undefined==col_opts[x]){col_opts[x]={}}
dval=opts[tval];col_opts[x][tval]=dval;x=x+1;if(x==params.width){x=0}}
var col_width=Math.floor(12/params.width);for(x=0;x<params.width;x++){var coldiv=document.createElement("div");coldiv.className='col-xs-'+col_width;for(tval in col_opts[x]){dval=col_opts[x][tval];var ctagdiv=document.createElement("div");var cid=params['-formname']+'_'+fieldname+'_'+tval;var ctag=document.createElement("input");if(undefined!=params['-radio']){ctag.type='radio';ctag.name=fieldname}else{ctag.type='checkbox';ctag.name=fieldname+'[]'}
ctag.value=tval;if(undefined!=params['-values'][tval]){ctag.checked=!0}
if(params.required){ctag.setAttribute('_required',params.required)}
ctag.id=cid;ctag.setAttribute('data-group',params.group);ctag.setAttribute('data-type','checkbox');ctagdiv.appendChild(ctag);var ctaglabel=document.createElement("label");ctaglabel.setAttribute('for',cid);ctaglabel.innerHTML='&nbsp;'+dval;ctagdiv.appendChild(ctaglabel);coldiv.appendChild(ctagdiv)}
rowdiv.appendChild(coldiv)}
if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(rowdiv)}else{console.log(params['-parent']+' does not exist')}}
return rowdiv}
function buildFormColor(fieldname,params){if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
var iconid=params.id+'_icon';params.width=115;var iconcolor='#c0c0c0';if(undefined!=params.value){iconcolor=params.value}
if(undefined==params.placeholder){params.placeholder='#HEXVAL'}
if(undefined==params.classname){params.classname='form-control'}
params.maxlength=7;var tagdiv=document.createElement("div");tagdiv.className="input-group";tagdiv.style.width=params.width+'px';var tag=document.createElement("input");tag.type='text';tag.maxlength=7;tag.className=params.classname;tag.style.fontSize='11px';tag.style.fontFamily='arial';tag.name=fieldname;tag.id=params.id;if(params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.value){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
tag.classname=params.classname;tag.placeholder=params.placeholder;tagdiv.appendChild(tag);var tagspan=document.createElement("span");tagspan.id=iconid;tagspan.setAttribute('onclick',"return colorSelector('"+params.id+"');");tagspan.className="icon-color-adjust w_bigger w_pointer input-group-addon";tagspan.style.color=iconcolor+';padding-left:3px !important;padding-right:6px !important;';tagspan.title='Color Selector';tagdiv.appendChild(tagspan);if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tagdiv)}else{console.log(params['-parent']+' does not exist')}}
return tagdiv}
function buildFormCombo(fieldname,opts,params){if(undefined==fieldname){alert('buildFormCombo requires fieldname');return undefined}
if(undefined==opts){alert('buildFormCombo requires opts');return undefined}
if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.classname){params.classname='form-control'}
var datalist_id=params.id+'_datalist';var tagdiv=document.createElement("div");var tag=document.createElement("input");tag.className=params.classname;if(params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.value){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
tag.name=fieldname;tag.id=params.id;tag.setAttribute('list',datalist_id);tagdiv.appendChild(tag);var taglist=document.createElement("datalist");taglist.id=datalist_id;for(var tval in opts){var coption=document.createElement("OPTION");coption.value=tval;coption.innerHTML=opts[tval];taglist.appendChild(coption)}
tagdiv.appendChild(taglist);if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tagdiv)}else{console.log(params['-parent']+' does not exist')}}
return tagdiv}
function buildFormDate(fieldname,params){if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.classname){params.classname='form-control'}
if(undefined==params['-control']){params['-control']='date'}
var spanclass='';switch(params['-control']){case 'date':if(undefined==params.title){params.title='Date Control'}
spanclass="icon-calendar w_pointer input-group-addon";params.width=155;if(undefined==params.placeholder){params.placeholder='YYYY-MM-DD'}
break;case 'datetime':if(undefined==params.title){params.title='Date and Time Control'}
spanclass="icon-calendar w_pointer input-group-addon";params.width=220;if(undefined==params.placeholder){params.placeholder='YYYY-MM-DD MH:MM:SS'}
break;case 'time':if(undefined==params.title){params.title='Time Control'}
spanclass="icon-clock w_pointer input-group-addon";params.width=115;if(undefined==params.placeholder){params.placeholder='MH:MM:SS'}
break;default:break}
var iconid=params.id+'_icon';var iconcolor='#c0c0c0';var tagdiv=document.createElement("div");tagdiv.className="input-group";tagdiv.style.width=params.width+'px';var tag=document.createElement("input");tag.type='text';tag.className=params.classname;tag.style.fontSize='12px';tag.style.fontFamily='arial';tag.name=fieldname;tag.id=params.id;if(params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.value&&params.value.length){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
tag.classname=params.classname;tag.setAttribute('data-type',params['-control']);tag.placeholder=params.placeholder;tagdiv.appendChild(tag);var tagspan=document.createElement("span");tagspan.id=iconid;tagspan.setAttribute('onclick',"return Calendar('"+params.id+"');");tagspan.className=spanclass;tagspan.style.color=iconcolor+';padding-left:3px !important;padding-right:6px !important;';tagspan.title=params.title;if(params['-control']=='datetime'){tagspan.innerHTML='<span class="icon-clock"></span>'}
tagdiv.appendChild(tagspan);if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tagdiv)}else{console.log(params['-parent']+' does not exist')}}
return tagdiv}
function buildFormDateTime(fieldname,params){if(undefined==params){params={}}
params['-control']='datetime';return buildFormDate(fieldname,params)}
function buildFormHidden(fieldname,params){if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
var tag=document.createElement("input");tag.type='hidden';tag.name=fieldname;if(undefined!=params.value){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
tag.id=params.id;if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tag)}else{console.log(params['-parent']+' does not exist')}}
return tag}
function buildFormPassword(fieldname,params){if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.classname){params.classname='form-control'}
var tag=document.createElement("input");tag.type='password';tag.name=fieldname;tag.value=params.value;if(params.required){tag.setAttribute('required',params.required)}
tag.id=params.id;tag.className=params.classname;if(undefined!=params.value){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tag)}else{console.log(params['-parent']+' does not exist')}}
return tag}
function buildFormRadio(fieldname,opts,params){if(undefined==params){params={}}
params['-radio']=!0;return buildFormCheckbox(fieldname,opts,params)}
function buildFormText(fieldname,params){if(undefined==fieldname){alert('buildFormText requires fieldname');return undefined}
if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.classname){params.classname='form-control'}
var tag=document.createElement("input");tag.className=params.classname;if(params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.value){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
tag.name=fieldname;tag.id=params.id;if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tag)}else{console.log(params['-parent']+' does not exist')}}
return tag}
function buildFormTextarea(fieldname,params){if(undefined==fieldname){alert('buildFormTextarea requires fieldname');return undefined}
if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.classname){params.classname='form-control'}
if(undefined==params.height){params.height=50}
if(undefined!=params.behavior){params['data-behavior']=params.behavior}
var tag=document.createElement("textarea");tag.className=params.classname;if(params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.value){tag.innerHTML=params.value}else{tag.innerHTML=''}
tag.name=fieldname;tag.id=params.id;tag.style.height=params.height+'px';if(undefined!=params['data-behavior']){switch(params['data-behavior'].toLowerCase()){case 'editor':case 'tinymce':case 'wysiwyg':case 'nicedit':tag.setAttribute('data-behavior','nicedit');break;default:tag.setAttribute('data-behavior',params['data-behavior']);break}}
if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tag)}else{console.log(params['-parent']+' does not exist')}}
return tag}
function buildFormTime(fieldname,params){if(undefined==params){params={}}
params['-control']='time';return buildFormDate(fieldname,params)}
function buildFormSelect(fieldname,opts,params){if(undefined==fieldname||!fieldname.length){alert('buildFormSelect Error: no name');return undefined}
fieldname=fieldname.replace('/[\[\]]+$/','');if(undefined==params){params={}}
if(undefined==opts){alert('buildFormSelect Error: no opts');return undefined}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.classname){params.classname='form-control'}
var tag=document.createElement("select");tag.className=params.classname;if(params.required){tag.setAttribute('required',params.required)}
tag.name=fieldname;tag.id=params.id;for(var tval in opts){var coption=document.createElement("OPTION");coption.value=tval;coption.innerHTML=opts[tval];if(undefined!=params.value&&tval==params.value){coption.setAttribute('selected',!0)}
tag.appendChild(coption)}
if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tag)}else{console.log(params['-parent']+' does not exist')}}
return tag}
function comboCompleteMatch(sText,arrValues){sText=sText.toLowerCase();for(var i=0;i<arrValues.length;i++){aval=arrValues[i].toLowerCase();if(aval.indexOf(sText)===0){return i}}
return-1}
function comboComplete(oTextbox,oEvent,vid){var comboSelectionText=getText(vid);var selectionLines=comboSelectionText.split("\n");var arrayValues=new Array();for(var i=0;i<selectionLines.length;i++){if(undefined==selectionLines[i]){continue}
var cline=trim(selectionLines[i]);if(cline.length===0){continue}
var matches=cline.match(/tval=\"(.+?)\"/ig);if(undefined==matches){continue}
for(m in matches){var cmatch=matches[m]+'';if(cmatch.indexOf('tval="')!=-1){var val=cmatch.replace('tval="','');val=val.replace(/\"$/,'');arrayValues.push(val)}}}
var code=parseInt(oEvent.keyCode);switch(code){case 38:if(undefined!=oTextbox.getAttribute('last_index')){var mi=parseInt(oTextbox.getAttribute('last_index'));if(mi>0){mi=mi-1;if(undefined!=arrayValues[mi]){oTextbox.value=arrayValues[mi].replace('&amp;','&');oTextbox.setAttribute('last_index',mi);textboxSelect(oTextbox,iLen,oTextbox.value.length);return!1}}}
break;case 40:if(undefined!=oTextbox.getAttribute('last_index')){var mi=parseInt(oTextbox.getAttribute('last_index'));if(mi<arrayValues.length){mi=mi+1;if(undefined!=arrayValues[mi]){oTextbox.value=arrayValues[mi].replace('&amp;','&');oTextbox.setAttribute('last_index',mi);textboxSelect(oTextbox,iLen,oTextbox.value.length);return!1;break}}}
break;case 37:case 39:case 33:case 34:case 36:case 35:case 13:case 9:case 27:case 16:case 17:case 18:case 20:case 8:case 46:return!0;break;default:textboxReplaceSelect(oTextbox,String.fromCharCode(isIE?oEvent.keyCode:oEvent.charCode));var iLen=oTextbox.value.length;var mi=comboCompleteMatch(oTextbox.value,arrayValues);if(mi>-1){oTextbox.value=arrayValues[mi].replace('&amp;','&');oTextbox.setAttribute('last_index',mi);textboxSelect(oTextbox,iLen,oTextbox.value.length)}
return!1}}
function formSetMultiSelectStatus(fld){var group=fld.getAttribute('data-group');var list=GetElementsByAttribute('input','data-group',group);var spans=GetElementsByAttribute('span','data-group',group);var vals=new Array();for(var i=0;i<list.length;i++){if(undefined==list[i].value){continue}
if(list[i].value==''){continue}
if(list[i].checked){vals.push(list[i].value)}}
var cname=vals.length?'icon-checkbox':'icon-checkbox-empty';for(var i=0;i<spans.length;i++){spans[i].className=cname}
if(fld.checked){fld.checked=!0}
return!0}
function fielddataChange(fld){var parentObj=getParentForm(fld);return!1}
function filemanagerEdit(id,formaction,param){var obj=getObject(id);if(undefined==obj){return}
var fname=obj.getAttribute('filename');var desc=getText(obj);var htm='';htm+='<div class="w_centerpop_title">File Manager File Edit</div>'+"\n";htm+='<div  style="padding:0 25px 0 25px;">'+"\n";htm+='	<form method="post" action="'+formaction+'" onSubmit="return submitForm(this);">'+"\n";htm+='		<div class="row">'+"\n";htm+='			<label for="file_name">Name</label><input type="text" id="file_name" name="file_name" value="'+fname+'" class="form-control">'+"\n";htm+='		</div>'+"\n";htm+='		<div class="row">'+"\n";htm+='			<label for="file_desc">Desc</label><textarea name="file_desc" class="form-control" onkeypress="autoGrow(this,200);">'+desc+'</textarea>'+"\n";htm+='		</div>'+"\n";htm+='		<div class="row text-right" style="margin-top:20px;"><button type="submit" class="btn btn-primary">Save Changes</button></div>'+"\n";if(param){htm+='<div style="display:none" id="params">'+"\n";for(var key in param){htm+='<textarea name="'+key+'">'+param[key]+'</textarea>'+"\n"}
htm+='</div>'+"\n"}
htm+='</form>'+"\n";htm+='</div>'+"\n";centerpopDiv(htm);return!1}
function formatPhone(phone){var newphone=phone;newphone=newphone.replace(/\(/g,'');newphone=newphone.replace(/\)/g,'');newphone=newphone.replace(/\-/g,'');newphone=newphone.replace(/[a-zA-z]/g,'');newphone=newphone.replace(/\s+/g,'')
var one=newphone.substr(0,3);var two=newphone.substr(3,3);var three=newphone.substr(6,4);newphone=one;if(two.length>0){newphone+='-'+two}
if(three.length>0){newphone+='-'+three}
return newphone}
function formatCalendar(str){var newstr=str;newstr=newstr.replace(/\(/g,'');newstr=newstr.replace(/\)/g,'');newstr=newstr.replace(/\-/g,'');newstr=newstr.replace(/[a-zA-z]/g,'');newstr=newstr.replace(/\s+/g,'')
var one=newstr.substr(0,2);var two=newstr.substr(2,2);var three=newstr.substr(4,4);newstr=one;if(two.length>0){newstr+='-'+two}
if(three.length>0){newstr+='-'+three}
return newstr}
function getElementForm(what){while(what&&undefined!=what.nodeName&&what.nodeName!='FORM'){what=what.parentNode}
return what}
function dynamicSelect(fld,v,p){if(undefined==fld){return!1}
if(undefined==v){v='other'}
var dname=fld.name;if(fld.getAttribute('data-displayname')){dname=fld.getAttribute('data-displayname')}else if(fld.getAttribute('displayname')){dname=fld.getAttribute('displayname')}
if(undefined==p){p='Enter '+v+' "'+dname+'" below and click OK.'}
if(fld.value.toLowerCase()==v.toLowerCase()){var other=prompt(p);if(undefined!=other&&other.length>0){for(var i=0;i<fld.options.length;i++){if(fld.options[i].value==other){fld.value=fld.options[i].value;return!1}}
fld.options[fld.length]=new Option(other.toLowerCase(),other);fld.value=other}}
return!1}
var timer_heartbeat='';function scheduleHeartbeat(div,t){if(undefined==div){div='null'}
if(undefined==t){t=600}
var tmo=parseInt(t*1000);clearTimeout(timer_heartbeat);timer_heartbeat=setTimeout("heartbeat('"+div+"',"+t+")",tmo)}
function heartbeat(div,t){if(undefined==div){div='null'}
if(undefined==t){t=60}
ajaxGet('/php/index.php',div,'_heartbeat=1&t='+t+'&div='+div)}
var timer_session_errors='';function scheduleSessionErrors(div,t){if(undefined==div){div='null'}
if(undefined==t){t=600}
var tmo=parseInt(t*1000);clearTimeout(timer_heartbeat);timer_session_errors=setTimeout("sessionErrors('"+div+"',"+t+")",tmo)}
function sessionErrors(div,t){if(undefined==div){div='null'}
if(undefined==t){t=60}
ajaxGet('/php/admin.php',div,'_menu=session_errors&t='+t+'&div='+div)}
function redrawField(fieldname,srcObj){var theForm=getElementForm(srcObj);var formname=theForm.getAttribute('name');var divid=formname+'_'+fieldname+'_content';var tablename=theForm._table.value;var redraw=tablename+':'+fieldname;var params={_redraw:redraw,opt_0:srcObj.name,val_0:srcObj.value};var node=theForm[fieldname];for(var i=0;i<node.attributes.length;i++){if(node.attributes.item(i).specified){params['att_'+node.attributes.item(i).nodeName]=node.attributes.item(i).value}}
ajaxGet('/php/index.php',divid,params);return!1}
function changeModelType(srcObj){var theForm=getElementForm(srcObj);var content='';if(undefined!=theForm._id){content=getText(theForm.functions);if(content.length>0){return}}
var tablename=theForm.name.value;content='';if(srcObj.value==0){}else{content+='<?php'+"\r\n";content+='/* Available functions: Each function should return the array that was passed in.'+"\r\n";content+=''+"\r\n";content+='	//addDBRecord triggers'+"\r\n";content+='	function '+tablename+'AddBefore($params=array()){}'+"\r\n";content+='	function '+tablename+'AddSuccess($params=array()){}'+"\r\n";content+='	function '+tablename+'AddFailure($params=array()){}'+"\r\n";content+=''+"\r\n";content+='	//editDBRecord triggers'+"\r\n";content+='	function '+tablename+'EditBefore($params=array()){}'+"\r\n";content+='	function '+tablename+'EditSuccess($params=array()){}'+"\r\n";content+='	function '+tablename+'EditFailure($params=array()){}'+"\r\n";content+=''+"\r\n";content+='	//delDBRecord triggers'+"\r\n";content+='	function '+tablename+'DeleteBefore($params=array()){}'+"\r\n";content+='	function '+tablename+'DeleteSuccess($params=array()){}'+"\r\n";content+='	function '+tablename+'DeleteFailure($params=array()){}'+"\r\n";content+=''+"\r\n";content+='	//getDBRecord, listDBRecords, and getDBRecords trigger'+"\r\n";content+='	function '+tablename+'GetRecord($rec=array()){}'+"\r\n";content+='*/'+"\r\n\r\n";content+='?>'+"\r\n"}
setText(theForm.functions,content)}
function remindMeForm(){var dname="remindMePopup";var txt='';txt+='	<div class="w_centerpop_content" id="remindmediv" style="width:350px;padding:0 30px 0 30px;">'+"\n";txt+='		<form method="POST" name="remindMe" class="w_form" action="/php/index.php" onSubmit="ajaxSubmitForm(this,\'remindmediv\');return false;">'+"\n";txt+='			<input type="hidden" name="_remind" value="1">'+"\n";txt+='			<input type="hidden" name="tname" value="remind me">'+"\n";txt+='			<label for="remind_me_email" class="w_bigger w_grey" style="font-weight:300;"><span class="icon-mail"></span> Enter your email address.</label>'+"\n";txt+=' 			<div><input type="email" maxlength="255" id="remind_me_email" name="email" placeholder="your email address" pattern=".+@.+..{2,6}" data-pattern-msg="Invalid Email Address" required="1" data-requiredmsg="Enter the email address you registered with." value="" onFocus="this.select();" class="form-control input-lg"></div>'+"\n";txt+='			<div class="text-right w_padtop"><button type="submit" class="btn btn-default w_formsubmit btn-lg">Remind Me</button></div>'+"\n";txt+='		</form>';txt+='	</div>'+"\n";var rtitle='Remind Me';popUpDiv('',{id:dname,width:300,height:50,drag:1,notop:1,nobot:1,noborder:1,nobackground:1,bodystyle:"padding:0px;border:0px;background:none;"});setCenterPopText(dname,txt,{title:rtitle});document.remindMe.email.focus();return!1}
function setProcessing(id,msg,cancel){if(undefined==cancel){cancel=1}
if(undefined==msg){msg=''}
var str=getProcessingDiv(id,msg,cancel);setText(id,str);return}
function getProcessingDiv(id,msg,cancel){if(undefined==cancel){cancel=1}
if(undefined==msg){msg=''}
var str='';str+='<span id="processing_div">';str+='<span class="icon-spin7 w_spin"></span>';str+=' <span class="w_grey processing_message"> '+msg+'</span>';if(cancel==1){str+=' <span class="icon-cancel-circled w_danger w_pointer" onclick="return ajaxAbort(\''+id+'\');"></span>'}
str+='</span>';return str}
function submitRemindMeForm(frm){setProcessing('reminderMessage');ajaxSubmitForm(frm,'remindMeForm_Body');return!1}
function setDateTimeBox(id,d,h,m,ap){if(undefined==d||d.length==0){var cdate=new Date();d=cdate.getMonth()+'-'+cdate.getDate()+'-'+cdate.getFullYear()}
var dparts=d.split('-',3);h=parseInt(h*1);if(ap=='PM'){h=h+12}
if(h<10){h='0'+h}
if(m.length==1){m='0'+m}
var t=dparts[2]+'-'+dparts[0]+'-'+dparts[1]+' '+h+':'+m+':00';setText(id,t);return 1}
function setSliderText(fld){var val=fld.value;var attr=getAllAttributes(fld);if(undefined==attr["data-label"]){return}
if(undefined!=attr['data-labelmap']){attr['data-labelmap']=str_replace("'",'"',attr['data-labelmap']);var map=JSON.parse(attr['data-labelmap']);if(undefined!=map[val]){setText(attr['data-label'],map[val]);return}}
setText(attr['data-label'],val)}
function setTimeBox(id,h,m,ap){h=parseInt(h*1);if(ap=='PM'){h=h+12}
if(h.length==1){h='0'+h}
if(m.length==1){m='0'+m}
var t=h+':'+m+':00';setText(id,t);return 1}
function showColors(color,hexbox,colorbox){window.status=color+","+hexbox+","+colorbox;var setEl=document.getElementById(hexbox);setEl.innerHTML=color;setEl=document.getElementById(colorbox);setEl.style.backgroundColor=color}
function showColor(color){showColors(color,'show_hex','show_color')}
var setHexObj;var setHexDiv;var setHexImg;function selectColor(divid,frmObj,imgid){setHexObj=frmObj;setHexDiv=divid;setHexImg=imgid;ajaxGet('/wfiles/colortable.html',divid)}
function colorSelector(id){var obj=getObject(id);if(undefined==obj){alert(id+' does not exist');return!1}
var wobj=getObject(id+'_wrapper');if(undefined!=wobj){removeId(wobj);return!1}
obj.style.position='relative';this.iconid=id+'_icon';var iconobj=getObject(this.iconid);var h=getHeight(obj);this.wrapper=document.createElement('div');this.wrapper.style.width='115px';this.wrapper.style.height='134px';this.wrapper.id=id+'_wrapper';this.wrapper.style.position='absolute';this.wrapper.style.top=h+'px';this.wrapper.style.left='0px';this.wrapper.style.zIndex='99999';this.wrapper.style.border='1px solid #C0C0C0';this.wrapper.style.backgroundColor='#FFFFFF';this.wrapper.style.borderBottom='10px solid #C0C0C0';iconobj.insertAdjacentElement('afterEnd',this.wrapper);this.colorbox=document.createElement('div');this.colorbox.style.width='80px';this.colorbox.style.height='100px';this.colorbox.style.position='absolute';this.colorbox.style.top='0px';this.colorbox.style.left='0px';this.colorbox.style.cursor='crosshair';this.colorbox.id=id+'_colorbox';this.wrapper.insertAdjacentElement('afterBegin',this.colorbox);this.slider=document.createElement('div');this.slider.style.width='35px';this.slider.style.height='100px';this.slider.style.position='absolute';this.slider.style.top='0px';this.slider.style.right='0px';this.slider.style.cursor='crosshair';this.slider.id=id+'_slider';this.wrapper.insertAdjacentElement('afterBegin',this.slider);this.valuebox=document.createElement('div');this.valuebox.style.width='115px';this.valuebox.style.height='24px';this.valuebox.style.position='absolute';this.valuebox.style.top='100px';this.valuebox.style.left='0px';this.valuebox.id=id+'_valuebox';this.wrapper.insertAdjacentElement('afterBegin',this.valuebox);this.setid=id+'_set';this.btnid=id+'_btn';this.lineid=id+'_line';var valuetext='<div style="font-size:14px;height:30px;width:115px;font-family:arial;position:relative;">';valuetext+='<div style="position:absolute;top:0px;right:3px;cursor:pointer;" onclick="colorSelectorSet(\''+id+'\')" title="Set Color"><span id="'+this.btnid+'" class="icon-checkbox" style="font-size:18px;cursor:pointer;color:none;"></span></div>';valuetext+='<div style="position:absolute;top:0px;left:5px;" id="'+this.setid+'"></div>';valuetext+='</div>';setText(this.valuebox,valuetext);this.picker=ColorPicker(this.slider,this.colorbox,function(hex,hsv,rgb){var btnid=this.control_id+'_btn';var setid=this.control_id+'_set';var lineid=this.control_id+'_wrapper';hex=hex.toUpperCase();setText(setid,hex);setStyle(btnid,'color',hex);setStyle(lineid,'borderBottom','10px solid '+hex)});this.picker.control_id=id;this.picker.id=this.wrapper.id;if(obj.value.length){this.picker.setHex(obj.value)}
return!1}
function colorSelectorSet(id){var setid=id+'_set';var wrapper=id+'_wrapper';var iconid=id+'_icon';var hex=getText(setid);setText(id,hex);setStyle(iconid,'color',hex);removeId(wrapper);return!1}
function setHex(hex){setText(setHexObj,hex);setText(setHexDiv,'');setStyle(setHexImg,'backgroundColor',hex)}
function showToolbar(field,cat){var list=GetElementsByAttribute('div','id','toolbar');for(var i=0;i<list.length;i++){var cfield=list[i].getAttribute('field');var ccat=list[i].getAttribute('category');if(cfield==field&&ccat==cat){list[i].style.display='block'}else{list[i].style.display='none'}}}
function setRadioLabel(rname){var rtags=GetElementsByAttribute('input','name','^'+rname+'$');for(var x=0;x<rtags.length;x++){var rtagid=rtags[x].id;var cust=GetElementsByAttribute('label','for','^'+rtagid+'$');for(var i=0;i<cust.length;i++){if(rtags[x].checked){setClassName(cust[i],'w_checklist_checked')}else{setClassName(cust[i],'w_checklist')}}}}
function setLabelChecked(att,val,ck,classn,classc){var cust=GetElementsByAttribute('label',att,'^'+val+'$');var cnt=0;if(undefined!=classn&&undefined!=classc){for(var i=0;i<cust.length;i++){if(ck){setClassName(cust[i],classc)}else{setClassName(cust[i],classn)}}}else{for(var i=0;i<cust.length;i++){if(ck){setClassName(cust[i],'w_checklist_checked')}else{setClassName(cust[i],'w_checklist')}}}
return!0}
function checkAllElements(att,val,ck){var cust=GetElementsByAttribute('input',att,'^'+val+'$');var cnt=0;for(var i=0;i<cust.length;i++){if(cust[i].type=='checkbox'){if(undefined!=cust[i].getAttribute('onclick')){simulateEvent(cust[i],'click')}
cust[i].checked=ck;cnt++}}
return!1}
function setTimeField(frmname,fldname){var dt=new Date();var mon=dt.getMonth()+1;if(mon.length==1){mon='0'+mon}
var day=dt.getDate();if(day.length==1){day='0'+day}
var d=mon+'-'+day+'-'+dt.getFullYear();var h=dt.getHours();var m=dt.getMinutes();if(m<10){m="0"+m}
var p="am";if(h==0){h=12;p="am"}else if(h>12){h=h-12;p="pm"}
if(h<10){h="0"+h}
var obj=getObject(frmname+'_'+fldname+'_date');if(undefined!=obj){obj.value=d}
var obj=getObject(frmname+'_'+fldname+'_hour');if(undefined!=obj){obj.value=h}
var obj=getObject(frmname+'_'+fldname+'_minute');if(undefined!=obj){obj.value=m}
var obj=getObject(frmname+'_'+fldname+'_ampm');if(undefined!=obj){obj.value=p}}
function insertAtCursor(myField,myValue){var obj=getObject(myField);if(document.selection){obj.focus();sel=document.selection.createRange();sel.text=myValue}else if(obj.selectionStart||obj.selectionStart=='0'){var startPos=obj.selectionStart;var endPos=obj.selectionEnd;obj.value=obj.value.substring(0,startPos)+myValue+obj.value.substring(endPos,obj.value.length)}else{obj.value+=myValue}}
function isCreditCardNumber(ccNumb){var valid="0123456789"
var len=ccNumb.length;var iCCN=parseInt(ccNumb);var sCCN=ccNumb.toString();sCCN=sCCN.replace(/^\s+|\s+$/g,'');var iTotal=0;var bNum=!0;var temp;var calc;for(var j=0;j<len;j++){temp=""+sCCN.substring(j,j+1);if(valid.indexOf(temp)=="-1"){return!1}}
if(len>=15&&len<=20){for(var i=len;i>0;i--){calc=parseInt(iCCN)%10;calc=parseInt(calc);iTotal+=calc;i--;iCCN=iCCN/10;calc=parseInt(iCCN)%10;calc=calc*2;switch(calc){case 10:calc=1;break;case 12:calc=3;break;case 14:calc=5;break;case 16:calc=7;break;case 18:calc=9;break;default:calc=calc}
iCCN=iCCN/10;iTotal+=calc}
var m=iTotal%10;if(m==0){return!0}else{return!1}}
return!1}
function textboxSelect(oTextbox,iStart,iEnd){switch(arguments.length){case 1:oTextbox.select();break;case 2:iEnd=oTextbox.value.length;case 3:if(isIE){var oRange=oTextbox.createTextRange();oRange.moveStart("character",iStart);oRange.moveEnd("character",-oTextbox.value.length+iEnd);oRange.select()}else if(isMoz){oTextbox.setSelectionRange(iStart,iEnd)}
break}
oTextbox.focus()}
function textboxReplaceSelect(oTextbox,sText){if(isIE){var oRange=document.selection.createRange();oRange.text=sText;oRange.collapse(!0);oRange.select()}else if(isMoz){var iStart=oTextbox.selectionStart;oTextbox.value=oTextbox.value.substring(0,iStart)+sText+oTextbox.value.substring(oTextbox.selectionEnd,oTextbox.value.length);oTextbox.setSelectionRange(iStart+sText.length,iStart+sText.length)}
oTextbox.focus()}
function submitForm(theForm,popup,debug,ajax){if(undefined==debug){debug==0}
if(undefined==ajax){ajax==0}
if(undefined==theForm){alert("No form object passed to submitForm");return!1}
if(undefined!=theForm._action){if(theForm._action.value=='Delete'){return!0}}
popup=1;var quickmask=new Array();quickmask.alpha='^[a-zA-Z_\\-\\?\\ \\\']+$';quickmask.alphanumeric='^[0-9a-zA-Z_\\-\\.\\?\\ \\\']+$';quickmask.calendar='^[0-9]{1,2}\\-[0-9]{1,2}\\-[0-9]{1,4}$';quickmask.email='.+@.+\\..{2,6}';quickmask.integer='^[0-9]+$';quickmask.hexcolor='^#[abcdef0-9]{6,6}$';quickmask.decimal='^[0-9]*\\.[0-9]+$';quickmask.number='(^\-{0,1}[0-9]+$)|(^\-{0,1}\\.[0-9]+$)|(^\-{0,1}[0-9]+\\.[0-9]+$)';quickmask.phone='^([0-9]{3,3}[\\-\\.][0-9]{3,3}[\\-\\.][0-9]{4,4}|\\([0-9]{3,3}\\)\\ [0-9]{3,3}[\\-][0-9]{4,4})$';quickmask.time='^[0-9]{1,2}\\:[0-9]{2}$';quickmask.ssn='^[0-9]{3,3}\\-[0-9]{2,2}\\-[0-9]{4,4}$';quickmask.zipcode='^[0-9]{5,5}(\\\-[0-9]{4,4})*$';if(theForm.length==0){return!1}
if(debug==1){alert("Form length: "+theForm.length)}
var formfields=new Array();for(var i=0;i<theForm.length;i++){if(debug==1){alert("Checking "+theForm[i].name+" of type "+theForm[i].type)}
if(!in_array(theForm[i].name,formfields)&&theForm[i].name!='_formfields'){formfields[formfields.length]=theForm[i].name}
if(theForm[i].name=='password'&&undefined!=theForm.password_confirm){if(theForm[i].value.length==0||theForm.password_confirm.value.length==0){submitFormAlert('Password is required',popup,5);theForm[i].focus();return!1}
if(theForm[i].value!=theForm.password_confirm.value){submitFormAlert('Passwords do not match.  Please retype password.',popup,5);theForm[i].focus();return!1}}
if(theForm[i].name=='email'&&undefined!=theForm.email_confirm){if(theForm[i].value.length==0||theForm.email_confirm.value.length==0){submitFormAlert('Email is required',popup,3);theForm[i].focus();return!1}
if(theForm[i].value!=theForm.email_confirm.value){submitFormAlert('Emails do not match.',popup,3);theForm[i].focus();return!1}}
var dname=theForm[i].name;if(theForm[i].getAttribute('data-displayname')){dname=theForm[i].getAttribute('data-displayname')}else if(theForm[i].getAttribute('displayname')){dname=theForm[i].getAttribute('displayname')}
var required=0;if(undefined!=theForm[i].getAttribute('_required')){required=theForm[i].getAttribute('_required')}else if(undefined!=theForm[i].getAttribute('data-required')){required=theForm[i].getAttribute('data-required')}else if(undefined!=theForm[i].getAttribute('required')){required=theForm[i].getAttribute('required')}
var requiredif='';if(undefined!=theForm[i].getAttribute('_requiredif')){requiredif=theForm[i].getAttribute('_requiredif')}else if(undefined!=theForm[i].getAttribute('data-requiredif')){requiredif=theForm[i].getAttribute('data-requiredif')}else if(undefined!=theForm[i].getAttribute('requiredif')){requiredif=theForm[i].getAttribute('requiredif')}
if(requiredif.length>0){if(formFieldHasValue(requiredif)){required=1}}
if(required==1){var requiredmsg=theForm[i].getAttribute('data-requiredmsg');if(undefined==requiredmsg){requiredmsg=theForm[i].getAttribute('requiredmsg')}
if(theForm[i].type=='checkbox'){var checkname='name';if(theForm[i].getAttribute('checkname')){checkname=theForm[i].getAttribute('checkname')}
var checkval=theForm[i].getAttribute(checkname);var checkboxlist=GetElementsByAttribute('input',checkname,checkval);var isChecked=0;for(var c=0;c<checkboxlist.length;c++){if(checkboxlist[c].type=='checkbox'&&checkboxlist[c].checked){isChecked++}else if(checkboxlist[c].type=='text'&&checkboxlist[c].value!=''){isChecked++}}
if(isChecked==0){var msg=dname+" is required";if(undefined!=requiredmsg){msg=requiredmsg}
if(typeof wacss.blink==="function"&&undefined!=theForm[i].getAttribute('data-blink')){wacss.blink(theForm[i].getAttribute('data-blink'))}else{submitFormAlert(msg,popup,5)}
theForm[i].focus();return!1}}else if(theForm[i].type=='radio'){var checkboxlist=GetElementsByAttribute('input','name',theForm[i].name);var isChecked=0;for(var c=0;c<checkboxlist.length;c++){if(checkboxlist[c].type=='radio'&&checkboxlist[c].checked){isChecked++}else if(checkboxlist[c].type=='text'&&checkboxlist[c].value!=''){isChecked++}}
if(isChecked==0){var msg=dname+" is required";if(undefined!=requiredmsg){msg=requiredmsg}
if(typeof wacss.blink==="function"&&undefined!=theForm[i].getAttribute('data-blink')){wacss.blink(theForm[i].getAttribute('data-blink'))}else{submitFormAlert(msg,popup,5)}
theForm[i].focus();return!1}}else if(theForm[i].type=='textarea'){var cval=trim(getText(theForm[i]));if(cval.length==0){var msg=dname+" is required";if(undefined!=requiredmsg){msg=requiredmsg}
if(typeof wacss.blink==="function"&&undefined!=theForm[i].getAttribute('data-blink')){wacss.blink(theForm[i].getAttribute('data-blink'))}else{submitFormAlert(msg,popup,5)}
theForm[i].focus();return!1}}else if(theForm[i].type=='select-one'){var cval=theForm[i].options[theForm[i].selectedIndex].value;if(cval.length==0){var msg=dname+" is required";if(undefined!=requiredmsg){msg=requiredmsg}
if(typeof wacss.blink==="function"&&undefined!=theForm[i].getAttribute('data-blink')){wacss.blink(theForm[i].getAttribute('data-blink'))}else{submitFormAlert(msg,popup,5)}
theForm[i].focus();return!1}}else if(theForm[i].value==''){var msg=dname+" is required";if(undefined!=requiredmsg){msg=requiredmsg}
if(typeof wacss.blink==="function"&&undefined!=theForm[i].getAttribute('data-blink')){wacss.blink(theForm[i].getAttribute('data-blink'))}else{submitFormAlert(msg,popup,5)}
theForm[i].focus();return!1}}
var mask=theForm[i].getAttribute('pattern');if(undefined==mask){mask=theForm[i].getAttribute('mask')}
if(undefined==mask){mask=theForm[i].getAttribute('data-mask')}
if(undefined!=mask&&mask!=''&&theForm[i].value!=''){var fldmsg=theForm[i].getAttribute('data-pattern-msg');if(undefined==fldmsg){fldmsg=theForm[i].getAttribute('maskmsg')}
if(mask=='ccnumber'){if(isCreditCardNumber(theForm[i].value)==!1){var msg=dname+" must be of valid credit card number ";if(undefined!=fldmsg){msg=fldmsg}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}else if(mask=='date'){if(isDate(theForm[i].value)==!1){var msg=dname+" must be a valid date ";if(undefined!=fldmsg){msg=fldmsg}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}else if(mask=='futuredate'){if(isFutureDate(theForm[i].value)==!1){var msg=dname+" must be of valid date in the future ";if(undefined!=fldmsg){msg=fldmsg}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}else if(mask=='pastdate'){if(isPastDate(theForm[i].value)==!1){var msg=dname+" must be of valid date in the past ";if(undefined!=fldmsg){msg=fldmsg}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}else if(mask=='intlphone'){if(checkInternationalPhone(theForm[i].value)==!1){var msg=dname+" must be a valid phone number";if(undefined!=fldmsg){msg=fldmsg}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}else if(mask!='searchandreplace'){if(mask=='phone'){theForm[i].value=formatPhone(theForm[i].value)}else if(mask=='calendar'){theForm[i].value=formatCalendar(theForm[i].value)}
var rmask=mask;if(undefined!=quickmask[mask]){rmask=quickmask[mask]+''}
var re=new RegExp(rmask,'i');if(re.test(theForm[i].value)==!1){var msg=dname+" must be of type "+mask;if(undefined!=fldmsg){msg=fldmsg}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}}
if(theForm[i].type=='textarea'&&theForm[i].getAttribute('maxlength')){var len=theForm[i].value.length;var max=Math.abs(theForm[i].getAttribute('maxlength'));if(len>max){var msg=dname+" must be less than "+max+" characters\nYou entered "+len+" characters.";if(theForm[i].getAttribute('maxlengthmsg')){msg=theForm[i].getAttribute('maxlengthmsg')}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}
if(theForm[i].getAttribute('minlength')){var len=theForm[i].value.length;var minlength=Math.abs(theForm[i].getAttribute('minlength'));if(len<minlength){var msg=dname+" must be at least "+minlength+" characters.\nYou entered "+len+" characters.";if(theForm[i].getAttribute('minlengthmsg')){msg=theForm[i].getAttribute('minlengthmsg')}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}
if(theForm[i].getAttribute('minwords')){var cnt=getWordCount(theForm[i]);var minwords=Math.abs(theForm[i].getAttribute('minwords'));if(len<minwords){var msg=dname+" must be at least "+minwords+" words in length.\nYou entered "+cnt+" words.";if(theForm[i].getAttribute('minwordsmsg')){msg=theForm[i].getAttribute('minwordsmsg')}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}
if(theForm[i].getAttribute('maxwords')){var cnt=getWordCount(theForm[i]);var maxwords=Math.abs(theForm[i].getAttribute('maxwords'));if(len<maxwords){var msg=dname+" must be less than "+maxwords+" words in length.\nYou entered "+cnt+" words.";if(theForm[i].getAttribute('maxwordsmsg')){msg=theForm[i].getAttribute('maxwordsmsg')}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}
if(theForm[i].type=='file'&&theForm[i].getAttribute('accept')&&theForm[i].value.length){var allow=theForm[i].getAttribute('accept');if(debug==1){alert(" -- File type allowed exts:"+allow)}
var exts=allow.split(',');var valid=0;for(s=0;s<exts.length;s++){if(theForm[i].value.lastIndexOf(exts[s])!=-1){valid++}}
if(valid==0){var msg=dname+" must be of valid file type:  "+allow;if(theForm[i].getAttribute('acceptmsg')){msg=theForm[i].getAttribute('acceptmsg')}
submitFormAlert(msg,popup,5);theForm[i].focus();return!1}}}
for(var i=0;i<theForm.length;i++){var behavior=theForm[i].getAttribute('data-behavior');var id=theForm[i].getAttribute('id');if(undefined!=behavior&&(behavior=='wysiwyg'||behavior=='richtext'||behavior=='tinymce'||behavior=='nicedit')&&undefined!=nicEditors[id]){if(ajax==1){nicEditors.findEditor(id).saveContent()}
nicEditors[id].removeInstance(id)}}
var formfieldstr=implode(',',formfields);var ffound=0;for(var i=0;i<theForm.length;i++){if(theForm[i].name=='_formfields'){theForm[i].value=formfieldstr;ffound=1;break}}
if(ffound==0){formAddField(theForm,'_formfields',formfieldstr)}
return!0}
function formAddField(frm,fld,val){var input=document.createElement("input");input.type="hidden";input.name=fld;input.value=val;frm.appendChild(input)}
function formFieldHasValue(fld){fld=getObject(fld);if(undefined==fld){return!1}
if(undefined==fld.type){return!1}
if(fld.type=='checkbox'||fld.type=='radio'){if(fld.checked){return!0}}else if(fld.type=='textarea'){var cval=trim(getText(fld));if(cval.length){return!0}}else if(fld.value!=''){return!0}
return!1}
function imposeMaxlength(obj,max){return(obj.value.length<=max)}
function pagingSetProcessing(obj){let s=obj.querySelector('span');if(undefined!=s){s.className='icon-spin7 w_spin'}else{setText(obj,'<span class="icon-spin7 w_spin"></span>')}}
function pagingSubmit(frm,div){pagingAddFilter(frm);pagingSetFilters(frm);if(undefined!=div){console.log('pagingSubmit - ajax');frm.setAttribute('pagingSetFilters',0);return ajaxSubmitForm(frm,div)}
frm.submit();return!1}
function pagingSetOffset(frm,v){frm.filter_offset.value=v;return frm.onsubmit()}
function pagingSetOrder(frm,v){if(frm.filter_order.value==v&&frm.filter_order.value.indexOf('desc')==-1){v=v+' desc'}
frm.filter_order.value=v;return frm.onsubmit()}
function pagingBulkEdit(frm){if(frm.filter_field.value.length==0||frm.filter_field.value=='*'){alert('select a field to edit');return!1}
var editval='';if(frm.filter_value.value.length==0){editval='NULL'}else{editval="'"+frm.filter_value.value+"'"}
if(!confirm('Are you sure you want to update the current dataset?'+"\r\n\r\n"+'Mass Update \''+frm.filter_field.value+'\' field to '+editval+'?'+"\r\n\r\n"+'Click OK to confirm.  THIS IS NOT REVERSABLE.')){return!1}
frm.bulkedit=1;frm.filter_bulkedit.value='1';return frm.onsubmit()}
function pagingExport(frm){pagingAddFilter(frm);pagingSetFilters(frm);frm.filter_export.value='1';return frm.onsubmit()}
function pagingAddFilter(frm){if(undefined!=frm.bulkedit){return!1}
if(frm.filter_field.value.length==0){alert('select a filter field');return!1}
if(frm.filter_operator.value.length==0){alert('select a filter operator');return!1}
if(frm.filter_field.value=='*'&&(frm.filter_operator.value=='ib'||frm.filter_operator.value=='nb')){alert('select a field to check for null values on');frm.filter_field.focus();return!1}else if(frm.filter_field.value!='*'&&(frm.filter_operator.value=='ib'||frm.filter_operator.value=='nb')){}else if(frm.filter_value.value.length==0&&frm.filter_operator.value!='null'){frm.filter_value.focus();return!1}
var id=frm.filter_field.value+frm.filter_operator.value+frm.filter_value.value;var obj=getObject(id);var filters=new Array();if(undefined!=obj){obj.style.display='inline-block'}else{var d=document.createElement('div');d.className='w_pagingfilter';d.setAttribute('data-field',frm.filter_field.value);d.setAttribute('data-operator',frm.filter_operator.value);d.setAttribute('data-value',frm.filter_value.value);d.id=id;var dfield=frm.filter_field.value;if(dfield=='*'){dfield='Any Field'}
var doper=frm.filter_operator.value;var dval='\''+frm.filter_value.value+'\'';switch(doper){case 'ct':doper='Contains';break;case 'nct':doper='Not Contains';break;case 'ca':doper='Contains Any of These';break;case 'nca':doper='Not Contain Any of These';break;case 'eq':doper='Equals';break;case 'neq':doper='Not Equals';break;case 'ea':doper='Equals Any of These';break;case 'nea':doper='Not Equals Any of These';break;case 'gt':doper='Greater Than';break;case 'lt':doper='Less Than';break;case 'egt':doper='Equals or Greater than';break;case 'elt':doper='Less than or Equals';break;case 'ib':doper='Is Blank';dval='';break;case 'nb':doper='Is Not Blank';dval='';break}
d.innerHTML='<span class="icon-filter w_grey"></span> '+dfield+' '+doper+' '+dval+' <span class="icon-cancel w_danger w_pointer" onclick="removeId(\''+id+'\');"></span>';var p=getObject('send_to_filters');p.appendChild(d)}
var f=document.querySelectorAll('.w_pagingfilter');var filter_count=0;for(var i=0;i<f.length;i++){if(f[i].style.display=='none'){continue}
if(undefined==f[i].getAttribute('data-field')||f[i].getAttribute('data-field')=='null'){continue}
filter_count=filter_count+1}
if(filter_count>0){obj=getObject('paging_clear_filters');if(undefined!=obj){removeId(obj)}
var d=document.createElement('div');d.className='w_pagingfilter icon-erase w_big w_danger';d.id='paging_clear_filters';d.setAttribute('title','Clear All Filters');d.onclick=function(){pagingClearFilters()};var p=getObject('send_to_filters');p.appendChild(d)}
frm.filter_value.value='';frm.filter_value.focus()}
function pagingSetFilters(frm){var f=document.querySelectorAll('.w_pagingfilter');var filters=new Array();for(var i=0;i<f.length;i++){if(f[i].style.display=='none'){continue}
if(undefined==f[i].getAttribute('data-field')||f[i].getAttribute('data-field')=='null'){continue}
var fval=f[i].getAttribute('data-field')+'-'+f[i].getAttribute('data-operator')+'-'+f[i].getAttribute('data-value');filters.push(fval)}
if(undefined!=frm.bulkedit){return}
frm._filters.value=implode("\r\n",filters);if(undefined!=frm.getAttribute('pagingSetFilters')){let check=frm.getAttribute('pagingSetFilters');if(check==1||check=='1'){return!1}}
frm.setAttribute('pagingSetFilters',1);if(undefined!=frm.filter_bulkedit){frm.filter_bulkedit.value=''}
if(undefined!=frm.filter_export){frm.filter_export.value=''}}
function pagingClearFilters(){var f=document.querySelectorAll('.w_pagingfilter');for(var i=0;i<f.length;i++){removeId(f[i])}
var f=GetElementsByAttribute('textarea','name','_filters');for(var i=0;i<f.length;i++){setText(f[i],'')}}
function submitSurveyForm(theForm,opts){if(undefined==theForm){alert('submitSurveyForm Error: No Form');return!1}
if(!submitForm(theForm)){return!1}
var enames=new Array();for(var i=0;i<theForm.length;i++){var fname=theForm[i].name;enames[fname]=1}
for(var i=0;i<theForm.length;i++){if(undefined==theForm[i].name){continue}
var fname=theForm[i].name;if(fname.length==0){continue}
if(undefined!=opts){for(var optkey in opts){if(opts[optkey]!=1){continue}
if(theForm[i].getAttribute(optkey)){var optval=theForm[i].getAttribute(optkey);if(optval.length){var fieldname=optkey+'_'+fname;if(undefined==enames[fieldname]){enames[fieldname]=1;var addfield=document.createElement("textarea");addfield.setAttribute('NAME',fieldname);addfield.style.display='none';addfield.value=optval;theForm.appendChild(addfield)}}}}}}
return!0}
function checkInternationalPhone(strPhone){var digits="0123456789";var phoneNumberDelimiters=".()- ";var validWorldPhoneChars=phoneNumberDelimiters+"+";var minDigitsInIPhoneNumber=10;var bracket=3;strPhone=trim(strPhone);if(strPhone.indexOf("+")>1)return!1;if(strPhone.indexOf("-")!=-1){bracket=bracket+1}
if(strPhone.indexOf("(")!=-1&&strPhone.indexOf("(")>bracket){return!1}
var brchr=strPhone.indexOf("(");if(strPhone.indexOf("(")!=-1&&strPhone.charAt(brchr+2)!=")"){return!1}
if(strPhone.indexOf("(")==-1&&strPhone.indexOf(")")!=-1){return!1}
s=stripCharsInBag(strPhone,validWorldPhoneChars);return(isInteger(s)&&s.length>=minDigitsInIPhoneNumber)}
function isInteger(s){var i;for(i=0;i<s.length;i++){var c=s.charAt(i);if(((c<"0")||(c>"9")))return!1}
return!0}
function trim(str){if(null!=str&&undefined!=str&&""!=str){var rval=str.replace(/^[\ \s\0\r\n\t]*/g,"");rval=rval.replace(/[\ \s\0\r\n\t]*$/g,"");return rval}else{return""}}
function stripCharsInBag(s,bag){var i;var returnString="";for(i=0;i<s.length;i++){var c=s.charAt(i);if(bag.indexOf(c)==-1){returnString+=c}}
return returnString}
function submitFormAlert(msg,popup,timer){if(undefined==popup){popup=0}
if(popup){html='';html+='<div class="w_centerpop_title"><span class="icon-warning w_danger"></span> Error Processing Request</div>'+"\n";html+='<div class="w_centerpop_content">'+"\n";html+='	<div class="w_big w_dblue"> - '+msg+'</div>'+"\n";html+='	<div class="w_smallest w_right w_lblue" style="margin-right:20px;" id="centerpop2_countdown">4</div>'+"\n";html+='</div>'+"\n";centerpopDiv(html,3,2);countDown('centerpop2_countdown')}else{alert(msg)}
return!1}
function showFormData(theForm,id){if(undefined==theForm){alert("No form object passed to formData");return!1}
if(theForm.length==0){return!1}
var str='';for(var i=0;i<theForm.length;i++){var dname=theForm[i].name;var type=typeof(theForm[i]);str+='Name: '+dname+"<br>\r\n";str+='Type: '+type+"<br>\r\n"}
if(!id){alert(str)}else{setText(id,str)}}
function checkPerl(field,value){if(undefined==document._perlcheck){alert('document._perlcheck does not exist.');return!1}
var pfield=field+"_perlcheck";if(undefined==value){alert('Nothing to check.');return!1}
if(value.length==0){alert('Nothing to check.');return!1}
document.getElementById(pfield).innerHTML='<img src="/wfiles/busy.gif" title="checking Perl syntax" width="12" height="12" alt="checking Perl syntax" />';document._perlcheck.perlcheck.value=value;ajaxSubmitForm(document._perlcheck,pfield,5);return!1}
function cloneObj(c){var obj=getObject(c);var inc=obj.getAttribute('inc');if(undefined==inc){inc=1}else{inc=parseFloat(inc);inc++}
obj.setAttribute('inc',inc);var cloneObj=obj.cloneNode(!0);if(undefined!=cloneObj.id){cloneObj.setAttribute('id',cloneObj.id+'_'+inc)}
if(undefined!=cloneObj.style.display&&cloneObj.style.display=='none'){cloneObj.style.display='block'}
var clonedInputs=cloneObj.getElementsByTagName('input');var clonedImgs=cloneObj.getElementsByTagName('img');for(var i=0;i<clonedInputs.length;i++){var cname=clonedInputs[i].getAttribute('name');var cid=clonedInputs[i].getAttribute('id');if(undefined==cid||cid.length==0){cid=cname}
if(undefined==cname){continue}
var ctype=clonedInputs[i].getAttribute('type');if(cname=='_clone'&&ctype.toLowerCase()=='button'){clonedInputs[i].style.display='none'}
if(ctype.toLowerCase()!='button'&&ctype.toLowerCase()!='hidden'){clonedInputs[i].value=''}
var newname=cname+'_'+inc;var newid=cid+'_'+inc;if(newname.indexOf('[]')>1){newname=cname}
if(cname.indexOf('_path')!=-1){newname=cname.replace(/path/,"");newname+=inc+'_path'}
if(cname.indexOf('_autonumber')!=-1){newname=cname.replace(/autonumber/,"");newname+=inc+'_autonumber'}
clonedInputs[i].setAttribute('name',newname);if(undefined!=cid&&cid.indexOf('_datecontrol')!=-1){newid=newid+'_datecontrol'}
clonedInputs[i].setAttribute('id',newid);if(undefined!=cid){for(var k=0;k<clonedImgs.length;k++){if(undefined!=clonedImgs[k].getAttribute('onclick')){var onclickval=clonedImgs[k].getAttribute('onclick');if(typeof(onclickval.replace)=="function"){onclickval=onclickval.replace(cid,newid)}
clonedImgs[k].setAttribute('onclick',onclickval)}}}}
var clonedSelects=cloneObj.getElementsByTagName('select');for(var i=0;i<clonedSelects.length;i++){var cname=clonedSelects[i].getAttribute('name');if(undefined==cname){continue}
var newname=cname+'_'+inc;clonedSelects[i].setAttribute('name',newname);clonedSelects[i].setAttribute('id',newname)}
var clonedTextareas=cloneObj.getElementsByTagName('textarea');for(var i=0;i<clonedTextareas.length;i++){var cname=clonedTextareas[i].getAttribute('name');if(undefined==cname){continue}
clonedTextareas[i].value='';var newname=cname+'_'+inc;clonedTextareas[i].setAttribute('name',newname);clonedTextareas[i].setAttribute('id',newname)}
obj.parentNode.appendChild(cloneObj);return inc}
function ajaxSubmitForm(theform,sid,tmeout,callback,returnreq,abort_callback){return ajaxPost(theform,sid,tmeout,callback,returnreq,abort_callback)}
function ajaxPopup(url,params,useropts){var pid='ajaxPopupDiv';var opt={id:pid,drag:1}
if(useropts){for(var key in opt){if(undefined!=useropts[key]){opt[key]=useropts[key]}}
for(var key in useropts){if(undefined==opt[key]){opt[key]=useropts[key]}}}
popUpDiv('<div class="w_bold w_lblue w_big"><img src="/wfiles/loading_blu.gif" alt="loading" /> loading...please wait.</div>',opt);ajaxGet(url,'centerpop',params)}
function ajaxSubmitMultipartForm(theform,sid,params){if(undefined==theform){alert("No form object passed to ajaxSubmitMultipartForm");return!1}
if(undefined=='sid'){sid='centerpop'}
if(undefined==params){params={}}
let url=theform.getAttribute('action');let ok=submitForm(theform,1,0,1);if(!ok){return!1}
let data=new FormData();data.append('AjaxRequestUniqueId',Math.random().toString(36).substr(2,9));let request=new XMLHttpRequest();request.formdata=data;let j=0;for(let i=0;i<theform.length;i++){if(undefined==theform[i].name){continue}
if(theform[i].name.length==0){continue}
if(theform[i].name=='setprocessing'){params.setprocessing=theform[i].value}
switch(theform[i].type.toLowerCase()){case 'color':case 'date':case 'datetime':case 'datetime-local':case 'email':case 'month':case 'number':case 'range':case 'search':case 'tel':case 'time':case 'url':case 'week':case 'text':case 'password':case 'submit':case 'hidden':case 'textarea':data.append(theform[i].name,theform[i].value);break;case 'select-one':if(theform[i].selectedIndex>=0){data.append(theform[i].name,theform[i].options[theform[i].selectedIndex].value)}
break;case 'select-multiple':for(j=0;j<theform[i].options.length;j++){if(theform[i].options[j].selected){data.append(theform[i].name,theform[i].options[j].value)}}
break;case 'checkbox':case 'radio':if(theform[i].checked){data.append(theform[i].name,theform[i].value)}
break;case 'file':if(theform[i].files.length==1){data.append(theform[i].name,theform[i].files[0])}else{for(j=0;j<theform[i].files.length;j++){data.append(theform[i].name+'_'+j,theform[i].files[j])}}
break}}
request.sid=sid;request.params=params;request.addEventListener('loadstart',function(e){if(undefined==this.params.setprocessing){if(this.params.setprocessing==0){return!1}}
var txt=getProcessingDiv(this.sid);if(undefined==this.params.setprocessing){setText(this.params.setprocessing,txt);return!1}
if(this.sid.indexOf('centerpop')!=-1){popUpDiv('',{id:this.sid,width:300,height:50,notop:1,nobot:1,noborder:1,nobackground:1,bodystyle:"padding:0px;border:0px;background:none;"});var atitle='Processing Request';setCenterPopText(this.sid,txt,{title:atitle,drag:!1,close_bot:!1})}else if(this.sid=='modal'){let title='';if(undefined!=this.params.title){title=this.params.title}else{title='Processing Request'}
let modal=wacss.modalPopup(txt,title,{overlay:1})}else{this.prevtxt=getText(this.sid);setText(this.sid,txt)}});request.upload.sid=sid;request.upload.params=params;request.upload.xhr=request;request.upload.addEventListener('progress',function(e){let percent_complete=parseInt((e.loaded/e.total)*100);let pobj=document.querySelector('#processing_div .processing_message');if(undefined!=pobj){setText(pobj,percent_complete+'%');return!1}
let txt=getProcessingDiv(this.sid,percent_complete+'%');if(this.sid.indexOf('centerpop')!=-1){let sidobj=getObject(this.sid);if(undefined==sidobj){this.xhr.abort();return!1}
updateCenterPopText(this.sid,txt)}else if(this.sid=='modal'){let sidobj=getObject('wacss_modal');if(undefined==sidobj){this.xhr.abort();return!1}
let modal=wacss.modalPopup(txt)}else{setText(this.sid,txt)}});request.addEventListener('load',function(e){console.log('Load: '+this.sid);if(this.sid.indexOf('centerpop')!=-1){updateCenterPopText(this.sid,request.response)}else if(this.sid=='modal'){let title='';if(undefined!=this.params.success_title){title=this.params.success_title}else{title='Success'}
let modal=wacss.modalPopup(request.response,title)}else{setText(this.sid,request.response)}});request.addEventListener('error',function(e){if(this.sid.indexOf('centerpop')!=-1){updateCenterPopText(this.sid,request.response,'Error')}else if(this.sid=='modal'){let title='';if(undefined!=this.params.error_title){title=this.params.error_title}else{title='Error'}
let modal=wacss.modalPopup(request.response,title,{overlay:1})}else{setText(this.sid,request.response)}});request.addEventListener('abort',function(e){if(this.sid.indexOf('centerpop')!=-1){removeId(this.sid)}else if(this.sid=='modal'){wacss.modalClose()}else{setText(this.sid,this.prevtxt)}});request.open('post',url);request.send(data);return!1}
function ajaxPost(theform,sid,tmeout,callback,returnreq,abort_callback){if(undefined==theform){alert("No form object passed to ajaxPost");return!1}
if(undefined!=tmeout&&tmeout=='novalidation'){tmeout=3600000}else{var ok=submitForm(theform,1,0,1);if(!ok){return!1}}
if(undefined==callback){if(undefined!=theform.callback&&theform.callback.type=='hidden'&&theform.callback.value.length){callback=theform.callback.value}else{callback=''}}
if(undefined==returnreq){returnreq=!1}
if(undefined==abort_callback){if(undefined!=theform.abort_callback&&theform.abort_callback.type=='hidden'&&theform.abort_callback.value.length){abort_callback=theform.abort_callback.value}else{abort_callback=''}}
if(undefined==tmeout){tmeout=3600000}
if(tmeout<180000){tmeout=180000}
var lcsid=sid.toLowerCase();var cb=callback.toLowerCase();if(undefined==document.getElementById(sid)&&lcsid!='pop'&&lcsid!='null'&&lcsid!='modal'&&cb.indexOf('popupdiv')==-1&&cb.indexOf('centerpop')==-1&&lcsid.indexOf('popupdiv')==-1&&lcsid.indexOf('centerpop')==-1){alert('Error1 in ajaxPost\n'+sid+' is not defined as a valid object id');return!1}
if(typeof(AjaxRequest.ActiveAjaxGroupRequests[sid])!='undefined'){ajaxAbort(sid)}
var showprocessing=!0;if(undefined!=theform.setprocessing){if(theform.setprocessing.value.toLowerCase()=='false'){showprocessing=!1}
if(theform.setprocessing.value.toLowerCase()=='0'){showprocessing=!1}}else if(undefined!=theform.showprocessing){if(theform.showprocessing.value.toLowerCase()=='false'){showprocessing=!1}
if(theform.showprocessing.value.toLowerCase()=='0'){showprocessing=!1}}else if(undefined!=theform.noprocessing){if(theform.noprocessing.value.toLowerCase()=='true'){showprocessing=!1}
if(theform.noprocessing.value.toLowerCase()=='1'){showprocessing=!1}}
var showprocessingdiv=sid;if(undefined!=theform.showprocessingdiv){showprocessingdiv=theform.showprocessingdiv.value}else if(undefined!=theform.setprocessing){showprocessingdiv=theform.setprocessing.value}
var cp_title='';if(undefined!=theform.cp_title){cp_title=theform.cp_title.value}else if(undefined!=theform.centerpop_title){cp_title=theform.centerpop_title.value}
var title='';if(undefined!=theform.title){title=theform.title.value}
var AJUid=new Date().getTime()+"";var h=document.createElement('input');h.type='hidden';h.name='AjaxRequestUniqueId';h.value=AJUid;theform.appendChild(h);var getReq=AjaxRequest.submit(theform,{'groupName':sid,'timeout':tmeout,'callback':callback,'var2':cp_title,'var3':title,'abort_callback':abort_callback,'showprocessing':showprocessing,'showprocessingdiv':showprocessingdiv,'AjaxRequestUniqueId':AJUid,'onGroupBegin':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback;cb=cb.toLowerCase();if(cb.indexOf('centerpop')!=-1||lname.indexOf('centerpop')!=-1){var txt=getProcessingDiv(sid);popUpDiv('',{id:dname,width:300,height:50,notop:1,nobot:1,noborder:1,nobackground:1,bodystyle:"padding:0px;border:0px;background:none;"});var atitle='Processing Request';setCenterPopText(dname,txt,{title:atitle,drag:!1,close_bot:!1})}else if(lname=='modal'){let modal=wacss.modalPopup('<span class="icon-spin7 w_spin"></span>','Processing Request',{overlay:1})}else if(lname=='pop'){this.popNumber=popWindow(getProcessingDiv(sid),'processing request...')}else if(lname=='null'){}else if(this.showprocessing){setProcessing(this.showprocessingdiv)}},'onGroupEnd':function(req){},'onTimeout':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback;cb=cb.toLowerCase();var val="<b style=\"color:red\">ajaxPost Timed Out Error</b>";if(cb.indexOf('centerpop')!=-1||dname.indexOf('centerpop')!=-1){setCenterPopText(dname,val)}else if(lname=='modal'){let modal=wacss.modalPopup(val,'Timeout Error',{overlay:1})}else if(lname=='pop'){popText(this.popNumber,val,'timed out...')}else if(lname=='null'){removeId('centerpop')}else{setText(dname,val)}
if(undefined!=theform.setprocessing){setText(theform.setprocessing.value,'')}},'onError':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback;cb=cb.toLowerCase();var val='<div style="display:none" id="ajaxOnError">'+req.responseText+'</div>';if(cb.indexOf('centerpop')!=-1||dname.indexOf('centerpop')!=-1){setCenterPopText(dname,val)}else if(lname=='modal'){let modal=wacss.modalPopup(val,'ajaxPost Error',{overlay:1})}else if(lname=='pop'){popText(this.popNumber,val,'error')}else if(lname=='null'){removeId('centerpop')}else{setText(dname,val)}
if(undefined!=theform.setprocessing){setText(theform.setprocessing.value,'')}},'onSuccess':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback.toLowerCase();var val=req.responseText;ajaxids=GetElementsByAttribute('textarea','ajaxdiv',dname)
for(i=0;i<ajaxids.length;i++){var cid=ajaxids[i].id;tinyMCE.execCommand('mceRemoveControl',!1,cid)}
if(undefined!=theform.setprocessing){setText(theform.setprocessing.value,'')}
if(cb!=''){if(cb.indexOf('popupdiv')!=-1){popUpDiv(val,{id:dname,center:1,drag:1});centerObject(dname)}else if(lname=='pop'){popText(this.popNumber,val,this.var2)}else if(lname=='null'){removeId('centerpop')}else if(cb.indexOf('centerpop')!=-1){setCenterPopText(dname,val)}else if(cb=='modal'){let title='';if(this.var2.length){title=this.var2}else if(this.var3.length){title=this.var3}else{title='Success'}
let modal=wacss.modalPopup(val,title,{overlay:1})}else{window[this.callback](req,dname)}}else{if(lname.indexOf('popupdiv')!=-1){popUpDiv(val,{id:dname,center:1,drag:1});centerObject(dname)}else if(lname=='pop'){popText(this.popNumber,val,this.var2)}else if(lname=='null'){removeId('centerpop')}else if(lname.indexOf('centerpop')!=-1){setCenterPopText(dname,val)}else if(lname=='modal'){let title='';if(undefined!=this.var2&&this.var2.length){title=this.var2}else if(undefined!=this.var3&&this.var3.length){title=this.var3}else{title='Success'}
let modal=wacss.modalPopup(val,title,{overlay:1})}else if(document.getElementById(dname)){if(undefined==document.getElementById(dname).style.display||document.getElementById(dname).style.display=='none'){document.getElementById(dname).style.display='inline'}
var obj=getObject(dname);var behavior=obj.getAttribute('data-behavior');var id=obj.getAttribute('id');if(undefined!=behavior&&(behavior=='wysiwyg'||behavior=='richtext'||behavior=='tinymce'||behavior=='nicedit')&&undefined!=nicEditors[id]){nicEditors.findEditor(id).setContent(val)}
setText(dname,val)}else{}}
if(isFunction('f_tcalInit')){f_tcalInit()}
initBehaviors(dname)}});if(returnreq){return getReq}
return!1}
function updateCenterPopText(cpid,cptext,cptitle){let cp=getObject(cpid);if(undefined==cp){console.log('updateCenterPopText Error: No cp');return!1}
if(undefined==cptext){cptext=''}
if(undefined==cptitle){cptitle=''}
console.log(cp);if(cptext.length){let cpt=cp.querySelector('.w_centerpop_content');if(undefined!=cpt){console.log('updating centerpop content to'+cptext);setText(cpt,cptext)}else{console.log('updateCenterPopText Error: No cpt')}}
if(cptitle.length){let cptt=cp.querySelector('.w_centerpop_title');if(undefined!=cptt){setText(cptt,cptitle)}else{console.log('updateCenterPopText Error: No cptt')}}}
function setCenterPopText(cpid,cptext,params){if(undefined==params){params={}}
if(undefined==params.title){params.title=''}
if(undefined==params.drag){params.drag=!0}
if(undefined==params.close_top){params.close_top=!0}
if(undefined==params.close_bot){params.close_bot=!0}
if(undefined==params.center){params.center=!0}
var txt='';txt+='<div class="w_centerpop">'+"\n";if(params.title.length){txt+='	<div class="w_centerpop_title">'+params.title+'</div>'+"\n"}
if(params.close_top){txt+='	<div class="w_centerpop_close_top icon-cancel" title="Click to close" onclick="ajaxAbort(\''+cpid+'\');"></div>'+"\n"}
txt+='	<div class="w_centerpop_content">'+"\n";txt+='		'+cptext+"\n";txt+='	</div>'+"\n";txt+='	<img src="/wfiles/clear.gif" width="1" height="1" style="position:absolute;top:0px;right:5px;" onload="centerObject(\''+cpid+'\');" alt="" />'+"\n";if(params.close_bot){txt+='	<div class="w_centerpop_close_bot icon-cancel" style="font-size:18px;" title="Click to close" onclick="ajaxAbort(\''+cpid+'\');"></div>'+"\n"}
txt+='</div>'+"\n";setText(cpid,txt);if(params.center){centerObject(cpid)}
if(params.drag){var dObj=getObject(cpid);var dObjMove=document.querySelector('[class="w_centerpop_title"]');if(undefined!=dObjMove){Drag.init(dObjMove,dObj);dObjMove.style.position='relative';dObj.style.position='absolute'}}}
function callWaSQL(id,name,params){var url='/cgi-bin/wasql.pl';ajaxGet(url,name,'&_view='+id+'&'+params)}
function ajaxAbort(sid){console.log('ajaxAbort'+sid);if(sid=='modal'){wacss.modalClose();return!1}
if(typeof(AjaxRequest.ActiveAjaxGroupRequests[sid])!='undefined'){var req=AjaxRequest.ActiveAjaxGroupRequests[sid];if(undefined!=req.abort_callback&&req.abort_callback.length){req.status='aborted';window[req.abort_callback](req)}
req.xmlHttpRequest.abort();delete(req);if(sid.indexOf('centerpop')!=-1){removeId(sid)}else{setText(sid,req.prevValue)}
return!1}
if(sid.indexOf('centerpop')!=-1){removeId(sid)}else{setText(sid,'')}
return!1}
function ajaxGet(url,sid,xparams,callback,tmeout,nosetprocess,returnreq,newtitle,newurl,abort_callback,append){var params='';var cp_title='';var showprocessingdiv=sid;var showprocessing=!0;if(typeof(xparams)=='object'){if(undefined!=xparams.callback){callback=xparams.callback}
if(undefined!=xparams.abort_callback){abort_callback=xparams.abort_callback}
if(undefined!=xparams.timeout){tmeout=xparams.timeout}
if(undefined!=xparams.url){newurl=xparams.url}
if(undefined!=xparams.title){newtitle=xparams.title}
if(undefined!=xparams.append){append=xparams.append}
if(undefined!=xparams.nosetprocess){if(xparams.nosetprocess){showprocessing=!1}}else if(undefined!=xparams.showprocessing){if(!xparams.showprocessing){showprocessing=!1}}
if(undefined!=xparams.setprocessing){showprocessingdiv=xparams.setprocessing}else if(undefined!=xparams.showprocessingdiv){showprocessingdiv=xparams.showprocessingdiv}
if(undefined!=xparams.cp_title){cp_title=xparams.cp_title}
for(var key in xparams){if(key.indexOf("-")==0){continue}
if(key=='callback'){continue}
if(key=='append'){continue}
if(key=='abort_callback'){continue}
if(key=='timeout'){continue}
if(key=='nosetprocess'){continue}
if(key=='showprocessing'){continue}
if(key=='setprocessing'){continue}
if(key=='showprocessingdiv'){continue}
if(key=='cp_title'){continue}
params=params+key+'='+xparams[key]+'&'}}else{params=xparams}
if(undefined==newtitle){if(undefined!=xparams&&undefined!=xparams["-newtitle"]){newtitle=xparams["-newtitle"]}else{newtitle=''}}
if(undefined==newurl){if(undefined!=xparams&&undefined!=xparams["-newurl"]){newurl=xparams["-newurl"]}else{newurl=''}}
if(undefined==callback){callback=''}
if(undefined==abort_callback){abort_callback=''}
if(undefined==returnreq){returnreq=!1}
var guid=getCookie('GUID');if(undefined==tmeout){tmeout=3600000}
if(tmeout<180000){tmeout=180000}
if(undefined==nosetprocess){if(nosetprocess){showprocessing=!1}}
var lcsid=sid.toLowerCase();var cb=callback.toLowerCase();if(undefined==document.getElementById(sid)&&lcsid!='pop'&&lcsid!='modal'&&cb.indexOf('popupdiv')==-1&&cb.indexOf('centerpop')==-1&&lcsid.indexOf('popupdiv')==-1&&lcsid.indexOf('centerpop')==-1){alert('Error3 in ajaxGet\n'+sid+' is not defined as a valid object id in the DOM');return!1}
if(typeof(AjaxRequest.ActiveAjaxGroupRequests[sid])!='undefined'){ajaxAbort(sid)}
var getReq=AjaxRequest.get({'url':url+'?'+params,'callback':callback,'abort_callback':abort_callback,'showprocessing':showprocessing,'showprocessingdiv':showprocessingdiv,'timeout':tmeout,'var2':cp_title,'var3':newtitle,'var4':newurl,'var5':append,'groupName':sid,'prevValue':getText(sid),'onGroupBegin':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback.toLowerCase();if(cb.indexOf('centerpop')!=-1||lname.indexOf('centerpop')!=-1){var sidObj=getObject(sid);if(undefined==sidObj){var txt=getProcessingDiv(sid);popUpDiv('',{id:dname,width:300,height:50,notop:1,nobot:1,noborder:1,nobackground:1,bodystyle:"padding:10px;border:0px;background:#FFF;"});var atitle='Processing Request';setCenterPopText(dname,txt,{title:atitle,drag:!1,close_bot:!1})}
if(this.showprocessing){setProcessing(this.showprocessingdiv)}}else if(lname=='modal'){let modal=wacss.modalPopup('<span class="icon-spin7 w_spin"></span>','Processing Request',{overlay:1})}else if(lname=='pop'){this.popNumber=popWindow(getProcessingDiv(sid),'processing request...')}else if(this.showprocessing){setProcessing(this.showprocessingdiv)}},'onTimeout':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback.toLowerCase();var val="<b style=\"color:red\">ajaxGet Timed Out Error</b>";if(cb.indexOf('centerpop')!=-1||lname.indexOf('centerpop')!=-1){setCenterPopText(dname,val)}else if(lname=='modal'){let modal=wacss.modalPopup('ajaxGet Timed Out','Timed out Processing Request',{overlay:1})}else if(lname=='pop'){popText(this.popNumber,val,'timed out...')}else{setText(dname,val)}},'onError':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback.toLowerCase();var val='<div style="display:none" id="ajaxOnError">'+req.responseText+'</div>';if(cb.indexOf('centerpop')!=-1||lname.indexOf('centerpop')!=-1){setCenterPopText(dname,val)}else if(lname=='modal'){let modal=wacss.modalPopup(req.responseText,'Error Processing Request',{overlay:1})}else if(lname=='pop'){popText(this.popNumber,val,'error')}else{setText(dname,val)}},'onSuccess':function(req){var dname=this.groupName;var lname=dname.toLowerCase();var cb=this.callback.toLowerCase();var val=req.responseText;ajaxids=GetElementsByAttribute('textarea','ajaxdiv',dname)
for(i=0;i<ajaxids.length;i++){var cid=ajaxids[i].id;tinyMCE.execCommand('mceRemoveControl',!1,cid)}
if(this.var3.length>0&&this.var4.length>0){history.pushState(req.responseText,this.var3,this.var4)}
if(cb!=''){if(cb.indexOf('popupdiv')!=-1){var val=req.responseText;popUpDiv(val,{id:dname,center:1,drag:1});centerObject(dname)}else if(lname=='pop'){popText(this.popNumber,req.responseText,this.var2)}else if(cb.indexOf('centerpop')!=-1){if(undefined!=this.var2&&this.var2.length>0){setCenterPopText(dname,req.responseText,{title:this.var2})}else{setCenterPopText(dname,req.responseText)}}else if(lname=='modal'){let title='';if(this.var2.length){title=this.var2}else if(this.var3.length){title=this.var3}else{title='Success'}
let modal=wacss.modalPopup(req.responseText,title,{overlay:1})}else{window[this.callback](req,dname)}}else{var val=req.responseText;if(lname.indexOf('popupdiv')!=-1){popUpDiv(val,{id:dname,center:1,drag:1});centerObject(dname)}else if(lname=='pop'){popText(this.popNumber,req.responseText,this.var2)}else if(lname.indexOf('centerpop')!=-1){if(undefined!=this.var2&&this.var2.length>0){setCenterPopText(dname,req.responseText,{title:this.var2})}else{setCenterPopText(dname,req.responseText)}}else if(lname=='modal'){let title='';if(this.var2.length){title=this.var2}else if(this.var3.length){title=this.var3}else{title='Success'}
let modal=wacss.modalPopup(req.responseText,title,{overlay:1})}else if(document.getElementById(dname)){if(undefined==document.getElementById(dname).style.display||document.getElementById(dname).style.display=='none'){document.getElementById(dname).style.display='inline'}
var obj=getObject(dname);var behavior=obj.getAttribute('data-behavior');var id=obj.getAttribute('id');if(undefined!=behavior&&(behavior=='wysiwyg'||behavior=='richtext'||behavior=='tinymce'||behavior=='nicedit')&&undefined!=nicEditors[id]){nicEditors.findEditor(id).setContent(val)}
if(this.var5){val=getText(dname)+val}
setText(dname,val);if(undefined!=document.getElementById(dname).getAttribute('onshow')&&document.getElementById(dname).getAttribute('onshow')=='center'){document.getElementById(dname).style.position='absolute';centerObject(dname)}}else{}}
initBehaviors(dname)}});if(returnreq){return getReq}
return!1}
function newXmlHttpRequest(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else if(window.ActiveXObject){}else{return null}}
function wpassInput(v){if(!isNum(v)){return!0}
var obj=getObject('wpass_search');if(undefined==obj){return}
obj.value='';ajaxGet('/php/index.php','wpass_info',{_wpass:v});return!1}
function AjaxRequest(){var req=new Object();req.timeout=null;req.generateUniqueUrl=!0;req.url=window.location.href;req.method="GET";req.async=!0;req.username=null;req.password=null;req.xAttribute=null;req.xValue=null;req.xName=null;req.xAction=null;req.xId=null;req.prevValue=null;req.parameters=new Object();req.requestIndex=AjaxRequest.numAjaxRequests++;req.responseReceived=!1;req.showprocessing=!0;req.showprocessingdiv=null;req.groupName=null;req.callback=null;req.abort_callback=null;req.var1=null;req.var2=null;req.var3=null;req.var4=null;req.var5=null;req.AjaxRequestUniqueId=null;req.queryString="";req.responseText=null;req.responseXML=null;req.status=null;req.statusText=null;req.aborted=!1;req.xmlHttpRequest=null;req.onTimeout=null;req.onLoading=null;req.onLoaded=null;req.onInteractive=null;req.onComplete=null;req.onSuccess=null;req.onError=null;req.onGroupBegin=null;req.onGroupEnd=null;req.xmlHttpRequest=AjaxRequest.getXmlHttpRequest();if(req.xmlHttpRequest==null){return null}
req.xmlHttpRequest.onreadystatechange=function(){if(req==null||req.xmlHttpRequest==null){return}
if(req.xmlHttpRequest.readyState==1){req.onLoadingInternal(req)}
if(req.xmlHttpRequest.readyState==2){req.onLoadedInternal(req)}
if(req.xmlHttpRequest.readyState==3){req.onInteractiveInternal(req)}
if(req.xmlHttpRequest.readyState==4){req.onCompleteInternal(req)}};req.onLoadingInternalHandled=!1;req.onLoadedInternalHandled=!1;req.onInteractiveInternalHandled=!1;req.onCompleteInternalHandled=!1;req.onLoadingInternal=function(){if(req.onLoadingInternalHandled){return}
AjaxRequest.numActiveAjaxRequests++;if(AjaxRequest.numActiveAjaxRequests==1&&typeof(window.AjaxRequestBegin)=="function"){AjaxRequestBegin()}
if(req.groupName!=null){if(typeof(AjaxRequest.numActiveAjaxGroupRequests[req.groupName])=="undefined"){AjaxRequest.numActiveAjaxGroupRequests[req.groupName]=0;AjaxRequest.ActiveAjaxGroupRequests[req.groupName]=req}else{AjaxRequest.ActiveAjaxGroupRequests[req.groupName]=req}
AjaxRequest.numActiveAjaxGroupRequests[req.groupName]++;if(AjaxRequest.numActiveAjaxGroupRequests[req.groupName]==1&&typeof(req.onGroupBegin)=="function"){req.onGroupBegin(req.groupName)}}
if(typeof(req.onLoading)=="function"){req.onLoading(req)}
req.onLoadingInternalHandled=!0};req.onLoadedInternal=function(){if(req.onLoadedInternalHandled){return}
if(typeof(req.onLoaded)=="function"){req.onLoaded(req)}
req.onLoadedInternalHandled=!0};req.onInteractiveInternal=function(){if(req.onInteractiveInternalHandled){return}
if(typeof(req.onInteractive)=="function"){req.onInteractive(req)}
req.onInteractiveInternalHandled=!0};req.onCompleteInternal=function(){if(req.onCompleteInternalHandled||req.aborted){return}
req.onCompleteInternalHandled=!0;AjaxRequest.numActiveAjaxRequests--;if(AjaxRequest.numActiveAjaxRequests==0&&typeof(window.AjaxRequestEnd)=="function"){AjaxRequestEnd(req.groupName)}
if(req.groupName!=null){AjaxRequest.numActiveAjaxGroupRequests[req.groupName]--;delete(AjaxRequest.ActiveAjaxGroupRequests[req.groupName]);if(AjaxRequest.numActiveAjaxGroupRequests[req.groupName]==0&&typeof(req.onGroupEnd)=="function"){req.onGroupEnd(req.groupName)}}
req.responseReceived=!0;req.status=req.xmlHttpRequest.status;req.statusText=req.xmlHttpRequest.statusText;req.responseText=req.xmlHttpRequest.responseText;req.responseXML=req.xmlHttpRequest.responseXML;if(typeof(req.onComplete)=="function"){req.onComplete(req)}
if(req.xmlHttpRequest.status==200&&typeof(req.onSuccess)=="function"){req.onSuccess(req)}else if(typeof(req.onError)=="function"){req.onError(req)}
delete req.xmlHttpRequest.onreadystatechange;req.xmlHttpRequest=null};req.onTimeoutInternal=function(){if(req!=null&&req.xmlHttpRequest!=null&&!req.onCompleteInternalHandled){req.aborted=!0;req.xmlHttpRequest.abort();AjaxRequest.numActiveAjaxRequests--;if(AjaxRequest.numActiveAjaxRequests==0&&typeof(window.AjaxRequestEnd)=="function"){AjaxRequestEnd(req.groupName)}
if(req.groupName!=null){AjaxRequest.numActiveAjaxGroupRequests[req.groupName]--;delete(AjaxRequest.ActiveAjaxGroupRequests[req.groupName]);if(AjaxRequest.numActiveAjaxGroupRequests[req.groupName]==0&&typeof(req.onGroupEnd)=="function"){req.onGroupEnd(req.groupName)}}
if(typeof(req.onTimeout)=="function"){req.onTimeout(req)}
delete req.xmlHttpRequest.onreadystatechange;req.xmlHttpRequest=null}};req.process=function(){if(req.xmlHttpRequest!=null){if(req.generateUniqueUrl&&req.method=="GET"){req.parameters.AjaxRequestUniqueId=new Date().getTime()+""+req.requestIndex}
var content=null;for(var i in req.parameters){if(req.queryString.length>0){req.queryString+="&"}
req.queryString+=encodeURIComponent(i)+"="+encodeURIComponent(req.parameters[i])}
if(req.method=="GET"){if(req.queryString.length>0){req.url+=((req.url.indexOf("?")>-1)?"&":"?")+req.queryString}}
req.xmlHttpRequest.open(req.method,req.url,req.async,req.username,req.password);if(req.method=="POST"){if(typeof(req.xmlHttpRequest.setRequestHeader)!="undefined"){req.xmlHttpRequest.setRequestHeader('Content-type','application/x-www-form-urlencoded')}
content=req.queryString}
if(req.timeout>0){setTimeout(req.onTimeoutInternal,req.timeout)}
req.xmlHttpRequest.send(content)}};req.handleArguments=function(args){for(var i in args){if(typeof(req[i])=="undefined"){req.parameters[i]=args[i]}else{req[i]=args[i]}}};req.getAllResponseHeaders=function(){if(req.xmlHttpRequest!=null){if(req.responseReceived){return req.xmlHttpRequest.getAllResponseHeaders()}
alert("Cannot getAllResponseHeaders because a response has not yet been received")}};req.getResponseHeader=function(headerName){if(req.xmlHttpRequest!=null){if(req.responseReceived){return req.xmlHttpRequest.getResponseHeader(headerName)}
alert("Cannot getResponseHeader because a response has not yet been received")}};return req}
AjaxRequest.getXmlHttpRequest=function(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else if(window.ActiveXObject){}else{return null}};AjaxRequest.isActive=function(){return(AjaxRequest.numActiveAjaxRequests>0)};AjaxRequest.get=function(args){AjaxRequest.doRequest("GET",args)};AjaxRequest.post=function(args){AjaxRequest.doRequest("POST",args)};AjaxRequest.doRequest=function(method,args){if(typeof(args)!="undefined"&&args!==null){var myRequest=new AjaxRequest();myRequest.method=method;myRequest.handleArguments(args);myRequest.process()}};AjaxRequest.submit=function(theform,args){var myRequest=new AjaxRequest();if(myRequest===null){return!1}
var serializedForm=AjaxRequest.serializeForm(theform);myRequest.method=theform.method.toUpperCase();myRequest.url=theform.action;myRequest.handleArguments(args);myRequest.queryString=serializedForm;myRequest.process();return!0};AjaxRequest.serializeForm=function(theform){var els=theform.elements;if(undefined==els){alert('Ajax Request serializeForm failed');return!1}
var len=els.length;var queryString="";this.addField=function(name,value){if(queryString.length>0){queryString+="&"}
queryString+=encodeURIComponent(name)+"="+encodeURIComponent(value)};for(var i=0;i<len;i++){var el=els[i];if(!el.disabled){switch(el.type){case 'color':case 'date':case 'datetime':case 'datetime-local':case 'email':case 'month':case 'number':case 'range':case 'search':case 'tel':case 'time':case 'url':case 'week':case 'text':case 'password':case 'submit':case 'hidden':case 'textarea':this.addField(el.name,el.value);break;case 'select-one':if(el.selectedIndex>=0){this.addField(el.name,el.options[el.selectedIndex].value)}
break;case 'select-multiple':for(var j=0;j<el.options.length;j++){if(el.options[j].selected){this.addField(el.name,el.options[j].value)}}
break;case 'checkbox':case 'radio':if(el.checked){this.addField(el.name,el.value)}
break;default:break}}}
return queryString};AjaxRequest.numActiveAjaxRequests=0;AjaxRequest.numActiveAjaxGroupRequests=new Object();AjaxRequest.ActiveAjaxGroupRequests=new Object();AjaxRequest.numAjaxRequests=0;(function(){var test=document.createElement('input');try{test.type='range';if(test.type=='range'){return}}catch(e){return}
test.style.background='linear-gradient(red, red)';if(!test.style.backgroundImage||!('MozAppearance' in test.style)||!document.mozSetImageElement||!this.MutationObserver){return}
var scale;var isMac=navigator.platform=='MacIntel';var thumb={radius:isMac?9:6,width:isMac?22:12,height:isMac?16:20};var track='linear-gradient(transparent '+(isMac?'6px, #999 6px, #999 7px, #ccc 8px, #bbb 9px, #bbb 10px, transparent 10px':'9px, #999 9px, #bbb 10px, #fff 11px, transparent 11px')+', transparent)';var styles={'min-width':thumb.width+'px','min-height':thumb.height+'px','max-height':thumb.height+'px',padding:'0 0 '+(isMac?'2px':'1px'),border:0,'border-radius':0,cursor:'default','text-indent':'-999999px'};var options={attributes:!0,attributeFilter:['min','max','step','value']};var forEach=Array.prototype.forEach;var onChange=document.createEvent('HTMLEvents');onChange.initEvent('change',!0,!1);if(document.readyState=='loading'){document.addEventListener('DOMContentLoaded',initialize,commonPassiveEventListener(!0))}else{initialize()}
function initialize(){forEach.call(document.querySelectorAll('input[type=range]'),transform);new MutationObserver(function(mutations){mutations.forEach(function(mutation){if(mutation.addedNodes)
forEach.call(mutation.addedNodes,function(node){check(node);if(node.childElementCount)
forEach.call(node.querySelectorAll('input'),check)})})}).observe(document,{childList:!0,subtree:!0})}
function check(input){if(input.localName=='input'&&input.type!='range'&&input.getAttribute('type')=='range')
transform(input)}
function transform(slider){var isValueSet,areAttrsSet,isChanged,isClick,prevValue,rawValue,prevX;var min,max,step,range,value=slider.value;if(!scale){scale=document.body.appendChild(document.createElement('hr'));style(scale,{'-moz-appearance':isMac?'scale-horizontal':'scalethumb-horizontal',display:'block',visibility:'visible',opacity:1,position:'fixed',top:'-999999px'});document.mozSetImageElement('__sliderthumb__',scale)}
var getValue=function(){return''+value};var setValue=function setValue(val){value=''+val;isValueSet=!0;draw();delete slider.value;slider.value=value;slider.__defineGetter__('value',getValue);slider.__defineSetter__('value',setValue)};slider.__defineGetter__('value',getValue);slider.__defineSetter__('value',setValue);slider.__defineGetter__('type',function(){return'range'});['min','max','step'].forEach(function(prop){if(slider.hasAttribute(prop))
areAttrsSet=!0;slider.__defineGetter__(prop,function(){return this.hasAttribute(prop)?this.getAttribute(prop):''});slider.__defineSetter__(prop,function(val){val===null?this.removeAttribute(prop):this.setAttribute(prop,val)})});slider.readOnly=!0;style(slider,styles);update();new MutationObserver(function(mutations){mutations.forEach(function(mutation){if(mutation.attributeName!='value'){update();areAttrsSet=!0}else if(!isValueSet){value=slider.getAttribute('value');draw()}})}).observe(slider,options);slider.addEventListener('mousedown',onDragStart,commonPassiveEventListener(!0));slider.addEventListener('keydown',onKeyDown,commonPassiveEventListener(!0));slider.addEventListener('focus',onFocus,commonPassiveEventListener(!0));slider.addEventListener('blur',onBlur,commonPassiveEventListener(!0));function onDragStart(e){isClick=!0;setTimeout(function(){isClick=!1},0);if(e.button||!range)
return;var width=parseFloat(getComputedStyle(this,0).width);var multiplier=(width-thumb.width)/range;if(!multiplier)
return;var dev=e.clientX-this.getBoundingClientRect().left-thumb.width/2-(value-min)*multiplier;if(Math.abs(dev)>thumb.radius){isChanged=!0;this.value-=-dev/multiplier}
rawValue=value;prevX=e.clientX;this.addEventListener('mousemove',onDrag,commonPassiveEventListener(!0));this.addEventListener('mouseup',onDragEnd,commonPassiveEventListener(!0))}
function onDrag(e){var width=parseFloat(getComputedStyle(this,0).width);var multiplier=(width-thumb.width)/range;if(!multiplier)
return;rawValue+=(e.clientX-prevX)/multiplier;prevX=e.clientX;isChanged=!0;this.value=rawValue}
function onDragEnd(){this.removeEventListener('mousemove',onDrag,!0);this.removeEventListener('mouseup',onDragEnd,!0)}
function onKeyDown(e){if(e.keyCode>36&&e.keyCode<41){onFocus.call(this);isChanged=!0;this.value=value+(e.keyCode==38||e.keyCode==39?step:-step)}}
function onFocus(){if(!isClick)
this.style.boxShadow=!isMac?'0 0 0 2px #fb0':'inset 0 0 20px rgba(0,127,255,.1), 0 0 1px rgba(0,127,255,.4)'}
function onBlur(){this.style.boxShadow=''}
function isAttrNum(value){return!isNaN(value)&&+value==parseFloat(value)}
function update(){min=isAttrNum(slider.min)?+slider.min:0;max=isAttrNum(slider.max)?+slider.max:100;if(max<min)
max=min>100?min:100;step=isAttrNum(slider.step)&&slider.step>0?+slider.step:1;range=max-min;draw(!0)}
function calc(){if(!isValueSet&&!areAttrsSet)
value=slider.getAttribute('value');if(!isAttrNum(value))
value=(min+max)/2;value=Math.round((value-min)/step)*step+min;if(value<min)
value=min;else if(value>max)
value=min+~~(range/step)*step}
function draw(attrsModified){calc();if(isChanged&&value!=prevValue)
slider.dispatchEvent(onChange);isChanged=!1;if(!attrsModified&&value==prevValue)
return;prevValue=value;var position=range?(value-min)/range*100:0;var bg='-moz-element(#__sliderthumb__) '+position+'% no-repeat, ';style(slider,{background:bg+track})}}
function style(element,styles){for(var prop in styles){element.style.setProperty(prop,styles[prop],'important')}}})();