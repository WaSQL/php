function wd3TreeMap(p,params){if(undefined==p){p='body'}
var pObj=document.querySelector(p);if(undefined==pObj){console.log('wd3TreeMap Error: undefined parent');return}
if(undefined==params){params={}}
if(undefined==params.top){params.top=20}
if(undefined==params.right){params.right=20}
if(undefined==params.bottom){params.bottom=30}
if(undefined==params.left){params.left=50}
if(undefined==params.width){params.width=getWidth(pObj)-params.left-params.right}
if(undefined==params.height){params.height=getHeight(pObj)-params.top-params.bottom}
if(params.height<20){params.height=300}
if(params.width<20){params.width=300}
if(undefined!=params.debug){console.log('Params:',params)}
var w=params.width,h=params.height,x=d3.scale.linear().range([0,params.width]),y=d3.scale.linear().range([0,params.height]),color=d3.scale.category20c(),root,node;var treemap=d3.layout.treemap().round(!1).size([w,h]).sticky(!0).children(function(d){return d.values}).value(function(d){return d.size});console.log(treemap);if(undefined==document.querySelector(p+' div')){var div=d3.select(p).append("div").style("position","relative").style("width",(params.width)+"px").style("height",(params.height)+"px").style("left",params.left+"px").style("top",params.top+"px").style("border","1px solid blue")}else{var div=d3.select(p)}
d3.csv(params.csv,function(data){node=root={values:d3.nest().key(function(d){return d.parent}).rollup(function(d){return d.map(function(d){return{key:d.name}})}).entries(data)};var node=div.datum(root).selectAll(".node").data(treemap.nodes).enter().append("div").attr("class","node").call(position).style("background",function(d){return d.children?color(d.name):null}).text(function(d){return d.children?null:d.name});d3.selectAll("input").on("change",function change(){var value=this.value==="count"?function(){return 1}:function(d){return d.size};node.data(treemap.value(value).nodes).transition().duration(1500).call(position)})});function position(){this.style("left",function(d){return d.x+"px"}).style("top",function(d){return d.y+"px"}).style("width",function(d){return Math.max(0,d.dx-1)+"px"}).style("height",function(d){return Math.max(0,d.dy-1)+"px"}).style("border","1px solid white").style("font","10px sans-serif").style("line-height","12px").style("overflow","hidden").style("position","absolute").style("text-indent","2px")}}
function wd3LineChart(p,params){if(undefined==p){p='body'}
var pObj=document.querySelector(p);if(undefined==pObj){console.log('wd3LineChart Error: undefined parent');return}
if(undefined==params){params={}}
if(undefined==params.top){params.top=20}
if(undefined==params.right){params.right=20}
if(undefined==params.bottom){params.bottom=30}
if(undefined==params.left){params.left=50}
if(undefined==params.width){params.width=getWidth(pObj)-params.left-params.right}
if(undefined==params.height){params.height=getHeight(pObj)-params.top-params.bottom}
if(undefined==params.padding){params.padding=1}
if(undefined==params.yticks){params.yticks=Math.round(params.height/30)}
if(undefined==params.xticks){params.xticks=Math.round(params.width/30)}
if(undefined==params.xtype){params.xtype='date'}
if(undefined==params.label){params.label='label'}
if(undefined==params.duration){params.padding=10}
if(params.height<20){params.height=300}
if(params.width<20){params.width=300}
if(undefined!=params.debug){console.log('Params:',params)}
var color=d3.scale.category20();var yAxisLabelOffset=40;var innerWidth=params.width-params.left-params.right;var innerHeight=params.height-params.top-params.bottom;if(undefined!=params.debug){console.log('innerWidth:',innerWidth)}
if(undefined!=params.debug){console.log('innerHeight:',innerHeight)}
if(undefined==document.querySelector(p+' svg')){var svg=d3.select(p).append("svg").attr("width",params.width).attr("height",params.height);var g=svg.append("g").attr("transform","translate("+params.left+","+params.top+")").attr("data-g","one");var legend=d3.select(p).append("div").attr("class","legend").style("margin-left",params.left+'px').style("margin-right",params.right+'px');var xAxisG=g.append("g").style("stroke",'grey').style("fill","none").style("stroke-width","1px").attr("class","x-axis").attr("transform","translate(0,"+innerHeight+")")
var yAxisG=g.append("g").attr("class","y-axis").style("stroke",'grey').style("fill","none").style("stroke-width","1px");var yAxisLabel=yAxisG.append("text").style("text-anchor","middle").attr("transform","translate(-"+yAxisLabelOffset+","+(innerHeight/2)+") rotate(-90)").attr("class","label")}else{var svg=d3.select(p+' svg');var legend=d3.select(p+' div.legend');var g=d3.select(p+' svg g[data-g=one]');var path=d3.select(p+' svg g[data-g=one] path');var xAxisG=d3.select(p+' svg g.x-axis');var xAxisLabel=d3.select(p+' svg g.x-axis text');var yAxisG=d3.select(p+' svg g.y-axis');var yAxisLabel=d3.select(p+' svg g.y-axis text')}
switch(params.xtype.toLowerCase()){case 'num':var xScale=d3.scale.linear().range([0,innerWidth]);break;default:var xScale=d3.time.scale().range([0,innerWidth]);break}
var yScale=d3.scale.linear().range([innerHeight,0]);var xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(5).outerTickSize(0);if(undefined!=params.xformat){xAxis.tickFormat(d3.format(params.xformat))}
var yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(5).outerTickSize(0);if(undefined!=params.yformat){yAxis.tickFormat(d3.format(params.yformat))}
function loadline(data){if(undefined==data[0]){return}
var keys=Object.keys(data[0]);var ykeys=new Array();var ykeysClass={};for(var z=0;z<keys.length;z++){var ckey=keys[z];if(keys[z]!=params.label){ykeys.push(keys[z]);ykeysClass[keys[z]]='cls_'+keys[z].replace(/[^a-z0-9]/ig,'')}}
data.forEach(function(d){switch(params.xtype.toLowerCase()){case 'num':d[params.label]=+d[params.label];break;case 'date':d[params.label]=new Date(d[params.label]);break}
for(var z=0;z<ykeys.length;z++){var ykey=ykeys[z];d[ykey]=+d[ykey]}});if(undefined!=params.debug){console.log('data:',data);console.log('keys:',keys);console.log('ykeys:',ykeys);console.log('label:',params.label)}
var lines={};for(var z=0;z<ykeys.length;z++){var ykey=ykeys[z];lines[ykey]=d3.svg.line().interpolate("basis").x(function(d){return xScale(d[params.label])}).y(function(d){return yScale(+d[ykey])})}
if(undefined!=params.debug){console.log('lines: ',lines)}
xScale.domain(d3.extent(data,function(d){return d[params.label]}));yScale.domain([d3.min(data,function(d){var ydata=new Array();for(var z=0;z<ykeys.length;z++){var ykey=ykeys[z];ydata.push(+d[ykey])}
return Math.min.apply(null,ydata)})+-1,d3.max(data,function(d){var ydata=new Array();for(var z=0;z<ykeys.length;z++){var ykey=ykeys[z];ydata.push(+d[ykey])}
return Math.max.apply(null,ydata)})+1]);xAxisG.call(xAxis);yAxisG.call(yAxis);var plines=g.selectAll("path.line")[0];if(undefined!=params.debug){console.log('plines: ',plines)}
legend.selectAll("span").remove();for(var z=0;z<ykeys.length;z++){var ykey=ykeys[z];var clegend=legend.append("span");clegend.append("span").attr("class","icon-blank").style("color",color.range()[z]);clegend.append("span").text(' '+ykey+' ');var linegraph=g.selectAll("path.line."+ykeysClass[ykey]);if(undefined!=params.debug){console.log('linegraph: ',linegraph)}
for(var b=0;b<plines.length;b++){if(undefined==plines[b].getAttribute('class')){continue}
var val=plines[b].getAttribute('class');if(undefined==val){continue}
var s=val.indexOf(ykeysClass[ykey]);if(s!=-1){plines.splice(b,1)}}
if(linegraph.empty()){linegraph=g.append("path").attr("class","line "+ykeysClass[ykey]).style("stroke",color.range()[z]).style("fill","none").style("stroke-width","2px")}
linegraph.transition().ease("linear").duration(500).style("stroke",color.range()[z]).attr("d",lines[ykey](data))}
if(undefined!=params.debug){console.log('remove plines: ',plines)}
for(var b=0;b<plines.length;b++){plines[b].remove()}
params={};lines={}}
if(undefined!=params.csv){if(undefined!=params.debug){console.log('loading csv')}
d3.csv(params.csv,loadline)}else if(undefined!=params.tsv){if(undefined!=params.debug){console.log('loading tsv')}
d3.tsv(params.tsv,loadline)}else if(undefined!=params.json){if(undefined!=params.debug){console.log('loading json')}
d3.json(params.json,loadline)}else if(undefined!=params.data){if(undefined!=params.debug){console.log('loading data')}
loadline(params.data)}else{if(undefined!=params.debug){console.log('loading random data')}
loadline(wd3RandomLineData())}
return!1}
var wd3MapChartMaps=new Array();function wd3MapChart(p,params){if(undefined==d3){alert('d3 library is not loaded');return!1}
if(undefined==p){p='body'}
var pObj=document.querySelector(p);if(undefined==pObj){console.log('wd3MapChart Error: undefined parent');return}
if(undefined==params){params={}}
if(undefined==params.width){params.width=getWidth(pObj)}
if(undefined==params.height){params.height=getHeight(pObj)}
if(undefined!=params.debug){console.log(params)}
if(params.height<20){params.height=250}
if(params.width<20){params.width=350}
if(undefined==params.color){params.color='#006400'}
var fills={}
var fillcolor=params.color;var most=fillcolor;var least='';for(var i=0;i<50;i++){var r=i+1;var key='fill'+r;fills[key]=fillcolor;fillcolor=d3.rgb(fillcolor).brighter(0.1);least=fillcolor}
fills.defaultFill='#f0f0f0';if(undefined==document.querySelector(p+' .datamap')){var chartParams={"width":params.width,"height":params.height,"scope":"usa","class":"haha","fills":fills,"element":document.querySelector(p),data:{},"legend":!1,"labels":!0,"id":"map","geographyConfig":{"popupTemplate":function(geography,data){return'<div class=hoverinfo><strong>'+geography.properties.name+': '+wd3NumberWithCommas(data.value)+'</strong></div>'}}}
wd3MapChartMaps[p]=new Datamap(chartParams);if(chartParams.legend){wd3MapChartMaps[p].legend()}
if(chartParams.labels){wd3MapChartMaps[p].labels()}
if(undefined!=params.onclick){d3.selectAll(p+' .datamaps-subunit').on('click',function(geography){if(undefined==window[params.onclick]){console.log('wd3MapChart onclick error: "'+params.onclick+'" is not a valid function');return!1}
var args=new Array();args.push(d3.select(this).attr("data-label"));args.push(d3.select(this).attr("data-value"));window[params.onclick].apply(this,args)})}
var txt='<div><span class="icon-blank" style="color:'+most+'"></span> Most <span id="most"></span></div>';txt+='<div><span class="icon-blank" style="color:'+least+'"></span> Least <span id="least"></span></div>';txt+='<div><span class="icon-blank" style="color:'+fills.defaultFill+'"></span> None <span id="none"></span></div>';d3.select(p).append("div").attr("class","legend w_big").html(txt)}
if(undefined!=params.csv){if(undefined!=params.debug){console.log('loading csv')}
d3.csv(params.csv,function(error,data){var cdata=data;for(var i=0;i<data.length;i++){cdata[cdata[i].id]=cdata[i];delete cdata[i].id;delete cdata[i]}
for(var key in cdata){d3.select(p+' #most').text(key+' ('+wd3NumberWithCommas(cdata[key].value)+')');break}
var lkey='';for(var key in cdata){if(cdata[key].value>0){lkey=key}}
if(lkey.length){d3.select(p+' #least').text(lkey+' ('+wd3NumberWithCommas(cdata[lkey].value)+')')}
wd3MapChartMaps[p].updateChoropleth(cdata);if(undefined!=params.onclick){for(var key in cdata){d3.select(p+' .datamaps-subunit.'+key).attr("data-value",+cdata[key].value).attr("data-label",+key)}}})}else if(undefined!=params.tsv){if(undefined!=params.debug){console.log('loading tsv')}
d3.tsv(params.tsv,function(error,data){var cdata=data;for(var i=0;i<data.length;i++){cdata[cdata[i].id]=cdata[i];delete cdata[i].id;delete cdata[i]}
wd3MapChartMaps[p].updateChoropleth(cdata);if(undefined!=params.onclick){for(var key in cdata){d3.select(p+' .datamaps-subunit.'+key).attr("data-value",+cdata[key].value).attr("data-label",+key)}}})}else if(undefined!=params.json){if(undefined!=params.debug){console.log('loading json')}
d3.json(params.json,function(error,data){var cdata=data;for(var i=0;i<data.length;i++){cdata[cdata[i].id]=cdata[i];delete cdata[i].id;delete cdata[i]}
wd3MapChartMaps[p].updateChoropleth(cdata);if(undefined!=params.onclick){for(var key in cdata){d3.select(p+' .datamaps-subunit.'+key).attr("data-value",+cdata[key].value).attr("data-label",+key)}}})}else if(undefined!=params.data){if(undefined!=params.debug){console.log('loading data')}
wd3MapChartMaps[p].updateChoropleth(params.data)}
return!1}
function wd3NumberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
function wd3BarChart(p,params){if(undefined==d3){alert('d3 library is not loaded');return!1}
if(undefined==p){p='body'}
var pObj=document.querySelector(p);if(undefined==pObj){console.log('wd3BarChart Error: undefined parent');return}
if(undefined==params){params={}}
if(undefined==params.width){params.width=getWidth(pObj)}
if(undefined==params.height){params.height=getHeight(pObj)}
if(undefined==params.top){params.top=30}
if(undefined==params.right){params.right=55}
if(undefined==params.bottom){params.bottom=50}
if(undefined==params.left){params.left=80}
if(undefined==params.padding){params.padding=1}
if(undefined==params.yticks){params.yticks=10}
if(undefined==params.label){params.label='label'}
if(undefined==params.duration){params.duration=300}
if(undefined!=params.debug){console.log(params)}
if(undefined==params.ylabel){params.ylabel=''}
if(undefined==params.xlabel){params.xlabel=''}
if(undefined==params.ylabeloffset){params.ylabeloffset=-50}
if(undefined==params.rightlabel){params.rightlabel=''}
if(params.height<20){params.height=300}
if(params.width<20){params.width=300}
params.width=params.width-params.left-params.right,params.height=params.height-params.top-params.bottom;var color=d3.scale.category20();var x=d3.scale.ordinal().rangeRoundBands([0,params.width],.1);var y=d3.scale.linear().range([params.height,0]);var xAxis=d3.svg.axis().scale(x).orient("bottom").ticks(params.xticks);if(undefined!=params.xformat){xAxis.tickFormat(d3.format(params.xformat))}
var yAxis=d3.svg.axis().scale(y).orient("left").ticks(params.yticks);if(undefined!=params.yformat){yAxis.tickFormat(d3.format(params.yformat))}
if(undefined!=params.rightvalue){var linecolor=color.range()[2];var rightline=d3.svg.line().x(function(d){return x(d.label)+10}).y(function(d){return yLine(d.linevalue)});var yLine=d3.scale.linear().range([params.height,0]);if(undefined==params.rightticks){params.rightticks=10}
var yAxisLine=d3.svg.axis().scale(yLine).orient("right").ticks(params.rightticks);if(undefined!=params.rightformat){yAxisLine.tickFormat(d3.format(params.rightformat))}}
if(undefined==document.querySelector(p+' svg')){if(undefined!=params.debug){console.log('new bar chart - adding svg')}
d3.select(p).append("div").attr("class","title text-center").text("");var svg=d3.select(p).append("svg").attr("width",params.width+params.left+params.right).attr("height",params.height+params.top+params.bottom).append("g").attr("transform","translate("+params.left+","+params.top+")");svg.append("g").attr("class","x axis").attr("transform","translate(0,"+params.height+")");svg.append("g").attr("class","y axis").append("text").attr("text-anchor","middle").attr("transform","translate("+params.padding+","+(params.height/2)+")rotate(-90)").attr("y",params.ylabeloffset).attr("dy",".71em").style("text-anchor","end").text(params.ylabel);if(undefined!=params.rightvalue){if(undefined==params.rightlabel){params.rightlabel=''}
svg.append("g").attr("class","y axisline").attr("transform","translate("+params.width+" ,0)").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","start").text(params.rightlabel)}}else{if(undefined!=params.debug){console.log('existing chart - updating')}
var svg=d3.select(p+' svg')}
function loadbar(data){data.forEach(function(d){d.value=+d.value;if(undefined!=params.rightvalue){d.linevalue=+d[params.rightvalue]}});x.domain(data.map(function(d){return d.label}));y.domain([0,d3.max(data,function(d){return d.value})]);if(undefined!=params.rightvalue){yLine.domain([0,d3.max(data,function(d){return d.linevalue})])}
svg.select('.x.axis').transition().duration(300).call(xAxis).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(90)").style("text-anchor","start");svg.select(".y.axis").transition().duration(300).call(yAxis);if(undefined!=params.rightvalue){svg.select(".y.axisline").transition().duration(300).call(yAxisLine)}
var bars=svg.selectAll("rect").data(data,function(d){return d.label});bars.exit().transition().duration(300).attr("y",y(0)).attr("height",params.height-y(0)).style('fill-opacity',1e-6).remove();bars.enter().append("rect").attr("fill",color.range()[0]).attr("y",y(0)).attr("height",params.height-y(0)).attr("data-value",function(d){return d.value}).attr("data-label",function(d){return d.label}).on("mouseover",function(){var fill=d3.select(this).style("fill");d3.select(this).attr("fill_ori",fill);d3.select(this).style("fill",d3.rgb(fill).darker(0.3))}).on("mouseout",function(){var fill=d3.select(this).attr("fill_ori");d3.select(this).style("fill",fill)}).on("click",function(){if(undefined!=params.onclick){if(undefined==window[params.onclick]){console.log('wd3MapChart onclick error: "'+params.onclick+'" is not a valid function');return!1}
var args=new Array();args.push(d3.select(this).attr("data-label"));args.push(d3.select(this).attr("data-value"));window[params.onclick].apply(this,args)}else{return!1}});bars.transition().duration(300).attr("x",function(d){return x(d.label)}).attr("width",x.rangeBand()).attr("y",function(d){return y(d.value)}).attr("height",function(d){return params.height-y(d.value)});if(undefined!=params.rightvalue){var line=svg.selectAll("path.line").data(data,function(d){return d.label});line.exit().transition().duration(300).remove();line.enter().append("path").attr("class","line").style("fill","none").style("stroke",linecolor).style("stroke-width","3").style("z-index","999").attr("d",rightline(data));line.transition().duration(300).attr("d",rightline(data))}}
if(undefined!=params.csv){if(undefined!=params.debug){console.log('loading csv')}
d3.csv(params.csv,loadbar)}else if(undefined!=params.tsv){if(undefined!=params.debug){console.log('loading tsv')}
d3.tsv(params.tsv,loadbar)}else if(undefined!=params.json){if(undefined!=params.debug){console.log('loading json')}
d3.json(params.json,loadbar)}else if(undefined!=params.data){if(undefined!=params.debug){console.log('loading data')}
loadbar(params.data)}
return!1}
function wd3PieChart(p,params){if(undefined==d3){alert('d3 library is not loaded');return!1}
if(undefined==p){p='body'}
var pObj=document.querySelector(p);if(undefined==pObj){console.log('wd3PieChart Error: undefined parent');return}
if(undefined==params){params={}}
if(undefined==params.width){params.width=getWidth(pObj)}
if(undefined==params.height){params.height=getHeight(pObj)}
if(undefined==params.padding){params.padding=20}
if(undefined==params.labels){params.labels=1}
if(undefined==params.legend){params.legend=1}
if(undefined!=params.debug){console.log(params)}
if(params.height<20){params.height=300}
if(params.width<20){params.width=300}
var color=d3.scale.category20();if(undefined==document.querySelector(p+' svg')){if(undefined!=params.debug){console.log('new chart - adding svg')}
var svg=d3.select(p).append("svg").attr("width",params.width).attr("height",params.height).append("g");if(undefined!=params.type&&params.type=='donut'){svg.append("text").attr("class","title").attr("text-anchor","middle").attr("transform","translate(0,4)").text("")}else{d3.select(p).append("div").attr("class","title text-center").text("")}
svg.append("g").attr("class","slices");if(params.labels==1){svg.append("g").attr("class","labels");svg.append("g").attr("class","lines")}
if(params.legend==1){d3.select(p).append("div").attr("class","legend").text("")}
svg.attr("transform","translate("+params.width/2+","+params.height/2+")")}else{if(undefined!=params.debug){console.log('existing chart - updating')}
var svg=d3.select(p+' svg')}
var radius=Math.round(Math.min(params.width,params.height)/2)-params.padding;if(undefined!=params.type&&params.type=='donut'){if(undefined==params.donut){params.donut=.4}
var arc=d3.svg.arc().outerRadius(radius*0.8).innerRadius(radius*params.donut)}else{var arc=d3.svg.arc().outerRadius(radius*0.85).innerRadius(0)}
if(params.labels==1){var outerArc=d3.svg.arc().innerRadius(radius*0.9).outerRadius(radius*0.9)}
var key=function(d){return d.data.label};var pie=d3.layout.pie().value(function(d){return d.value}).sort(null);function loadpie(data){data.forEach(function(d){d.value=+d.value});var totals=d3.sum(data,function(d){return d.value});data.forEach(function(d){d.percent=Math.round((d.value/totals)*100,1)});var slice=svg.select(".slices").selectAll("path.slice").data(pie(data),key);slice.enter().insert("path").style("fill",function(d,i){if(undefined!=params.debug){console.log('new slice:i='+i+',color='+color.range()[i]+', label='+d.data.label)}
return color.range()[i]}).style("stroke","#FFF").style("stroke-width","1px").attr("class","slice");slice.attr("data-percent",function(d){return d.data.percent});slice.attr("data-value",function(d){return d.data.value});slice.attr("data-label",function(d){return d.data.label});slice.attr("id",function(d,i){return'slice'+i});slice.on("mouseover",function(){var fill=d3.select(this).style("fill");d3.select(this).attr("fill_ori",fill);d3.select(this).style("fill",d3.rgb(fill).darker(0.3));d3.select(p+' .title').text(d3.select(this).attr("data-percent")+'%')});slice.on("mouseout",function(){var fill=d3.select(this).attr("fill_ori");d3.select(this).style("fill",fill);d3.select(p+' .title').text("")});if(undefined!=params.onclick){slice.on("click",function(){if(undefined==window[params.onclick]){console.log('wd3MapChart onclick error: "'+params.onclick+'" is not a valid function');return!1}
var args=new Array();args.push(d3.select(this).attr("data-label"));args.push(d3.select(this).attr("data-value"));args.push(d3.select(this).attr("data-percent"));window[params.onclick].apply(this,args)})}
slice.transition().duration(1000).attrTween("d",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){return arc(interpolate(t))}});slice.exit().remove();if(params.labels==1){var text=svg.select(".labels").selectAll("text").data(pie(data),key);text.enter().append("text").attr("dy",".35em").text(function(d){return d.data.label});function midAngle(d){return d.startAngle+(d.endAngle-d.startAngle)/2}
text.transition().duration(1000).attrTween("transform",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);var pos=outerArc.centroid(d2);if(midAngle(d2)<Math.PI){pos[0]=radius-12}else{pos[0]=(radius*-1)+12}
return"translate("+pos+")"}}).styleTween("text-anchor",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);return midAngle(d2)<Math.PI?"start":"end"}});text.exit().remove();var polyline=svg.select(".lines").selectAll("polyline").data(pie(data),key);polyline.enter().append("polyline");polyline.transition().duration(1000).attrTween("points",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);return function(t){var d2=interpolate(t);var pos=outerArc.centroid(d2);pos[0]=radius*0.91*(midAngle(d2)<Math.PI?1:-1);return[arc.centroid(d2),outerArc.centroid(d2),pos]}});polyline.exit().remove()}
if(params.legend==1){var legend=d3.select(p+" div.legend").selectAll("span.item").data(pie(data),key).enter().append("span").attr("class","item").style("min-width","150px").attr("data-percent",function(d){return d.data.percent}).attr("data-value",function(d){return d.data.value}).attr("data-label",function(d){return d.data.label}).attr("data-color",function(d,i){return color.range()[i]}).attr("data-id",function(d,i){return'slice'+i});if(undefined!=params.legend_block){legend.style("display",'block')}
legend.append("span").attr("class","icon-blank w_big").style("margin-left","3px").style("color",function(d,i){return color.range()[i]});legend.insert("span").text(function(d){return' '+d.data.label});legend.on("mouseover",function(){var c=d3.rgb(this.getAttribute('data-color')).darker(0.3);d3.select(p+' .title').text(d3.select(this).attr("data-percent")+'%');this.style.color=c;if(undefined!=params.onclick){this.style.cursor='pointer'}});legend.on("mouseout",function(){d3.select(p+' .title').text("");this.style.color=''});if(undefined!=params.onclick){legend.on("click",function(){if(undefined==window[params.onclick]){console.log('wd3MapChart onclick error: "'+params.onclick+'" is not a valid function');return!1}
var args=new Array();args.push(d3.select(this).attr("data-label"));args.push(d3.select(this).attr("data-value"));args.push(d3.select(this).attr("data-percent"));window[params.onclick].apply(this,args)})}
d3.select(p+" div.legend").selectAll("span.item").data(pie(data),key).exit().remove()}}
if(undefined!=params.csv){if(undefined!=params.debug){console.log('loading csv')}
d3.csv(params.csv,loadpie)}else if(undefined!=params.tsv){if(undefined!=params.debug){console.log('loading tsv')}
d3.tsv(params.tsv,loadpie)}else if(undefined!=params.json){if(undefined!=params.debug){console.log('loading json')}
d3.json(params.json,loadpie)}else if(undefined!=params.data){if(undefined!=params.debug){console.log('loading data')}
loadpie(params.data)}else{if(undefined!=params.debug){console.log('loading random data')}
loadpie(wd3RandomPieData())}
return!1}
function wd3RandomPieData(){var x=d3.scale.ordinal().domain(["Lorem ipsum","dolor sit","amet","consectetur","adipisicing","eiusmod","tempor","incididunt"]);var labels=x.domain();return labels.map(function(label){return{label:label,value:Math.random()}})}