var wacss={version:'2022.0501',author:'WaSQL.com',chartjs:{},addClass:function(element,classToAdd){element=wacss.getObject(element);if(undefined==element){return!1}
if(undefined==element.className){element.className=classToAdd;return!0}
let currentClassValue=element.className;if(currentClassValue.indexOf(classToAdd)==-1){if((currentClassValue==null)||(currentClassValue==="")){element.className=classToAdd}else{element.className+=" "+classToAdd}}},blink:function(el){el=wacss.getObject(el);if(undefined==el){return}
let blink=0;if(undefined==el.getAttribute('data-blink')){el.setAttribute('data-blink',1);el.setAttribute('data-boxshadow',el.style.boxShadow)}else{blink=parseInt(el.getAttribute('data-blink'),10)}
let n=blink+1;el.setAttribute('data-blink',n);switch(blink){case 0:case 2:case 4:el.style.boxShadow='0 8px 12px 0 rgba(0,0,0,0.7),0 10px 24px 0 rgba(0,0,0,0.69)';setTimeout(function(){wacss.blink(el)},150);break;case 1:case 3:case 5:el.style.boxShadow='0 8px 12px 0 rgba(0,0,0,0.2),0 10px 24px 0 rgba(0,0,0,0.19)';setTimeout(function(){wacss.blink(el)},150);break;default:el.style.boxShadow=el.getAttribute('data-boxshadow');el.setAttribute('data-blink',0);break}},buildFormColor:function(fieldname,params){if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
var iconid=params.id+'_icon';params.width=115;var iconcolor='#c0c0c0';if(undefined!=params.value){iconcolor=params.value}
if(undefined==params.placeholder){params.placeholder='#HEXVAL'}
if(undefined==params.classname){params.classname='form-control input'}
params.maxlength=7;var tagdiv=document.createElement("div");tagdiv.className="input-group";tagdiv.style.width=params.width+'px';var tag=document.createElement("input");tag.type='text';tag.maxlength=7;tag.className=params.classname;tag.style.fontSize='11px';tag.style.fontFamily='arial';tag.name=fieldname;tag.id=params.id;if(params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.value){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
tag.classname=params.classname;tag.placeholder=params.placeholder;tagdiv.appendChild(tag);var tagspan=document.createElement("span");tagspan.id=iconid;tagspan.setAttribute('onclick',"return colorSelector('"+params.id+"');");tagspan.className="icon-color-adjust w_bigger w_pointer input-group-addon";tagspan.style.color=iconcolor+';padding-left:3px !important;padding-right:6px !important;';tagspan.title='Color Selector';tagdiv.appendChild(tagspan);if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tagdiv)}else{console.log(params['-parent']+' does not exist')}}
return tagdiv},buildFormSelect:function(fieldname,opts,params){if(undefined==fieldname||!fieldname.length){alert('buildFormSelect Error: no name');return undefined}
fieldname=fieldname.replace('/[\[\]]+$/','');if(undefined==params){params={}}
if(undefined==opts){alert('buildFormSelect Error: no opts');return undefined}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
var tag=document.createElement("select");if(undefined!=params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.class){tag.setAttribute('class',params.class)}
if(undefined!=params.style){tag.setAttribute('style',params.style)}
tag.name=fieldname;tag.id=params.id;for(var tval in opts){var coption=document.createElement("OPTION");coption.value=tval;coption.innerHTML=opts[tval];if(undefined!=params.value&&tval==params.value){coption.setAttribute('selected',!0)}
tag.appendChild(coption)}
if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tag)}else{console.log(params['-parent']+' does not exist')}}
return tag},buildFormText:function(fieldname,params){if(undefined==fieldname){alert('buildFormText requires fieldname');return undefined}
if(undefined==params){params={}}
if(undefined==params['-formname']){params['-formname']='addedit'}
if(undefined==params.id){params.id=params['-formname']+'_'+fieldname}
if(undefined==params.classname){params.classname='form-control input'}
var tag=document.createElement("input");tag.className=params.classname;if(undefined!=params.required){tag.setAttribute('required',params.required)}
if(undefined!=params.class){tag.setAttribute('class',params.class)}
if(undefined!=params.style){tag.setAttribute('style',params.style)}
if(undefined!=params.value){tag.setAttribute('value',params.value)}else{tag.setAttribute('value','')}
tag.name=fieldname;tag.id=params.id;if(undefined!=params['-parent']){var pobj=getObject(params['-parent']);if(undefined!=pobj){pobj.appendChild(tag)}else{console.log(params['-parent']+' does not exist')}}
return tag},copy2Clipboard:function(str,msg){if(undefined==msg){msg='Copy Successful'}
const el=document.createElement('textarea');el.value=str;document.body.appendChild(el);el.select();document.execCommand('copy');document.body.removeChild(el);wacss.toast(msg);return!0},color:function(){if(undefined!=document.getElementById('admin_menu')){return document.getElementById('admin_menu').getAttribute('data-color')}else if(undefined!=document.getElementById('admin_color')){return document.getElementById('admin_color').innerText}else if(undefined!=document.getElementById('wacss_color')){return document.getElementById('wacss_color').innerText}else{return'w_gray'}},dismiss:function(el){if(el.parentElement.querySelector(':hover')==el){let wtimer=parseInt(el.timer)*3;setTimeout(function(){wacss.dismiss(el)},wtimer);return}
el.className='toast dismiss';setTimeout(function(){wacss.removeObj(el)},1000)},emulateEvent:function(el,ev){el=wacss.getObject(el);if(undefined==el){return!1}
if("createEvent" in document){let evt=document.createEvent("HTMLEvents");evt.initEvent(ev,!1,!0);el.dispatchEvent(evt)}else{el.fireEvent("on"+ev)}
return!1},function_exists:function(function_name){if(typeof function_name=='string'){return(typeof window[function_name]=='function')}else{return(function_name instanceof Function)}},getAllAttributes:function(obj){let node=wacss.getObject(obj);let rv={};for(let i=0;i<node.attributes.length;i++){if(node.attributes.item(i).specified){rv[node.attributes.item(i).nodeName]=node.attributes.item(i).nodeValue}}
return rv},geoLocation:function(fld,opts){fldObj=wacss.getObject(fld);if(undefined==fldObj){if(!wacss.function_exists(fld)){console.log("wacss.getGeoLocation error: "+fld+' is undefined');return!1}}
if(navigator.geolocation){let options={enableHighAccuracy:!0,timeout:10000,maximumAge:5000};if(undefined!=opts){for(let k in opts){if(k=='onerror'){navigator.geoSetFldFailed=opts[k]}else{options[k]=opts[k]}}}
navigator.geoSetFld=fld;navigator.geoOptions=options;navigator.geolocation.getCurrentPosition(function(position){if(wacss.function_exists(navigator.geoSetFld)){window[navigator.geoSetFld](position.coords.latitude,position.coords.longitude,navigator.geoOptions)}else{if(undefined!=navigator.geoOptions.showmap&&navigator.geoOptions.showmap==1){navigator.geoOptions.input=navigator.geoSetFld;wacss.geoLocationMap(position.coords.latitude,position.coords.longitude,navigator.geoOptions)}else{fldObj=getObject(navigator.geoSetFld);fldObj.value='['+position.coords.latitude+','+position.coords.longitude+']'}}
return!1},function(err){navigator.geoOptions.code=err.code;navigator.geoOptions.message=err.message;if(undefined!=navigator.geoSetFldFailed){if(wacss.function_exists(navigator.geoSetFldFailed)){window[navigator.geoSetFldFailed](navigator.geoOptions)}else{if(undefined==navigator.geoOptions.showmap&&navigator.geoOptions.showmap==1){alert(err.message)}else{let errfld=document.querySelector(navigator.geoSetFldFailed);if(undefined!=errfld){setText(wacss.getObject(errfld),err.message)}else{console.log('wacss.getGeoLocation error. Invalid onerror value');console.log(navigator.geoSetFldFailed);console.log(err.message)}}}}else{if(undefined==navigator.geoOptions.showmap&&navigator.geoOptions.showmap==1){alert(err.message)}else{console.log('wacss.getGeoLocation error. No onerror set.');console.log(navigator.geoOptions)}}
return!1},options)}
return!1},geoLocationMap:function(lat,long,params){lat=parseFloat(lat);long=parseFloat(long);if(undefined==params){params={}}
if(undefined==params.displayname){params.displayname='Click on map to select'}
params.lat=lat;params.long=long;if(undefined!=document.getElementById('geolocationmap_content')){params.div='geolocationmap_content';wacss.geoLocationMapContent(params);centerObject('geolocationmap');return 1}
let popup=document.createElement('div');popup.id='geolocationmap_popup';popup.style='z-index:99999999;background:#FFF;width:80vw;height:80vh;position:absolute;display:flex;flex-direction:column;justify-content:flex-start;border-radius:5px;box-shadow: 0 4px 8px 0 rgb(0 0 0 / 20%), 0 6px 20px 0 rgb(0 0 0 / 19%);';let popup_title=document.createElement('div');popup_title.style="display:flex;justify-content:center;align-items:center;width:100%;";popup_title.id='geolocationmap_title';let popup_title_img=document.createElement('img');popup_title_img.src='/wfiles/svg/google-maps.svg';popup_title_img.style='height:32px;width:auto;';popup_title.appendChild(popup_title_img);let popup_title_text=document.createElement('div');popup_title_text.style='padding-top:5px;flex:1;height:100%;line-height:1.2rem;color:#FFF;background:#b5b5b5;font-size:1.2rem;text-align:center;';popup_title_text.innerHTML=params.displayname;popup_title.appendChild(popup_title_text);let popup_title_close=document.createElement('span');popup_title_close.className='icon-close w_red';popup_title_close.style='background:#b5b5b5;padding-right:10px;height:100%;padding-top:5px;cursor:pointer;';popup_title_close.onclick=function(){removeId('geolocationmap_popup')}
popup_title.appendChild(popup_title_close);popup.appendChild(popup_title);let popup_content=document.createElement('div');popup_content.id='geolocationmap_content';popup_content.style='flex:1;';popup.appendChild(popup_content);params.div=popup_content;wacss.geoLocationMapContent(params);document.body.appendChild(popup);centerObject(popup)},geoLocationMapContent:function(params){if(undefined==params){params={}}
params.zoom=params.zoom||13;let myLatlng={lat:params.lat,lng:params.long};let map_params={center:myLatlng,streetViewControl:!1,mapTypeId:'roadmap',zoom:params.zoom,styles:[]};if(undefined!=params.hide&&params.hide.toLowerCase().indexOf('poi')!=-1){let poi={featureType:'poi',elementType:'labels',stylers:[{visibility:'off'}]};map_params.styles.push(poi)}
let map=new google.maps.Map(params.div,map_params);map.addListener('click',function(event){if(event.placeId){event.stop()}});if(undefined!=params.markers){if(!Array.isArray(params.markers)){params.markers=new Array(params.markers)}
for(let m=0;m<params.markers.length;m++){let marker=params.markers[m];marker.map=map;let mark=new google.maps.Marker(marker)}}
if(undefined==params.hideinfo){let infoWindow=new google.maps.InfoWindow({content:params.displayname,position:myLatlng,});infoWindow.open(map);let mylatlonval='['+myLatlng.lat+','+myLatlng.lng+']';let htm='';htm='<div class="align-center w_smallest w_gray">'+mylatlonval+'</div><div class="align-center w_padtop"><span class="icon-map-marker w_red"></span> Location</div>';infoWindow.setContent(htm);if(undefined==params.readonly){map.params=params;map.addListener("click",(mapsMouseEvent)=>{let latlon=mapsMouseEvent.latLng.toJSON();let latlonval='['+latlon.lat+','+latlon.lng+']';infoWindow.close();infoWindow=new google.maps.InfoWindow({position:mapsMouseEvent.latLng,});let chtm='<div class="align-center w_smallest w_gray">'+latlonval+'</div><div class="align-center w_padtop"><span class="icon-map-marker w_red"></span> <span data-lat="'+latlon.lat+'" data-lon="'+latlon.lng+'" data-latlon="'+latlonval+'" data-input="'+map.params.input+'" class="w_pointer" onclick="return wacss.geoLocationMapSetValue(this);"><span class="w_bigger w_gray icon-save w_pointer"></span> Save</span></div>';infoWindow.setContent(chtm);infoWindow.open(map)})}}},geoLocationMapSetValue:function(el){let inp=wacss.getObject(el.dataset.input);inp.value=el.dataset.latlon;let clickdiv=wacss.getObject(el.dataset.input+'_clickdiv');if(undefined!=clickdiv){clickdiv.dataset.lat=el.dataset.lat;clickdiv.dataset.lon=el.dataset.lon}
removeId('geolocationmap_popup');return!1},getObject:function(obj){if(typeof(obj)=='object'){return obj}else if(typeof(obj)=='string'){let qso=document.querySelector('#'+obj);if(typeof(qso)=='object'){return qso}
qso=document.querySelector(obj);if(typeof(qso)=='object'){return qso}
if(undefined!=document.getElementById(obj)){return document.getElementById(obj)}else if(undefined!=document.getElementsByName(obj)){let els=document.getElementsByName(obj);if(els.length==1){return els[0]}}else if(undefined!=document.all[obj]){return document.all[obj]}}
return null},getParent:function(obj,name,classname){if(undefined==obj){return null}
if(undefined==classname){classname=''}
if(undefined!=name){let count=1;while(count<1000){if(undefined==obj.parentNode){return null}
obj=obj.parentNode;if(!typeof(obj)){return null}
if(obj.nodeName.toLowerCase()==name.toLowerCase()){if(classname.length){if(obj.classList.contains(classname)){return obj}}else{return obj}}
count++}
return null}
let cObj=wacss.getObject(obj);if(undefined==cObj){return abort("undefined object passed to getParent")}
if(undefined==cObj.parentNode){return cObj}
let pobj=cObj.parentNode;if(typeof(cObj.parentNode)=="object"){return cObj.parentNode}else{return wacss.getParent(pobj)}},getSiblings:function(elem){let siblings=[];let sibling=elem.parentNode.firstChild;while(sibling){if(sibling.nodeType===1&&sibling!==elem){siblings.push(sibling)}
sibling=sibling.nextSibling}
return siblings},guid:function(){function _p8(s){let p=(Math.random().toString(16)+"000000000").substr(2,8);return s?"-"+p.substr(0,4)+"-"+p.substr(4,4):p}
return _p8()+_p8(!0)+_p8(!0)+_p8()},in_array:function(needle,haystack){let length=haystack.length;for(let i=0;i<length;i++){if(haystack[i]==needle){return!0}}
return!1},init:function(){wacss.initWacssEdit();wacss.initChartJs();wacss.initCodeMirror();wacss.initEditor();wacss.initWhiteboard();wacss.initSignaturePad()},chartjsDrawTotals:function(chart){let width=chart.chart.width,height=chart.chart.height,ctx=chart.chart.ctx;ctx.restore();let fontSize=(height/60).toFixed(2);ctx.font=fontSize+"em sans-serif";ctx.textBaseline="middle";let text=chart.config.centerText.text,textX=Math.round((width-ctx.measureText(text).width)/2),textY=height-20;ctx.fillText(text,textX,textY);ctx.save()},initChartJsBehavior:function(chartid){let list=document.querySelectorAll('[data-behavior="chartjs"]');if(undefined!=chartid){list=document.querySelectorAll('#'+chartid)}
if(list.length==0){return}
let gcolors=new Array('rgb(255, 159, 64)','rgb(75, 192, 192)','rgb(255, 99, 132)','rgb(54, 162, 235)','rgb(153, 102, 255)','rgb((218,165,32)','rgb(233,150,122)','rgb(189,183,107)','rgb(154,205,50)','rgb(255,228,196)','rgb(244,164,96)','rgb(176,196,222)','rgb(188,143,143)','rgb(255,228,225)','rgb(201, 203, 207)');for(let i=0;i<list.length;i++){if(undefined==list[i].id){console.log('Error in initChartJsBehavior: missing id attribute');console.log(list[i]);continue}
if(undefined==list[i].dataset.type){console.log('Error in initChartJsBehavior: missing data-type attribute');console.log(list[i]);continue}
if(undefined==chartid&&undefined!=list[i].dataset.initialized){continue}
list[i].dataset.initialized=1;let datadiv=document.querySelector('#'+list[i].id+'_data');if(undefined==datadiv){console.log('Error in initChartJsBehavior: missing data div attribute');console.log(list[i]);continue}
if(undefined!=list[i].dataset.debug){console.log('datadiv');console.log(datadiv.innerHTML)}
let lconfig={type:list[i].dataset.type,data:{labels:[],datasets:[]}};let optionsdiv=datadiv.querySelector('options');if(undefined!=optionsdiv){let optionsjson=wacss.trim(optionsdiv.innerText);lconfig.options=JSON.parse(optionsjson);if(undefined!=list[i].dataset.debug){console.log('optionsjson');console.log(optionsjson);console.log('options');console.log(lconfig.options)}}else{lconfig.options={responsive:!0,events:!1,animation:{animateScale:!1,animateRotate:!0},title:{display:!1},tooltips:{enabled:!1,intersect:!1,mode:'index'},plugins:{labels:{fontColor:function(data){let rgb={};rgb=wacss.hexToRgb(data.dataset.backgroundColor[data.index]);if(undefined==rgb.r){return'#FFF'}
let threshold=140;let luminance=0.299*rgb.r+0.587*rgb.g+0.114*rgb.b;return luminance>threshold?'black':'white'},precision:0,showActualPercentages:!0}}};if(undefined!=list[i].dataset.debug){console.log('no options div - setting default')}}
let labelsdiv=datadiv.querySelector('labels');if(undefined!=labelsdiv){let labelsjson=wacss.trim(labelsdiv.innerText);lconfig.data.labels=JSON.parse(labelsjson);if(undefined!=list[i].dataset.debug){console.log('labelsjson');console.log(labelsjson);console.log('labels');console.log(lconfig.data.labels)}}else{if(undefined!=list[i].dataset.debug){console.log('no labels div')}}
let colorsdiv=datadiv.querySelector('colors');if(undefined!=colorsdiv){let colorsjson=wacss.trim(colorsdiv.innerText);colors=JSON.parse(colorsjson);if(undefined!=list[i].dataset.debug){console.log('colorsjson');console.log(colorsjson);console.log('colors');console.log(colors)}}else{colors=gcolors}
let datasets=datadiv.querySelectorAll('dataset');if(undefined!=list[i].dataset.debug){console.log(datasets.length+' dataset tags found')}
for(let d=0;d<datasets.length;d++){let datasetjson=wacss.trim(datasets[d].innerText);let json=JSON.parse(datasetjson);if(undefined!=list[i].dataset.debug){console.log(d+': datasetjson');console.log(datasetjson);console.log('json');console.log(json)}
let dataset={label:datasets[d].dataset.label||datasets[d].dataset.title||'',backgroundColor:datasets[d].dataset.backgroundcolor||colors,type:datasets[d].dataset.type||lconfig.type,data:json};if(undefined!=datasets[d].dataset.fill&&datasets[d].dataset.fill.toLowerCase()=='false'){dataset.fill=!1}else if(undefined!=list[i].dataset.fill&&list[i].dataset.fill.toLowerCase()=='false'){dataset.fill=!1}
lconfig.data.datasets.push(dataset)}
if(undefined!=list[i].dataset.responsive&&list[i].dataset.responsive.toLowerCase()=='false'){lconfig.options.responsive=!1}
if(undefined!=list[i].dataset.title){lconfig.options.title={display:!0,text:list[i].dataset.title}}
if(undefined!=list[i].dataset.stacked&&list[i].dataset.stacked.toLowerCase()=='true'){lconfig.options.scales={xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]}}
if(undefined!=list[i].dataset.legenddisplay&&list[i].dataset.legenddisplay.toLowerCase()=='false'){lconfig.options.legend={display:!1}}
if(undefined!=list[i].dataset.render){lconfig.options.plugins.labels.render=list[i].dataset.render}
if(undefined!=list[i].dataset.fontcolor){lconfig.options.plugins.labels.fontColor=list[i].dataset.fontcolor}
if(undefined!=list[i].dataset.precision){lconfig.options.plugins.labels.precision=list[i].dataset.precision}
if(undefined!=list[i].dataset.position){lconfig.options.plugins.labels.position=list[i].dataset.position}
if(undefined!=list[i].dataset.outsidepadding){lconfig.options.plugins.labels.outsidePadding=list[i].dataset.outsidepadding}
if(undefined!=list[i].dataset.textmargin){lconfig.options.plugins.labels.textMargin=list[i].dataset.textmargin}
if(undefined!=list[i].dataset.centertext){lconfig.options.plugins.doughnutlabel={color:list[i].dataset.centertextcolor||'#000',labels:[{text:list[i].dataset.centertext,font:{size:list[i].dataset.centertextfontsize||30}}]}}
let lcanvas=document.createElement('canvas');list[i].appendChild(lcanvas);let lctx=lcanvas.getContext('2d');if(undefined!=list[i].dataset.debug){console.log(lconfig)}
wacss.chartjs[list[i].id]=new Chart(lctx,lconfig);if(undefined!=list[i].dataset.onclick){lcanvas.parentobj=list[i];lcanvas.chartobj=wacss.chartjs[list[i].id];lcanvas.onclick_func=list[i].dataset.onclick;lcanvas.clicked=0;lcanvas.onclick=function(evt){if(this.clicked==0){this.clicked=1;this.timeout=setTimeout(function(obj){obj.clicked=0},250,this);let activePoints=this.chartobj.getElementsAtEventForMode(evt,'point',this.chartobj.options);if(activePoints.length>0){let firstPoint=activePoints[0];let params={};params.parent=this.parentobj;params.chart=this.chartobj;params.type=this.parentobj.getAttribute('data-type');params.label=this.chartobj.data.labels[firstPoint._index]||this.chartobj.data.datasets[firstPoint._datasetIndex].label;params.value=this.chartobj.data.datasets[firstPoint._datasetIndex].data[firstPoint._index];window[this.onclick_func](params)}}}}}},initChartJs:function(initid){wacss.initChartJsBehavior();let list=document.querySelectorAll('div.chartjs');let gcolors=new Array('rgb(255, 159, 64)','rgb(75, 192, 192)','rgb(255, 99, 132)','rgb(54, 162, 235)','rgb(153, 102, 255)','rgb((218,165,32)','rgb(233,150,122)','rgb(189,183,107)','rgb(154,205,50)','rgb(255,228,196)','rgb(244,164,96)','rgb(176,196,222)','rgb(188,143,143)','rgb(255,228,225)','rgb(201, 203, 207)');for(let i=0;i<list.length;i++){if(undefined==list[i].id){console.log('missing id',list[i]);continue}
if(undefined!=initid&&list[i].id!=initid){continue}
if(undefined==list[i].getAttribute('data-type')){console.log('missing data-type',list[i]);continue}
if(undefined==document.getElementById(list[i].id+'_data')){console.log('missing data div',list[i]);continue}
list[i].setAttribute('data-initialized',1);let type=list[i].dataset.type.toLowerCase();let datadiv=wacss.getObject(list[i].id+'_data');let colorsdiv=datadiv.querySelector('colors');if(undefined!=colorsdiv){let colorsjson=wacss.trim(colorsdiv.innerText);colors=JSON.parse(colorsjson)}else{colors=gcolors}
let labels=new Array();let labelsdiv=datadiv.querySelector('labels');if(undefined!=labelsdiv){let labelsjson=wacss.trim(labelsdiv.innerText);labels=JSON.parse(labelsjson)}
let optionsdiv=datadiv.querySelector('options');if(undefined!=optionsdiv){let optionsjson=wacss.trim(optionsdiv.innerText);options=JSON.parse(optionsjson)}else{options={responsive:!0}}
let foundchart=0;switch(type){case 'guage':if(undefined!=wacss.chartjs[list[i].id]){let ck=list[i].querySelector('canvas');if(undefined!=ck){let gv=list[i].dataset.value||datadiv.innerText;gv=parseInt(gv);let max=list[i].dataset.max||180;let gv1=parseInt(max*(gv/100));if(gv1>max){gv1=max}
let gv2=max-gv1;wacss.chartjs[list[i].id].config.centerText.text=gv1;wacss.chartjs[list[i].id].config.data.datasets[0].data=[gv1,gv2];wacss.chartjs[list[i].id].update();foundchart=1}}
if(foundchart==0){let gv=list[i].dataset.value||datadiv.innerText;gv=parseInt(gv);let max=list[i].dataset.max||180;let gv1=parseInt(max*(gv/100));if(gv1>max){gv1=max}
let gv2=max-gv1;let color=list[i].dataset.color||'#009300';let gconfig={type:'doughnut',data:{datasets:[{data:[gv1,gv2],backgroundColor:colors,borderWidth:0}]},options:{title:{display:!1},circumference:Math.PI,rotation:-1*Math.PI,responsive:!0,plugins:{labels:{render:list[i].dataset.render||'label',fontColor:list[i].dataset.fontcolor||function(data){let rgb={};rgb=wacss.hexToRgb(data.dataset.backgroundColor[data.index]);if(undefined==rgb.r){return'white'}
let threshold=140;let luminance=0.299*rgb.r+0.587*rgb.g+0.114*rgb.b;return luminance>threshold?'black':'white'},precision:list[i].dataset.precision||2,position:list[i].dataset.position||'outside',outsidePadding:list[i].dataset.outsidepadding||4,textMargin:list[i].dataset.textmargin||4}},legend:{display:!1},animation:{animateScale:!1,animateRotate:!0}},centerText:{display:!0,text:gv1}};if(undefined!=list[i].dataset.labels&&list[i].dataset.labels=='false'){gconfig.options.plugins.datalabels.display=!1}
if(undefined!=list[i].dataset.title){gconfig.options.title={display:!0,padding:0,position:'bottom',text:list[i].dataset.title}}
if(undefined!=list[i].dataset.titlePosition){gconfig.options.title.position=list[i].dataset.titlePosition}
let gcanvas=document.createElement('canvas');list[i].appendChild(gcanvas);let gctx=gcanvas.getContext('2d');wacss.chartjs[list[i].id]=new Chart(gctx,gconfig);Chart.pluginService.register({afterDraw:function(chart){if(undefined!=chart.config.centerText){if(undefined!=chart.config.centerText.display){wacss.chartjsDrawTotals(chart)}}}});if(undefined!=list[i].getAttribute('data-onclick')){gcanvas.parentobj=list[i];gcanvas.chartobj=wacss.chartjs[list[i].id];gcanvas.onclick_func=list[i].getAttribute('data-onclick');gcanvas.clicked=0;gcanvas.onclick=function(evt){if(this.clicked==0){this.clicked=1;this.timeout=setTimeout(function(obj){obj.clicked=0},250,this);let activePoints=this.chartobj.getElementsAtEventForMode(evt,'point',this.chartobj.options);if(activePoints.length>0){let firstPoint=activePoints[0];let params={};params.parent=this.parentobj;params.chart=this.chartobj;params.type=this.parentobj.getAttribute('data-type');params.label=this.chartobj.data.labels[firstPoint._index]||this.chartobj.data.datasets[firstPoint._datasetIndex].label;params.value=this.chartobj.data.datasets[firstPoint._datasetIndex].data[firstPoint._index];window[this.onclick_func](params)}}}}}
break;case 'line':case 'bar':case 'horizontalbar':case 'doughnut':if(undefined!=wacss.chartjs[list[i].id]){let ck=list[i].querySelector('canvas');if(undefined!=ck){if(undefined!=labels&&labels.length>0){wacss.chartjs[list[i].id].config.data.labels=labels}
let udatasets=datadiv.querySelectorAll('dataset');let datasetLabels=new Array();for(let ud=0;ud<udatasets.length;ud++){let json=JSON.parse(udatasets[ud].innerText);let udataset={backgroundColor:udatasets[ud].getAttribute('data-backgroundColor')||colors[ud],type:udatasets[ud].getAttribute('data-type')||list[i].getAttribute('data-type'),data:json,fill:!1,pointBackgroundColor:[],pointBorderColor:[]};if(undefined!=udatasets[ud].getAttribute('data-showLine')&&udatasets[ud].getAttribute('data-showLine')=='false'){udataset.showLine=!1}
if(undefined!=udatasets[ud].getAttribute('data-yaxis')){udataset.yAxisID=udatasets[ud].getAttribute('data-yaxis')}
if(undefined!=udatasets[ud].getAttribute('data-label')){udataset.label=udatasets[ud].getAttribute('data-label');let dlabel=udatasets[ud].getAttribute('data-label');datasetLabels.push(dlabel)}
for(let ds=0;ds<udataset.data.length;ds++){if(undefined!=udataset.data[ds].pointBackgroundColor){udataset.pointBackgroundColor[ds]=udataset.data[ds].pointBackgroundColor}
if(undefined!=udataset.data[ds].pointBorderColor){udataset.pointBorderColor[ds]=udataset.data[ds].pointBorderColor}
if(undefined!=udataset.data[ds].backgroundColor){udataset.backgroundColor[ds]=udataset.data[ds].backgroundColor}
if(undefined!=udataset.data[ds].borderColor){udataset.borderColor[ds]=udataset.data[ds].borderColor}}
wacss.chartjs[list[i].id].config.data.datasets[ud]=udataset}
wacss.chartjs[list[i].id].config.options=options;if((undefined==labels||labels.length==0)&&undefined!=datasetLabels&&datasetLabels.length>0){wacss.chartjs[list[i].id].config.data.labels=datasetLabels}
if(undefined!=list[i].getAttribute('data-stacked')&&list[i].getAttribute('data-stacked')==1){if(undefined!=wacss.chartjs[list[i].id].config.options.scales.yAxes[0]){wacss.chartjs[list[i].id].config.options.scales.yAxes[0].stacked=!0}
if(undefined!=wacss.chartjs[list[i].id].config.options.scales.xAxes[0]){wacss.chartjs[list[i].id].config.options.scales.xAxes[0].stacked=!0}}
wacss.chartjs[list[i].id].update();foundchart=1}}
if(foundchart==0){let lconfig={type:list[i].getAttribute('data-type'),data:{labels:labels,datasets:[]},options:options};if(undefined!=list[i].getAttribute('data-stacked')&&list[i].getAttribute('data-stacked')==1){if(undefined!=undefined!=lconfig.options.scales.yAxes[0]){lconfig.options.scales.yAxes[0].stacked=!0}
if(undefined!=undefined!=lconfig.options.scales.xAxes[0]){lconfig.options.scales.xAxes[0].stacked=!0}}
let datasets=datadiv.querySelectorAll('dataset');let datasetLabels=new Array();for(let d=0;d<datasets.length;d++){let json=JSON.parse(datasets[d].innerText);let fill=datasets[d].dataset.fill||list[i].dataset.fill||!1;if(undefined!=fill){if(fill.indexOf('true')!=-1){fill=!0}else if(fill=='1'){fill=!0}else{fill=!1}}else{fill=!1}
let dataset={backgroundColor:datasets[d].dataset.backgroundcolor||datasets[d].dataset.backgroundColor||colors[d],type:datasets[d].dataset.type||list[i].dataset.type||'line',data:json,fill:fill,pointBackgroundColor:datasets[d].dataset.pointbackgroundcolor||datasets[d].dataset.pointBackgroundColor||[],pointBorderColor:datasets[d].dataset.pointbordercolor||datasets[d].dataset.pointBorderColor||[]};if(undefined!=datasets[d].dataset.bordercolor){dataset.borderColor=datasets[d].dataset.bordercolor}else if(undefined!=datasets[d].dataset.borderColor){dataset.borderColor=datasets[d].dataset.borderColor}
if(undefined!=datasets[d].dataset.borderdash){dataset.borderDash=datasets[d].dataset.borderdash}else if(undefined!=datasets[d].dataset.borderDash){dataset.borderDash=datasets[d].dataset.borderDash}
if(undefined!=datasets[d].dataset.yaxis){dataset.yAxisID=datasets[d].dataset.yaxis}else if(undefined!=datasets[d].dataset.yAxisID){dataset.yAxisID=datasets[d].dataset.yAxisID}
if(undefined!=datasets[d].dataset.showline&&datasets[d].dataset.showline=='false'){dataset.showLine=!1}else if(undefined!=datasets[d].dataset.showLine&&datasets[d].dataset.showLine=='false'){dataset.showLine=!1}
if(undefined!=datasets[d].dataset.pointhoverbackgroundcolor){dataset.pointHoverBackgroundColor=datasets[d].dataset.pointhoverbackgroundcolor}else if(undefined!=datasets[d].dataset.pointHoverBackgroundColor){dataset.pointHoverBackgroundColor=datasets[d].dataset.pointHoverBackgroundColor}
if(undefined!=datasets[d].dataset.pointhoverbordercolor){dataset.pointHoverBorderColor=datasets[d].dataset.pointhoverbordercolor}else if(undefined!=datasets[d].dataset.pointHoverBorderColor){dataset.pointHoverBorderColor=datasets[d].dataset.pointHoverBorderColor}
if(undefined!=datasets[d].dataset.label){dataset.label=datasets[d].dataset.label;let dlabel=datasets[d].dataset.label;datasetLabels.push(dlabel)}
for(let ds=0;ds<dataset.data.length;ds++){if(undefined!=dataset.data[ds].pointbackgroundcolor){dataset.pointBackgroundColor[ds]=dataset.data[ds].pointbackgroundcolor}
if(undefined!=dataset.data[ds].pointbordercolor){dataset.pointBorderBolor[ds]=dataset.data[ds].pointbordercolor}
if(undefined!=dataset.data[ds].backgroundcolor){dataset.backgroundColor[ds]=dataset.data[ds].backgroundcolor}
if(undefined!=dataset.data[ds].bordercolor){dataset.borderColor[ds]=dataset.data[ds].bordercolor}}
lconfig.data.datasets.push(dataset)}
if((undefined==labels||labels.length==0)&&undefined!=datasetLabels&&datasetLabels.length>0){lconfig.data.labels=datasetLabels}
let lcanvas=document.createElement('canvas');list[i].appendChild(lcanvas);let lctx=lcanvas.getContext('2d');wacss.chartjs[list[i].id]=new Chart(lctx,lconfig);if(undefined!=list[i].dataset.onclick){lcanvas.parentobj=list[i];lcanvas.chartobj=wacss.chartjs[list[i].id];lcanvas.onclick_func=list[i].dataset.onclick;lcanvas.clicked=0;lcanvas.onclick=function(evt){if(this.clicked==0){this.clicked=1;this.timeout=setTimeout(function(obj){obj.clicked=0},250,this);let activePoint=this.chartobj.getElementAtEvent(evt);if(activePoint.length>0){let firstPoint=activePoint[0];let clickedDatasetIndex=firstPoint._datasetIndex;let clickedElementIndex=firstPoint._index;let clickedDatasetPoint=this.chartobj.data.datasets[clickedDatasetIndex];let label=clickedDatasetPoint.label;let value=clickedDatasetPoint.data[clickedElementIndex].y;let params={};params.parent=this.parentobj;params.chart=this.chartobj;params.type=this.parentobj.dataset.type;params.label=this.chartobj.data.labels[firstPoint._index]||clickedDatasetPoint.label;params.value=clickedDatasetPoint.data[firstPoint._index]||clickedDatasetPoint.data[clickedElementIndex].y;params.axis=clickedDatasetPoint.yAxisID||'default';window[this.onclick_func](params)}else{let activePoints=this.chartobj.getElementsAtEventForMode(evt,'point',this.chartobj.options);if(activePoints.length>0){let firstPoint=activePoints[0];let params={};params.parent=this.parentobj;params.chart=this.chartobj;params.type=this.parentobj.dataset.type;params.label=this.chartobj.data.labels[firstPoint._index]||this.chartobj.data.datasets[firstPoint._datasetIndex].label;params.value=this.chartobj.data.datasets[firstPoint._datasetIndex].data[firstPoint._index];params.axis=this.chartobj.data.datasets[firstPoint._datasetIndex].yAxisID||'default';window[this.onclick_func](params)}}}}}}
break;case 'pie':if(undefined!=wacss.chartjs[list[i].id]){let ck=list[i].querySelector('canvas');if(undefined!=ck){let pielabels=[];let data=[];let datasets=datadiv.querySelectorAll('dataset');let json=JSON.parse(datasets[0].innerText);for(let tval in json){pielabels.push(tval);data.push(json[tval])}
wacss.chartjs[list[i].id].config.data.datasets[0].data=data;if(undefined!=labels&&labels.length>0){wacss.chartjs[list[i].id].config.data.labels=labels}else{wacss.chartjs[list[i].id].config.data.labels=pielabels}
wacss.chartjs[list[i].id].update();foundchart=1}}
if(foundchart==0){let pielabels=[];let data=[];let datasets=datadiv.querySelectorAll('dataset');let json=JSON.parse(datasets[0].innerText);for(let tval in json){pielabels.push(tval);data.push(json[tval])}
let pconfig={type:'pie',data:{labels:labels,datasets:[{backgroundColor:colors,fill:!0,data:data}]},options:{responsive:!0,events:!1,animation:{animateScale:!1,animateRotate:!0},title:{display:list[i].dataset.label?true:!1,text:list[i].dataset.label||''},rotation:-0.7*Math.PI,plugins:{labels:{render:list[i].dataset.render||'label',fontColor:list[i].dataset.fontcolor||function(data){let rgb={};rgb=wacss.hexToRgb(data.dataset.backgroundColor[data.index]);if(undefined==rgb.r){return'white'}
let threshold=140;let luminance=0.299*rgb.r+0.587*rgb.g+0.114*rgb.b;return luminance>threshold?'black':'white'},precision:list[i].dataset.precision||0,position:list[i].dataset.position||'outside',outsidePadding:list[i].dataset.outsidepadding||4,textMargin:list[i].dataset.textmargin||4,showActualPercentages:!0}}}};console.log(pconfig.options.plugins);if(undefined!=labels&&labels.length>0){pconfig.data.labels=labels}
let pcanvas=document.createElement('canvas');list[i].appendChild(pcanvas);let pctx=pcanvas.getContext('2d');wacss.chartjs[list[i].id]=new Chart(pctx,pconfig);if(undefined!=list[i].dataset.onclick){pcanvas.parentobj=list[i];pcanvas.chartobj=wacss.chartjs[list[i].id];pcanvas.onclick_func=list[i].dataset.onclick;pcanvas.clicked=0;pcanvas.onclick=function(evt){if(this.clicked==0){this.clicked=1;this.timeout=setTimeout(function(obj){obj.clicked=0},250,this);let activePoints=this.chartobj.getElementsAtEventForMode(evt,'point',this.chartobj.options);if(activePoints.length>0){let firstPoint=activePoints[0];let params={};params.parent=this.parentobj;params.chart=this.chartobj;params.type=this.parentobj.dataset.type;params.label=this.chartobj.data.labels[firstPoint._index]||this.chartobj.data.datasets[firstPoint._datasetIndex].label;params.value=this.chartobj.data.datasets[firstPoint._datasetIndex].data[firstPoint._index];window[this.onclick_func](params)}}}}}
break}}
return!0},hexToRgb:function(hex){if(undefined==hex){return{r:255,g:255,b:255}}
let rgb_regex=/rgb\(([0-9]+?),\ ([0-9]+?),\ ([0-9]+?)\)/;let rgb_match=hex.toString().match(rgb_regex);if(undefined!=rgb_match&&undefined!=rgb_match[1]){return{r:rgb_match[1],g:rgb_match[2],b:rgb_match[3]}}
let shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});let result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:{r:255,g:255,b:255}},initCodeMirror:function(){let list=document.querySelectorAll('textarea.code[data-mode]');if(undefined==list||list.length==0){return!1}
let defaults={mode:'text/x-sql',indentUnit:4,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,lineWrapping:!1,matchBrackets:!0,autofocus:!1,autoRefresh:!0,extraKeys:{"Ctrl-Space":"autocomplete","F11":function(cm){cm.setOption("fullScreen",!cm.getOption("fullScreen"))},"Esc":function(cm){if(cm.getOption("fullScreen"))cm.setOption("fullScreen",!1)}}};if(undefined==this.codemirror){this.codemirror={}}
for(let i=0;i<list.length;i++){if(undefined!=list[i].codemirror){continue}
let params={};for(k in list[i].dataset){if(k=='debug'){continue}
let v=list[i].dataset[k];if(typeof v==='string'||v instanceof String){switch(v){case 'true':v=!0;break;case 'false':v=!1;break}}
params[k]=v}
switch(params.mode.toLowerCase()){case 'css':case 'text/css':params.mode='text/css';break;case 'html':case 'text/html':params.mode='text/html';defaults.htmlMode=!0;break;case 'ini':case 'text/x-ini':params.mode='text/x-ini';break;case 'javascript':case 'text/javascript':params.mode='text/javascript';defaults.continueComments='Enter';defaults.extraKeys["Ctrl-Q"]='toggleComment';break;case 'json':case 'application/x-json':params.mode='application/x-json';defaults.autoCloseBrackets=!0;defaults.matchBrackets=!0;defaults.lineWrapping=!0;break;case 'lua':case 'text/x-lua':params.mode='text/x-lua';break;case 'perl':case 'text/x-perl':params.mode='text/x-perl';break;case 'php':case 'application/x-httpd-php':params.mode='application/x-httpd-php';break;case 'python':params.mode={name:'python',version:3,singleLineStringErrors:!1};break;case 'sql':case 'text/x-sql':params.mode='text/x-sql';break;case 'vbscript':case 'text/vbscript':params.mode='text/vbscript';break;case 'xml':case 'application/xml':params.mode='application/xml';break}
for(k in defaults){if(undefined==params[k]){params[k]=defaults[k]}}
if(undefined!=list[i].dataset.debug){console.log(list[i]);console.log(params)}
let cm=CodeMirror.fromTextArea(list[i],params);list[i].codemirror=cm;cm.on('change',function(cm){cm.save()})}},initEditor:function(){let els=document.querySelectorAll('textarea[data-behavior="editor"]');if(els.length==0){return!1}
for(e=0;e<els.length;e++){if(undefined!=els[e].dataset.initialized){continue}
els[e].setAttribute('data-initialized',1);let mh=els[e].style.minHeight||'200px';els[e].style.display='none';let editor=document.createElement('div');editor.setAttribute('contenteditable','true');editor.style.minHeight=mh;editor.saveto=els[e];els[e].editor=editor;editor.onkeydown=function(e){let evt=e||window.event;let keyCode=evt.charCode||evt.keyCode;let sel='';if(window.getSelection){sel=window.getSelection().toString()}else if(document.selection&&document.selection.type!="Control"){sel=document.selection.createRange().text}
switch(keyCode){case 9:evt.preventDefault();document.execCommand('insertHTML',!1,'\u0009');break;case 85:if(evt.altKey&&sel.length){evt.preventDefault();document.execCommand('insertHTML',!1,sel.toUpperCase())}
break;case 76:if(evt.altKey&&sel.length){evt.preventDefault();document.execCommand('insertHTML',!1,sel.toLowerCase())}
break;case 72:if(evt.altKey){evt.preventDefault();let help='EDITOR COMMAND REFERENCE:\r\n\r\n';help+='Alt+u => uppercase selection\r\n';help+='Alt+l => lowercase selection\r\n';help+='Ctrl+b => bold selection\r\n';help+='Ctrl+i => italic selection\r\n';help+='Ctrl+u => underline selection\r\n';help+='Alt+c => clear all formatting';alert(help)}
break;case 67:if(evt.altKey){if(confirm('Clear all formatting?')){evt.preventDefault();this.textContent=this.innerText}}
break}}
editor.addEventListener("paste",function(e){e.preventDefault();let text=e.clipboardData.getData('text/plain');document.execCommand("insertHTML",!1,text)});editor.addEventListener("input",function(ie){this.saveto.innerHTML=this.innerText});editor.save=function(){this.saveto.innerHTML=this.innerText};editor.textContent=els[e].textContent;els[e].parentNode.insertBefore(editor,els[e].nextSibling)}},initWacssEdit:function(){let list=document.querySelectorAll('textarea.wacssedit');for(let i=0;i<list.length;i++){if(undefined==list[i].id){continue}
if(undefined!=list[i].dataset.initialized){continue}
list[i].setAttribute('data-initialized',1);let editor_id=list[i].id+'_wacsseditor';let eobj=wacss.getObject(editor_id);if(undefined!=eobj){continue}
let attrs=wacss.getAllAttributes(list[i]);let d=document.createElement('div');d.id=editor_id;list[i].setAttribute('data-editor',d.id);d.setAttribute('data-editor',list[i].id);for(k in attrs){if(k=='id'||k=='data-editor'){continue}
d.setAttribute(k,attrs[k])}
d.addEventListener('input',function(){let eid=this.dataset.editor;let tobj=wacss.getObject(eid);if(undefined==tobj){console.log('textarea update failed: no eid: '+eid);return!1}
tobj.innerHTML=this.innerHTML.replace(/</g,'&lt;').replace(/>/g,'&gt;')});d.setAttribute('contenteditable','true');d.innerHTML=list[i].value;list[i].original=list[i].value;list[i].style.display='none';let nav=document.createElement('nav');nav.className='nav w_white';if(undefined!=list[i].getAttribute('data-bar-color')){nav.className='nav '+list[i].getAttribute('data-bar-color')}
let ul=document.createElement('ul');let buttons={'Reset':['reset','','icon-reset','r'],'Bold':['bold','','icon-bold','b'],'Italic':['italic','','icon-italic','i'],'Underline':['underline','','icon-underline','u'],'Delete':['delete','','icon-delete',''],'Cut':['cut','','icon-scissors',''],'Copy':['copy','','icon-copy','c'],'Quote':['formatBlock','blockquote','icon-code','q'],'Heading':['heading','','',''],'Font':['fontName','','',''],'Size':['fontSize','','',''],'Color':['','','icon-color-adjust',''],'Media':['','','icon-image',''],'Justify':['justify','','',''],'Form':['form','','',''],'Unordered List':['insertUnorderedList','','icon-list-ul',''],'Ordered List':['insertOrderedList','','icon-list-ol',''],'Redo':['redo','','icon-redo','y'],'Undo':['undo','','icon-undo','z'],'Remove':['removeFormat','','icon-erase','-'],'Print':['print','','icon-print','p'],'Htmlcode':['code','','icon-file-code','h']}
let databar=new Array();if(undefined!=list[i].getAttribute('data-bar')){let barstr=list[i].getAttribute('data-bar');let btns=barstr.split(',');for(let db=0;db<btns.length;db++){databar.push(wacss.ucwords(btns[db]))}}
for(name in buttons){if(databar.length>0&&!wacss.in_array(name,databar)){continue}
let li=document.createElement('li');let parts;let a;let icon;switch(name.toLowerCase()){case 'media':a=document.createElement('button');a.className='wacssedit dropdown';a.title='Multimedia';a.li=li;a.onclick=function(){let list=wacss.getSiblings(this.li);for(let s=0;s<list.length;s++){wacss.removeClass(list[s],'open')}
wacss.toggleClass(this.li,'open');return!1};let micon=document.createElement('span');micon.className='icon-image';a.appendChild(micon);li.appendChild(a);let mediabox=document.createElement('div');let murl=document.createElement('input');murl.type='text';murl.name='url';murl.placeholder='URL to media';murl.setAttribute('value','');mediabox.appendChild(murl);let mfilebox=document.createElement('div');mfilebox.style.marginTop='10px';let mfile=document.createElement('input');mfile.type='file';mfile.accept='audio/*,video/*,image/*';mfile.id='mediafile';mfile.setAttribute('multiple','multiple');mfile.style.position='fixed';mfile.style.top='-1000px';mfile.filebox=mfilebox;mfile.onchange=function(evt){wacss.preventDefault(evt);wacss.wacsseditHandleFiles(this);return!1}
mediabox.appendChild(mfile);let mdrop=document.createElement('label');mdrop.filebox=mfilebox;mdrop.addEventListener('dragenter',function(evt){wacss.preventDefault(evt);this.style.border='1px dashed #28a745';this.style.color='#28a745';return!1},!1);mdrop.addEventListener('dragleave',function(evt){wacss.preventDefault(evt);this.style.border='1px dashed #ccc';this.style.color='#999999';return!1},!1);mdrop.addEventListener('dragover',function(evt){wacss.preventDefault(evt);return!1},!1);mdrop.addEventListener('drop',function(evt){wacss.preventDefault(evt);this.files=evt.dataTransfer.files;wacss.wacsseditHandleFiles(this);return!1},!1);mdrop.setAttribute('for','mediafile');mdrop.style.display='block';mdrop.style.border='1px dashed #ccc';mdrop.style.borderRadius='5px';mdrop.style.marginTop='10px';mdrop.style.color='#999999';mdrop.style.padding='15px';mdrop.innerHTML='Drag n Drop<br />(or click to browse)';mdrop.style.textAlign='center';mdrop.style.backgroundColor='#FFF';mediabox.appendChild(mdrop);mediabox.appendChild(mfilebox);let mmaxbox=document.createElement('div');mmaxbox.style.display='flex';mmaxbox.style.flexDirection='row';mmaxbox.style.marginTop='10px';let mwidth=document.createElement('input');mwidth.type='text';mwidth.name='width';mwidth.placeholder='Width';mwidth.title="Max Width - defaults to 200px";mwidth.style.flex='1 1 auto';mwidth.style.marginRight='5px';mwidth.pattern='[0-9px\%]+';mwidth.oninput=function(){this.reportValidity()};mmaxbox.appendChild(mwidth);let mheight=document.createElement('input');mheight.type='text';mheight.name='height';mheight.placeholder='Height';mheight.title='Max Height - defaults to 200px';mheight.style.flex='1 1 auto';mheight.style.marginLeft='5px';mheight.pattern='[0-9px\%]+';mheight.oninput=function(){this.reportValidity()};mmaxbox.appendChild(mheight);mediabox.appendChild(mmaxbox);let mabbox=document.createElement('div');mabbox.style.display='flex';mabbox.style.flexDirection='row';mabbox.style.marginTop='10px';let malign=document.createElement('select');malign.style.flex='1 1 auto';malign.title='Align';malign.name="align";malign.style.marginRight='5px';let malign_opts=new Array('left','center','right');for(let opt in malign_opts){let malign_opt=document.createElement('option');malign_opt.value=malign_opts[opt];malign_opt.innerText=malign_opts[opt];malign.appendChild(malign_opt)}
mabbox.appendChild(malign);let mborder=document.createElement('input');mborder.type='checkbox';mborder.name="border";mborder.style.flex='1 1 auto';mborder.title='Border';mborder.style.marginLeft='5px';mabbox.appendChild(mborder);mediabox.appendChild(mabbox);let msrbox=document.createElement('div');msrbox.style.display='flex';msrbox.style.flexDirection='row';msrbox.style.marginTop='10px';let mreset=document.createElement('button');mreset.style.flex='1 1 auto';mreset.title='Reset';mreset.type='button';mreset.innerText='Reset';mreset.className='btn w_red';mreset.elems=new Array(murl,mfilebox,mwidth,mheight,mborder);mreset.onclick=function(){for(let x in this.elems){switch(this.elems[x].tagName.toLowerCase()){case 'div':this.elems[x].innerHTML='';break;case 'input':switch(this.elems[x].type.toLowerCase()){case 'text':this.elems[x].value='';break;case 'checkbox':this.elems[x].checked=!1;break}
break}}}
mreset.style.marginRight='5px';msrbox.appendChild(mreset);let msave=document.createElement('button');msave.style.flex='1 1 auto';msave.title='Reset';msave.type='button';msave.innerText='Save';msave.className='btn w_green';msave.style.marginRight='5px';msave.mwidth=mwidth;msave.mheight=mheight;msave.malign=malign;msave.mborder=mborder;msave.murl=murl;msave.mfiles=mfilebox;msave.li=li;msave.elems=new Array(murl,mfilebox,mwidth,mheight,mborder);msave.onclick=function(){let width='300px';if(undefined!=this.mwidth.value&&this.mwidth.value.length){width=this.mwidth.value}
if(width.indexOf('px')==-1&&width.indexOf('%')==-1){width=width+'px'}
let height='200px';if(undefined!=this.mheight.value&&this.mheight.value.length){height=this.mheight.value}
if(height.indexOf('px')==-1&&height.indexOf('%')==-1){height=height+'px'}
let align=msave.malign.value;let style="max-width:"+width+";max-height:"+height+";";if(undefined!=this.mborder&&this.mborder.checked){style=style+'border:1px outset #000;'}
document.execCommand('removeFormat',!1);let list=this.mfiles.querySelectorAll('img');for(let y=0;y<list.length;y++){let htm='<div style="text-align:'+align+';"><img src="'+list[y].src+'" style="'+style+'" /></div>';document.execCommand("insertHTML",!1,htm)}
list=this.mfiles.querySelectorAll('audio');for(let y=0;y<list.length;y++){let htm='<div style="text-align:'+align+';"><audio src="'+list[y].src+'" style="'+style+'" controls="controls" /></div>';document.execCommand("insertHTML",!1,htm)}
list=this.mfiles.querySelectorAll('video');for(let y=0;y<list.length;y++){let htm='<div style="text-align:'+align+';"><video src="'+list[y].src+'" style="'+style+'" controls="controls" /></div>';document.execCommand("insertHTML",!1,htm)}
if(this.murl.value.length){let ext=this.murl.value.split('.').pop();let style='';let htm='';switch(ext.toLowerCase()){case 'png':case 'jpg':case 'jpeg':case 'gif':case 'svg':htm='<div style="text-align:'+align+';"><img src="'+this.murl.value+'" style="'+style+'" /></div>';document.execCommand("insertHTML",!1,htm);break;case 'mp3':htm='<div style="text-align:'+align+';"><audio src="'+this.murl.value+'" style="'+style+'" controls="controls" /></div>';document.execCommand("insertHTML",!1,htm);break;case 'mp4':htm='<div style="text-align:'+align+';"><video src="'+this.murl.value+'" style="'+style+'" controls="controls" /></div>';document.execCommand("insertHTML",!1,htm);break;default:if(this.murl.value.indexOf('youtube.com')!=-1){let src=this.murl.value.replace('watch?v=','embed/');htm='<div style="text-align:'+align+';"><iframe src="'+src+'" style="'+style+'" ></iframe></div>'}else{htm='<div style="text-align:'+align+';"><embed src="'+this.murl.value+'" style="'+style+'" controls="controls" ></embed></div>'}
document.execCommand("insertHTML",!1,htm);break}}
wacss.initWacssEditElements();for(let x in this.elems){switch(this.elems[x].tagName.toLowerCase()){case 'div':this.elems[x].innerHTML='';break;case 'input':switch(this.elems[x].type.toLowerCase()){case 'text':this.elems[x].value='';break;case 'checkbox':this.elems[x].checked=!1;break}
break}}
wacss.removeClass(this.li,'open');return!1};msrbox.appendChild(msave);mediabox.appendChild(msrbox);let mul=document.createElement('ul');mul.style.padding='10px';mul.appendChild(mediabox);li.appendChild(mul)
break;break;case 'color':a=document.createElement('button');a.className='wacssedit dropdown';a.title='Text Color';a.li=li;a.onclick=function(){let list=wacss.getSiblings(this.li);for(let s=0;s<list.length;s++){wacss.removeClass(list[s],'open')}
wacss.toggleClass(this.li,'open');return!1};let cicon=document.createElement('span');cicon.className='icon-textcolor';a.appendChild(cicon);li.appendChild(a);let colors={r1:['#000000','#444444','#666666','#999999','#cccccc','#eeeeee','#f3f3f3','#ffffff'],r2:['#ff0000','#ff9900','#ffff00','#00ff00','#00ffff','#0000ff','#9900ff','#ff00ff'],r3:['#f4cccc','#fce5cd','#fff2cc','#d9ead3','#d0e0e3','#cfe2f3','#d9d2e9','#ead1dc'],r4:['#ea9999','#f9cb9c','#ffe599','#b6d7a8','#a2c4c9','#9fc5e8','#b4a7d6','#d5a6bd'],r5:['#e06666','#ebaa66','#fad564','#8ab976','#729fa9','#6aa1d2','#8776b9','#bd789b'],r6:['#bc0000','#dc8b36','#e1b52f','#659f4b','#427b88','#3a7ebc','#5c4594','#9f4a74'],r7:['#8d0000','#a45705','#b88b00','#36721c','#124a57','#0b508f','#321a6e','#6e1a43'],r8:['#5f0000','#6f3a04','#775a00','#254b12','#0b313a','#07335c','#1e1149','#48102e']};let colorflexbox=document.createElement('div');colorflexbox.style.display='flex';let bgbox=document.createElement('div');bgbox.style.flex='1 1 0';bgbox.style.borderRight='10px solid transparent';let title=document.createElement('div');title.style.textAlign='left';title.style.color='#000000';title.innerText='Background Color';title.style.padding='5px 0 5px 0';bgbox.appendChild(title);let table=document.createElement('table');table.style.width='98%';table.style.borderCollapse='separate';table.style.borderSpacing='2px';for(let k in colors){let tr=document.createElement('tr');for(t=0;t<colors[k].length;t++){let td=document.createElement('td');td.style.padding='0px';let b=document.createElement('button');b.className='wacssedit';b.style.backgroundColor=colors[k][t];b.style.width='16px';b.style.height='16px';b.style.border='1px solid transparent';b.setAttribute('data-cmd','backColor');b.setAttribute('data-arg',colors[k][t]);b.setAttribute('title',colors[k][t]);b.setAttribute('data-txt',list[i].id);b.onmouseover=function(){this.style.border='1px solid #000'};b.onmouseout=function(){this.style.border='1px solid transparent'};td.appendChild(b);tr.appendChild(td)}
table.appendChild(tr)}
bgbox.appendChild(table);let tbox=document.createElement('div');tbox.style.flex='1 1 0';title=document.createElement('div');title.style.textAlign='left';title.style.color='#000000';title.innerText='Text Color';title.style.padding='5px 0 5px 0';tbox.appendChild(title);table=document.createElement('table');table.style.width='98%';table.style.borderCollapse='separate';table.style.borderSpacing='2px';for(let k in colors){let tr=document.createElement('tr');for(t=0;t<colors[k].length;t++){let td=document.createElement('td');td.style.padding='0px';let b=document.createElement('button');b.className='wacssedit';b.style.backgroundColor=colors[k][t];b.style.width='16px';b.style.height='16px';b.style.border='1px solid transparent';b.setAttribute('data-cmd','foreColor');b.setAttribute('data-arg',colors[k][t]);b.setAttribute('title',colors[k][t]);b.setAttribute('data-txt',list[i].id);b.onmouseover=function(){this.style.border='1px solid #000'};b.onmouseout=function(){this.style.border='1px solid transparent'};td.appendChild(b);tr.appendChild(td)}
table.appendChild(tr)}
tbox.appendChild(table);colorflexbox.appendChild(bgbox);colorflexbox.appendChild(tbox);let cul=document.createElement('ul');cul.style.padding='10px';cul.appendChild(colorflexbox);li.appendChild(cul)
break;break;case 'heading':a=document.createElement('button');a.className='wacssedit dropdown';a.title=name;a.li=li;a.onclick=function(){let list=wacss.getSiblings(this.li);for(let s=0;s<list.length;s++){wacss.removeClass(list[s],'open')}
wacss.toggleClass(this.li,'open');return!1};a.innerHTML=name;li.appendChild(a);let hul=document.createElement('ul');hul.style.maxHeight='175px';hul.style.overflow='auto';for(let h=1;h<7;h++){let hname='H'+h;let hli=document.createElement('li');hul.appendChild(hli);ha=document.createElement('button');ha.className='wacssedit';let hh=document.createElement(hname);hh.innerHTML=hname;ha.appendChild(hh);ha.setAttribute('data-cmd','formatBlock');ha.setAttribute('data-arg','H'+h);ha.setAttribute('data-txt',list[i].id);hli.appendChild(ha)}
li.appendChild(hul);break;case 'font':a=document.createElement('button');a.className='wacssedit dropdown';a.title=name;a.li=li;a.onclick=function(){let list=wacss.getSiblings(this.li);for(let s=0;s<list.length;s++){wacss.removeClass(list[s],'open')}
wacss.toggleClass(this.li,'open');return!1};a.innerHTML=name;li.appendChild(a);let fnul=document.createElement('ul');fnul.style.maxHeight='175px';fnul.style.overflow='auto';let fonts=new Array('Arial','Helvetica','Times New Roman','Times','Courier New','Courier','Verdana','Georgia','Palatino','Garamond','Bookman','Comic Sans MS','Trebuchet MS','Arial Black','Impact');for(let fn=0;fn<fonts.length;fn++){let fnli=document.createElement('li');fnul.appendChild(fnli);fna=document.createElement('button');fna.className='wacssedit';fna.setAttribute('data-cmd','fontName');fna.setAttribute('data-arg',fonts[fn]);fna.setAttribute('data-txt',list[i].id);fna.style.fontFamily=fonts[fn];fna.innerHTML=fonts[fn];fnli.appendChild(fna)}
li.appendChild(fnul);break;case 'size':a=document.createElement('button');a.className='wacssedit dropdown';a.title='Text Size';a.li=li;a.onclick=function(){let list=wacss.getSiblings(this.li);for(let s=0;s<list.length;s++){wacss.removeClass(list[s],'open')}
wacss.toggleClass(this.li,'open');return!1};let sicon=document.createElement('span');sicon.className='icon-textsize';a.appendChild(sicon);li.appendChild(a);let fsul=document.createElement('ul');fsul.style.maxHeight='175px';fsul.style.overflow='auto';for(let fs=1;fs<7;fs++){let fsname='Size '+fs;let fsli=document.createElement('li');fsul.appendChild(fsli);let fsa=document.createElement('button');fsa.className='wacssedit';let fsf=document.createElement('font');fsf.setAttribute('size',fs);fsf.innerHTML=fsname;fsa.appendChild(fsf);fsa.setAttribute('data-cmd','fontSize');fsa.setAttribute('data-arg',fs);fsa.setAttribute('data-txt',list[i].id);fsli.appendChild(fsa)}
li.appendChild(fsul);break;case 'justify':a=document.createElement('button');a.className='wacssedit dropdown';a.title=name;a.li=li;a.onclick=function(){let list=wacss.getSiblings(this.li);for(let s=0;s<list.length;s++){wacss.removeClass(list[s],'open')}
wacss.toggleClass(this.li,'open');return!1};a.innerHTML=name;li.appendChild(a);let jul=document.createElement('ul');jul.style.maxHeight='175px';jul.style.overflow='auto';let jopts=new Array('indent','outdent','full','left','center','right',);for(let j=0;j<jopts.length;j++){let jname=wacss.ucwords(jopts[j]);let jli=document.createElement('li');jul.appendChild(jli);ja=document.createElement('button');ja.className='wacssedit';ja.setAttribute('data-txt',list[i].id);let jicon=document.createElement('span');switch(jopts[j]){case 'indent':case 'outdent':ja.setAttribute('data-cmd',jopts[j]);jicon.className='icon-'+jopts[j];break;default:ja.setAttribute('data-cmd','justify'+jname);jicon.className='icon-justify-'+jopts[j];break}
ja.appendChild(jicon);let jtxt=document.createElement('span');jtxt.innerHTML=' '+jname;ja.appendChild(jtxt);jli.appendChild(ja)}
li.appendChild(jul);break;case 'form':a=document.createElement('button');a.className='wacssedit dropdown';a.title=name;a.li=li;a.onclick=function(){let list=wacss.getSiblings(this.li);for(let s=0;s<list.length;s++){wacss.removeClass(list[s],'open')}
wacss.toggleClass(this.li,'open');return!1};a.innerHTML=name;a.style.color='#3d7a7a';li.appendChild(a);let sul=document.createElement('ul');sul.style.maxHeight='325px';sul.style.overflow='auto';let types={date:'Date Picker <span class="icon-calendar"></span>',raten5:'Rating Number 1 - 5 <span class="icon-radio-button w_smaller"></span>',raten10:'Rating Number 1 - 10 <span class="icon-radio-button w_smaller"></span>',rates5:'Rating Stars 1 -5 <span class="icon-star-empty"></span>',rates10:'Rating Stars 1 -10 <span class="icon-star-empty"></span>',one:'Select One <span class="icon-checkbox"></span>',many:'Select Multiple <span class="icon-checkbox"></span> <span class="icon-checkbox"></span>',hideonview:'Hide On View <span class="icon-moon-quarter"></span>',section:'Section Marker <span class="icon-bookmark"></span>',signature:'Signature <span class="icon-signature"></span>',text:'Text One <span class="icon-text"></span>',textarea:'Text Multiple <span class="icon-textarea"></span>',customcode:'Insert Custom Code {}'};for(let type in types){let sli=document.createElement('li');sul.appendChild(sli);sna=document.createElement('button');sna.className='wacssedit';sna.style.color='#3d7a7a';sna.setAttribute('data-cmd','form');sna.setAttribute('data-arg',type);sna.setAttribute('data-txt',list[i].id);sna.innerHTML=types[type];sli.appendChild(sna)}
li.appendChild(sul);break;default:parts=buttons[name];a=document.createElement('button');a.className='wacssedit';a.title=name;a.onclick=function(){return!1};a.setAttribute('data-txt',list[i].id);if(parts[3].length){a.setAttribute('accesskey',parts[3]);a.title=a.title+' (ALT-'+parts[3]+')'}
a.setAttribute('data-cmd',parts[0]);if(parts[1].length){a.setAttribute('data-arg',parts[1])}
if(parts[2].length){icon=document.createElement('span');icon.className=parts[2];a.appendChild(icon)}
li.appendChild(a);break}
ul.appendChild(li)}
nav.appendChild(ul);list[i].parentNode.insertAdjacentElement('afterBegin',d);list[i].parentNode.insertAdjacentElement('afterBegin',nav)}
if(list.length){document.execCommand('styleWithCSS',!0,null)}
list=document.querySelectorAll('button.wacssedit');for(i=0;i<list.length;i++){let cmd=list[i].getAttribute('data-cmd');if(undefined==cmd){continue}
list[i].setAttribute('data-wacssedit-cmd',cmd);list[i].onclick=function(event){event.preventDefault();let cmd=this.getAttribute('data-cmd');let tid=this.getAttribute('data-txt');let tobj=wacss.getObject(tid);if(undefined==tobj){console.log('wacssedit code error: no tobj');return!1}
let dobj=getObject(tid+'_wacsseditor');if(undefined==dobj){console.log('wacssedit code error: no dobj');wacss.initWacssEditElements();return!1}
switch(cmd){case 'form':let arg=this.getAttribute('data-arg');document.execCommand('removeFormat',!1);document.execCommand("insertHTML",!1,"<span class='wacssform_"+arg+"'>"+document.getSelection()+'</span>');wacss.initWacssEditElements();return!1;break;case 'reset':if(confirm('Reset back to original?'+dobj.original)){dobj.innerHTML=tobj.original}
wacss.initWacssEditElements();return!1;break;case 'print':let oPrntWin=window.open("","_blank","width=450,height=470,left=400,top=100,menubar=yes,toolbar=no,location=no,scrollbars=yes");oPrntWin.document.open();oPrntWin.document.write("<!doctype html><html><head><title>Print<\/title><\/head><body onload=\"print();\">"+dobj.innerHTML+"<\/body><\/html>");oPrntWin.document.close();wacss.initWacssEditElements();return!1;break;case 'code':if(tobj.style.display=='none'){dobj.removeEventListener('input',function(){let eid=this.getAttribute('data-editor');let tobj=getObject(eid);if(undefined==tobj){console.log('textarea update failed: no eid: '+eid);wacss.initWacssEditElements();return!1}
tobj.innerHTML=this.innerHTML.replace(/</g,'&lt;').replace(/>/g,'&gt;')});dobj.style.display='none';tobj.style.display='block';tobj.focus();tobj.addEventListener('input',function(){let eid=this.getAttribute('data-editor');let tobj=wacss.getObject(eid);if(undefined==tobj){console.log('textarea update failed: no eid: '+eid);wacss.initWacssEditElements();return!1}
tobj.innerHTML=this.value})}else{tobj.removeEventListener('input',function(){let eid=this.getAttribute('data-editor');let tobj=getObject(eid);if(undefined==tobj){console.log('textarea update failed: no eid: '+eid);wacss.initWacssEditElements();return!1}
tobj.innerHTML=this.value});tobj.style.display='none';dobj.style.display='block';dobj.focus();dobj.addEventListener('input',function(){let eid=this.getAttribute('data-editor');let tobj=wacss.getObject(eid);if(undefined==tobj){console.log('textarea update failed: no eid: '+eid);wacss.initWacssEditElements();return!1}
tobj.value=this.innerHTML})}
wacss.initWacssEditElements();return!1;break;default:if(undefined==this.getAttribute('data-arg')){document.execCommand(cmd,!1,null)}else{let arg=this.getAttribute('data-arg');document.execCommand(cmd,!1,arg)}
tobj.innerHTML=dobj.innerHTML;wacss.initWacssEditElements();return!1;break}
wacss.initWacssEditElements()}}
wacss.initWacssEditElements()},initWacssEditElements:function(){let list=document.querySelectorAll('[contenteditable] .wacssform_one');for(let i=0;i<list.length;i++){let p=wacss.getParent(list[i],'div');if(undefined==p||undefined==p.nextSibling){continue}
let lis=p.nextSibling.querySelectorAll('ul li');for(let x=0;x<lis.length;x++){lis[x].className='wacssform_one'}}
list=document.querySelectorAll('[contenteditable] .wacssform_many');for(let i=0;i<list.length;i++){let p=wacss.getParent(list[i],'div');if(undefined==p||undefined==p.nextSibling){continue}
let lis=p.nextSibling.querySelectorAll('ul li');for(let x=0;x<lis.length;x++){lis[x].className='wacssform_many'}}},initSignaturePad:function(){let list=document.querySelectorAll('textarea[data-behavior="signature_pad"]');for(let i=0;i<list.length;i++){if(undefined==list[i].id){console.log("wacss.initSignaturePad Error - No ID");console.log(list[i]);continue}
if(undefined==list[i].name){console.log("wacss.initSignaturePad Error - No name");console.log(list[i]);continue}
if(undefined!=list[i].dataset.initialized){continue}
list[i].dataset.initialized=1;list[i].style.display='none';let wrapper=document.createElement('div');wrapper.style.width=list[i].style.width;wrapper.style.height=list[i].style.height;wrapper.style.display='block';wrapper.style.position='relative';wrapper.style.border='1px solid #ccc';wrapper.style.borderRadius='3px';wrapper.id=list[i].id+'_wrapper';wrapper.style.backgroundColor=list[i].dataset.fill||'#fff';list[i].parentNode.insertBefore(wrapper,list[i].nextSibling);wrapper.inline=document.createElement('input');wrapper.inline.type='hidden';wrapper.inline.name=list[i].name+'_inline';wrapper.inline.value=1;wrapper.appendChild(wrapper.inline);wrapper.canvas=document.createElement('canvas');wrapper.canvas.style.zIndex=5000;wrapper.canvas.style.position='absolute';wrapper.canvas.style.top='0px';wrapper.canvas.style.left='0px';wrapper.canvas.id=list[i].id+'_canvas';wrapper.canvas.width='500';wrapper.canvas.height='200';wrapper.appendChild(wrapper.canvas);wrapper.ro=new ResizeObserver(entries=>{for(let entry of entries){if(undefined!=entry.target.canvas&&undefined!=entry.target.clientWidth){entry.target.canvas.setAttribute('width',parseInt(entry.target.clientWidth));entry.target.canvas.setAttribute('height',parseInt(entry.target.clientHeight)-30)}}});wrapper.ro.observe(wrapper);wrapper.pad=new SignaturePad(wrapper.canvas);if(undefined==wrapper.pad){console.log("wacss.initSignaturePad Error - failed to create SignaturePad object");console.log(wrapper.canvas);continue}
if(list[i].innerHTML.length){wrapper.hide_undo=!0;wrapper.pad.fromDataURL(list[i].innerHTML,{ratio:1,width:wrapper.clientWidth,height:wrapper.clientHeight,xOffset:0,yOffset:0})}
wrapper.pad.txtarea=list[i];wrapper.pad.addEventListener('endStroke',function(){this.txtarea.innerText=this.toDataURL('image/png')});wrapper.toolbar=document.createElement('div');wrapper.toolbar.style.position='absolute';wrapper.toolbar.style.bottom='0px';wrapper.toolbar.style.left='0px';wrapper.toolbar.style.display='flex';wrapper.toolbar.style.justifyContent='flex-end';wrapper.toolbar.style.alignItems='center';wrapper.toolbar.style.width='100%';wrapper.toolbar.style.height='30px';wrapper.toolbar.style.borderTop='1px solid #ccc';wrapper.appendChild(wrapper.toolbar);params={style:'flex:1;color:#999;font-size:0.8rem;height:16px;',class:'input w_small'};wrapper.toolbar.txt=wacss.buildFormText('txt',params);wrapper.toolbar.txt.onkeyup=function(){return this.parentNode.parentNode.typeText()};wrapper.toolbar.txt.onfocus=function(){this.style.outline='none'}
wrapper.typeText=function(){let pad=this.pad;let txt=wacss.trim(this.toolbar.txt.value);if(txt.length==0){return!0}
pad.clear();let fontname=this.dataset.font;let ctx=pad._ctx;let w=pad.canvas.width;let h=pad.canvas.height;let px=parseInt(h/2)+5;pad.clear();pad.penColor=this.dataset.pencolor;ctx.font=px+'px '+fontname;ctx.textAlign='start';let x=15;let y=parseInt(h/2)+10;let m=w-20;ctx.fillText(txt,x,y,m);pad.txtarea.innerText=pad.toDataURL('image/png');return!0};wrapper.toolbar.txt.title="Signature";wrapper.toolbar.txt.style.borderColor='transparent';wrapper.toolbar.txt.style.borderRight='1px solid #ccc';wrapper.toolbar.appendChild(wrapper.toolbar.txt);wrapper.dataset.font=list[i].dataset.font||'andragogy';wrapper.dataset.font=wrapper.dataset.font.replace('_','');let fonts={'arial':'Arial','andragogy':'Andragogy','high_summit':'High Summit','julialauren':'Julia Lauren','katrineholland':'Katrine Holland','sandrabelhock':'Sandra Belhock','yasminerothem':'Yasmine Rothem',};Object.keys(fonts).forEach(function(fontname){let el=document.createElement('div');el.style.float='left';el.style.fontSize='1px';el.style.fontFamily=fontname;el.innerText='.';wrapper.toolbar.appendChild(el)});params={style:'border-color:transparent;color:#999;margin-left:2px;width:80px;font-size:0.8rem;padding:3px;',value:wrapper.dataset.font};wrapper.toolbar.font=wacss.buildFormSelect('font',fonts,params);wrapper.toolbar.font.onchange=function(){let fontname=this.options[this.selectedIndex].value;this.parentNode.parentNode.dataset.font=fontname;return this.parentNode.parentNode.typeText()};wrapper.toolbar.font.onfocus=function(){this.style.outline='none'}
wrapper.toolbar.font.title="Signature Font";wrapper.toolbar.font.style.borderColor='#ccc';wrapper.toolbar.appendChild(wrapper.toolbar.font);wrapper.dataset.pencolor=list[i].dataset.pencolor||list[i].dataset.color||'#000000';let pencolors={'#000000':'Black','#002B59':'Cyan Blue','#545AA7':'Purple','#EC1C24':'Verizon Red','#91A3B0':'Cadet Grey'};params={style:'background-color:#000;color:#fff;margin-left:2px;width:70px;font-size:0.8rem;padding:3px;',value:list[i].dataset.pencolor};wrapper.toolbar.pencolor=wacss.buildFormSelect('pencolor',pencolors,params);wrapper.toolbar.pencolor.onchange=function(){let pencolor=this.options[this.selectedIndex].value;this.parentNode.parentNode.pad.penColor=pencolor;this.parentNode.parentNode.dataset.pencolor=pencolor;this.style.borderColor=pencolor;this.style.backgroundColor=pencolor;return this.parentNode.parentNode.typeText()};wrapper.toolbar.pencolor.onfocus=function(){this.style.outline='none'}
wrapper.toolbar.pencolor.title="Pen Color";wrapper.toolbar.pencolor.style.borderColor='#000000';wrapper.toolbar.appendChild(wrapper.toolbar.pencolor);wrapper.toolbar.undo=document.createElement('span');wrapper.toolbar.undo.className='w_biggest w_pointer w_blue icon-undo';wrapper.toolbar.undo.title="Undo";wrapper.toolbar.undo.style.marginLeft='2px';wrapper.toolbar.undo.onclick=function(){let data=this.parentNode.parentNode.pad.toData();if(data){data.pop();this.parentNode.parentNode.pad.fromData(data)}
this.parentNode.parentNode.pad.penColor=this.parentNode.parentNode.dataset.pencolor}
if(undefined!=wrapper.hide_undo){wrapper.toolbar.undo.style.display='none'}
wrapper.toolbar.appendChild(wrapper.toolbar.undo);wrapper.toolbar.clear=document.createElement('span');wrapper.toolbar.clear.className='w_biggest w_pointer w_red icon-erase';wrapper.toolbar.clear.title='Clear';wrapper.toolbar.clear.style.marginLeft='2px';wrapper.toolbar.clear.onclick=function(){this.parentNode.txt.value='';this.parentNode.parentNode.pad.clear();this.parentNode.undo.style.display='inline-block';this.parentNode.parentNode.pad.penColor=this.parentNode.parentNode.dataset.pencolor}
wrapper.toolbar.appendChild(wrapper.toolbar.clear)}},initWhiteboard:function(){let list=document.querySelectorAll('textarea[data-behavior="whiteboard"]');for(let i=0;i<list.length;i++){if(undefined!=list[i].dataset.initialized){continue}
list[i].dataset.initialized+=1;list[i].style.display='none';let wrapper=document.createElement('div');wrapper.style.width=list[i].style.width;wrapper.style.height=list[i].style.height;wrapper.style.display='block';wrapper.style.position='relative';wrapper.style.boxShadow='rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px';wrapper.id='whiteboard_wrapper_1';wrapper.style.backgroundColor=list[i].dataset.fill||'#fff';wrapper.shapesBottom=new Array();wrapper.shapesTop=new Array();wrapper.shape={};wrapper.drawShapesBottom=function(){this.bottom_canvas.ctx.clearRect(0,0,this.bottom_canvas.width,this.bottom_canvas.height);this.txtarea.innerText='';let dshapes=this.shapesBottom;let simg=undefined;for(let i=0;i<dshapes.length;i++){let shape=dshapes[i];if(undefined==shape){continue}
if(undefined==shape.shape){continue}
switch(shape.shape){case 'image':simg=new Image();simg.bottom_canvas=this.bottom_canvas;simg.txtarea=this.txtarea;simg.crossOrigin='anonymous';simg.src=shape.src;break;case 'circle':this.bottom_canvas.ctx.beginPath();this.bottom_canvas.ctx.arc(shape.x,shape.y,shape.radius,0,Math.PI*2);if(shape.fillcolor.length){this.bottom_canvas.ctx.fillStyle=shape.fillcolor;this.bottom_canvas.ctx.lineWidth=shape.size;this.bottom_canvas.ctx.fill()}else{this.bottom_canvas.ctx.lineWidth=shape.size;this.bottom_canvas.ctx.strokeStyle=shape.pencolor;this.bottom_canvas.ctx.stroke()}
break;case 'rectangle':if(shape.fillcolor.length){this.bottom_canvas.ctx.fillStyle=shape.fillcolor;this.bottom_canvas.ctx.lineWidth=shape.size;this.bottom_canvas.ctx.fillRect(shape.x,shape.y,shape.width,shape.height)}else{this.bottom_canvas.ctx.strokeStyle=shape.pencolor;this.bottom_canvas.ctx.lineWidth=shape.size;this.bottom_canvas.ctx.strokeRect(shape.x,shape.y,shape.width,shape.height)}
break;case 'line':this.bottom_canvas.ctx.beginPath();this.bottom_canvas.ctx.moveTo(shape.x,shape.y);this.bottom_canvas.ctx.strokeStyle=shape.pencolor;this.bottom_canvas.ctx.lineTo(shape.x2,shape.y2);this.bottom_canvas.ctx.lineWidth=shape.size;this.bottom_canvas.ctx.stroke();this.bottom_canvas.ctx.closePath();break;default:this.bottom_canvas.ctx.beginPath();this.bottom_canvas.ctx.moveTo(shape.x,shape.y);this.bottom_canvas.ctx.strokeStyle=shape.pencolor;this.bottom_canvas.ctx.lineWidth=shape.size;this.bottom_canvas.ctx.lineTo(shape.x2,shape.y2);this.bottom_canvas.ctx.stroke();this.bottom_canvas.ctx.closePath();break}}
dshapes=[];if(typeof this.bottom_canvas.toDataURL==='function'){if(simg){simg.onload=function(){this.bottom_canvas.ctx.drawImage(this,0,0);this.txtarea.innerText=this.bottom_canvas.toDataURL('image/png')}}else{this.txtarea.innerText=this.bottom_canvas.toDataURL('image/png')}}else{}}
wrapper.drawShapesTop=function(){let dshapes=new Array();dshapes.push(this.shape);let simg=undefined;for(let i=0;i<dshapes.length;i++){let shape=dshapes[i];if(undefined==shape){continue}
if(undefined==shape.shape){continue}
switch(shape.shape){case 'image':simg=new Image();simg.top_canvas=this.top_canvas;simg.txtarea=this.txtarea;simg.crossOrigin='anonymous';simg.src=shape.src;break;case 'circle':this.top_canvas.ctx.beginPath();this.top_canvas.ctx.arc(shape.x,shape.y,shape.radius,0,Math.PI*2);if(shape.fillcolor.length){this.top_canvas.ctx.fillStyle=shape.fillcolor;this.top_canvas.ctx.lineWidth=shape.size;this.top_canvas.ctx.fill()}else{this.top_canvas.ctx.lineWidth=shape.size;this.top_canvas.ctx.strokeStyle=shape.pencolor;this.top_canvas.ctx.stroke()}
break;case 'rectangle':if(shape.fillcolor.length){this.top_canvas.ctx.fillStyle=shape.fillcolor;this.top_canvas.ctx.lineWidth=shape.size;this.top_canvas.ctx.fillRect(shape.x,shape.y,shape.width,shape.height)}else{this.top_canvas.ctx.strokeStyle=shape.pencolor;this.top_canvas.ctx.lineWidth=shape.size;this.top_canvas.ctx.strokeRect(shape.x,shape.y,shape.width,shape.height)}
break;case 'line':this.top_canvas.ctx.beginPath();this.top_canvas.ctx.moveTo(shape.x,shape.y);this.top_canvas.ctx.strokeStyle=shape.pencolor;this.top_canvas.ctx.lineTo(shape.x2,shape.y2);this.top_canvas.ctx.lineWidth=shape.size;this.top_canvas.ctx.stroke();this.top_canvas.ctx.closePath();break;default:this.top_canvas.ctx.beginPath();this.top_canvas.ctx.moveTo(shape.x,shape.y);this.top_canvas.ctx.strokeStyle=shape.pencolor;this.top_canvas.ctx.lineTo(shape.x2,shape.y2);this.top_canvas.ctx.lineWidth=shape.size;this.top_canvas.ctx.stroke();this.top_canvas.ctx.closePath();break}}
dshapes=[];if(typeof this.top_canvas.toDataURL==='function'){if(simg){simg.onload=function(){this.top_canvastop_canvas.ctx.drawImage(this,0,0);this.txtarea.innerText=this.top_canvas.toDataURL('image/png')}}else{this.txtarea.innerText=this.top_canvas.toDataURL('image/png')}}else{}}
list[i].parentNode.insertBefore(wrapper,list[i].nextSibling);wrapper.bottom_canvas=document.createElement('canvas');wrapper.bottom_canvas.style.zIndex=5000;wrapper.top_canvas=document.createElement('canvas');wrapper.top_canvas.style.zIndex=6000;let params={};let toolbar=document.createElement('div');toolbar.style='position:absolute;bottom:0px;left:0px;display:flex;justify-content:flex-end;align-items:center;width:100%;background:#f0f0f0;height:34px;box-shadow: rgba(17, 17, 26, 0.05) 0px 1px 0px, rgba(17, 17, 26, 0.1) 0px 0px 8px;';wrapper.dataset.shape='pencil';let shapes={'pencil':'Pencil','line':'Line','circle':'Circle','rectangle':'Rectangle',};params={style:'margin-left:10px;width:100px;padding:3px;'}
toolbar.shape=wacss.buildFormSelect('shape',shapes,params);toolbar.shape.onchange=function(){let shape=this.options[this.selectedIndex].value;this.parentNode.parentNode.dataset.shape=shape};toolbar.shape.title="Shape";toolbar.appendChild(toolbar.shape);wrapper.dataset.size='1';let sizes={'1':'1px','3':'3px','5':'5px','7':'7px','9':'9px','11':'11px','13':'13px','15':'15px','17':'17px','19':'19px'};params={style:'margin-left:10px;width:100px;padding:3px;'}
toolbar.size=wacss.buildFormSelect('size',sizes,params);toolbar.size.onchange=function(){let size=this.options[this.selectedIndex].value;this.parentNode.parentNode.dataset.size=size};toolbar.size.title="Pen Size";toolbar.appendChild(toolbar.size);wrapper.dataset.pencolor='#000';let pencolors={'#000':'Black','#213a9a':'Blue','#05abff':'Light Blue','#05a04d':'Green','#66d81f':'Light Green','#ff0081':'Pink','#f16115':'Orange','#f43940':'Red','#fee213':'Yellow'};params={style:'margin-left:10px;width:100px;padding:3px;'}
toolbar.pencolor=wacss.buildFormSelect('pencolor',pencolors,params);toolbar.pencolor.onchange=function(){let pencolor=this.options[this.selectedIndex].value;this.parentNode.parentNode.dataset.pencolor=pencolor};toolbar.pencolor.title="Pen Color";toolbar.appendChild(toolbar.pencolor);let fillcolors={'':'None','#000':'Black','#213a9a':'Blue','#05abff':'Light Blue','#05a04d':'Green','#66d81f':'Light Green','#ff0081':'Pink','#f16115':'Orange','#f43940':'Red','#fee213':'Yellow'};wrapper.dataset.fillcolor='';params={style:'margin-left:10px;width:100px;padding:3px;'}
toolbar.fillcolor=wacss.buildFormSelect('fillcolor',fillcolors,params);toolbar.fillcolor.onchange=function(){let fillcolor=this.options[this.selectedIndex].value;this.parentNode.parentNode.dataset.fillcolor=fillcolor};toolbar.fillcolor.title="Fill Color";toolbar.appendChild(toolbar.fillcolor);toolbar.clear=document.createElement('span');toolbar.clear.className='icon-erase w_pointer';toolbar.clear.setAttribute('style','margin-left:10px;margin-right:10px;');toolbar.clear.title='Erase Whiteboard';toolbar.appendChild(toolbar.clear);toolbar.clear.onclick=function(e){if(!confirm('Erase Whiteboard?')){return!1}
this.parentNode.parentNode.bottom_canvas.ctx.clearRect(0,0,this.parentNode.bottom_canvas.width,this.parentNode.bottom_canvas.height);this.parentNode.parentNode.txtarea.innerText='';this.parentNode.parentNode.shapes=new Array()};wrapper.txtarea=list[i];wrapper.ro=new ResizeObserver(entries=>{for(let entry of entries){if(undefined!=entry.target.bottom_canvas&&undefined!=entry.target.clientWidth){entry.target.bottom_canvas.setAttribute('width',entry.target.clientWidth);entry.target.bottom_canvas.setAttribute('height',parseInt(entry.target.clientHeight)-30);entry.target.top_canvas.setAttribute('width',entry.target.clientWidth);entry.target.top_canvas.setAttribute('height',parseInt(entry.target.clientHeight)-30)}}});wrapper.ro.observe(wrapper);wrapper.bottom_canvas.style.position='absolute';wrapper.top_canvas.style.position='absolute';wrapper.top_canvas.style.cursor='crosshair';wrapper.bottom_canvas.ctx=wrapper.bottom_canvas.getContext("2d");wrapper.top_canvas.ctx=wrapper.top_canvas.getContext("2d");if(list[i].innerHTML.length){let wshape={shape:'image',src:list[i].innerHTML}
wrapper.shapesBottom.push(wshape);wrapper.drawShapesBottom()}
wrapper.isDown=!1;wrapper.top_canvas.onmousedown=function(e){e=e||window.event;let rect=e.target.getBoundingClientRect();this.x=parseInt(e.pageX-rect.left);this.y=parseInt(e.pageY-rect.top);this.parentNode.isDown=!0;switch(this.parentNode.dataset.shape){default:this.parentNode.shape={shape:'pencil',x:this.x,y:this.y,pencolor:this.parentNode.dataset.pencolor,size:this.parentNode.dataset.size};break;case 'line':this.parentNode.shape={shape:'line',x:this.x,y:this.y,pencolor:this.parentNode.dataset.pencolor,size:this.parentNode.dataset.size};break;case 'circle':this.parentNode.shape={shape:'circle',x:this.x,y:this.y,pencolor:this.parentNode.dataset.pencolor,size:this.parentNode.dataset.size};if(this.parentNode.dataset.fillcolor.length){this.parentNode.shape.fillcolor=this.parentNode.dataset.fillcolor}else{this.parentNode.shape.fillcolor=''}
break;case 'rectangle':this.parentNode.shape={shape:'rectangle',x:this.x,y:this.y,pencolor:this.parentNode.dataset.pencolor,size:this.parentNode.dataset.size};if(this.parentNode.dataset.fillcolor.length){this.parentNode.shape.fillcolor=this.parentNode.dataset.fillcolor}else{this.parentNode.shape.fillcolor=''}
break}};wrapper.top_canvas.onmousemove=function(e){e=e||window.event;if(this.parentNode.isDown!==!1){let rect=e.target.getBoundingClientRect();let x=parseInt(e.pageX-rect.left);let y=parseInt(e.pageY-rect.top);switch(this.parentNode.dataset.shape){default:this.parentNode.shape.x2=x;this.parentNode.shape.y2=y;this.parentNode.shapesTop.push(this.parentNode.shape);this.parentNode.shape={shape:'pencil',x:x,y:y,pencolor:this.parentNode.dataset.pencolor};break;case 'line':this.parentNode.shape.x2=x;this.parentNode.shape.y2=y;break;case 'circle':let r1=Math.abs(x-this.parentNode.shape.x);let r2=Math.abs(y-this.parentNode.shape.y);if(r1>r2){this.parentNode.shape.radius=r1}else{this.parentNode.shape.radius=r2}
break;case 'rectangle':this.parentNode.shape.width=Math.abs(x-this.parentNode.shape.x);this.parentNode.shape.height=Math.abs(y-this.parentNode.shape.y);break}
this.parentNode.drawShapesTop()}};wrapper.top_canvas.onmouseup=function(e){e=e||window.event;this.parentNode.isDown=!1;switch(this.parentNode.dataset.shape){default:this.parentNode.shapesTop.push(this.shape);break;case 'line':break;case 'circle':this.parentNode.shapesTop.push(this.shape);break;case 'rectangle':this.parentNode.shapesTop.push(this.shape);break}
this.parentNode.drawShapesTop()};wrapper.top_canvas.onmouseout=function(e){e=e||window.event;this.parentNode.isDown=!1;switch(this.parentNode.dataset.shape){default:break;case 'line':break;case 'circle':break;case 'rectangle':break}}
document.body.addEventListener('touchmove',function(e){e=e||window.event;e.preventDefault()},!1);wrapper.appendChild(wrapper.bottom_canvas);wrapper.appendChild(wrapper.top_canvas);wrapper.appendChild(toolbar)}},isNum:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},listen:function(evnt,elem,func){if(elem.addEventListener){elem.addEventListener(evnt,func,!1)}else if(elem.attachEvent){let r=elem.attachEvent("on"+evnt,func);return r}else{console.log('wacss.listen failed. Browser does not support event listeners')}},loadCSS:function(file,notify){let link=document.createElement('link');if(undefined!=notify&&notify==1){link.onload=function(){wacss.toast(this.getAttribute('href')+' loaded successfully')}}
link.setAttribute("rel","stylesheet");link.setAttribute("type","text/css");link.setAttribute("href",file);document.head.appendChild(link);return!0},loadJs:function(file,notify){return wacss.loadScript(file,notify)},loadScript:function(file,notify){let script=document.createElement('script');if(undefined!=notify&&notify==1){script.onload=function(){wacss.toast(this.src+' loaded successfully')}}
script.src=file;document.head.appendChild(script);return!0},modalClose:function(){if(undefined!=document.getElementById('wacss_modal_overlay')){return wacss.removeObj(document.getElementById('wacss_modal_overlay'))}else if(undefined!=document.getElementById('wacss_modal')){return wacss.removeObj(document.getElementById('wacss_modal'))}},modalTitle:function(title){if(undefined!=document.getElementById('wacss_modal')){let m=document.getElementById('wacss_modal');let mt=m.querySelector('.wacss_modal_title_text');if(undefined!=mt){mt.innerHTML=title}
centerObject(m);return m}},modalPopupId:function(id,title,params){let htm='';if(undefined!=document.querySelector(id)){htm=document.querySelector(id).innerHTML}else if(undefined!=document.querySelector('#'+id)){htm=document.querySelector('#'+id).innerHTML}
return wacss.modalPopup(htm,title,params)},modalPopup:function(htm,title,params){if(undefined==params){params={}}
if(undefined==title){title=''}
if(undefined!=document.getElementById('wacss_modal')){let m=document.getElementById('wacss_modal');let mel=m.querySelector('.wacss_modal_content');if(undefined!=mel){mel.innerHTML=htm}
if(title.length>0){let mt=m.querySelector('.wacss_modal_title_text');if(undefined!=mt){mt.innerHTML=title}}
centerObject(m);return m}
if(undefined==params.color){params.color=wacss.color()}
let modal=document.createElement('div');modal.id='wacss_modal';let modal_close=document.createElement('span');modal.className='wacss_modal';if(undefined!=title&&title.length>0){let modal_title=document.createElement('div');modal_title.className='wacss_modal_title '+params.color;modal_close.className='wacss_modal_close icon-close';modal_close.title="Close";modal_close.onclick=function(){wacss.removeObj(this.pnode)}
modal_title.appendChild(modal_close);let modal_title_text=document.createElement('div');modal_title_text.className='wacss_modal_title_text';modal_title_text.innerHTML=title;modal_title.appendChild(modal_title_text);modal.appendChild(modal_title)}
let modal_content=document.createElement('div');modal_content.className='wacss_modal_content';modal_content.innerHTML=htm;modal.appendChild(modal_content);if(undefined!=params.overlay){let modal_overlay=document.createElement('div');modal_overlay.id='wacss_modal_overlay';modal_overlay.className='wacss_modal_overlay '+params.color;modal_overlay.appendChild(modal);modal_close.pnode=modal_overlay;if(undefined!=params.overlay_close){modal_overlay.onclick=function(){let elements=document.querySelectorAll(':hover');let i=elements.length-1;if(this==elements[i]){wacss.removeObj(this)}}}else{modal_overlay.onclick=function(){let elements=document.querySelectorAll(':hover');let i=elements.length-1;if(this==elements[i]){wacss.blink('wacss_modal')}}}
document.body.appendChild(modal_overlay)}else{modal_close.pnode=modal;document.body.appendChild(modal)}
centerObject(modal);return modal},navMobileToggle:function(el){let navs=document.querySelectorAll('.nav');for(let n=0;n<navs.length;n++){let lis=navs[n].querySelectorAll('li');for(let l=0;l<lis.length;l++){if(lis[l]==el){if(navs[n].className.indexOf('leftmenu')!=-1){wacss.removeClass(navs[n],'leftmenu')}else{wacss.addClass(navs[n],'leftmenu')}}}}
return!1},preventDefault:function(evt){evt=evt||window.event;if(evt.preventDefault){evt.preventDefault()}
if(evt.stopPropagation){evt.stopPropagation()}
if(evt.cancelBubble!==null){evt.cancelBubble=!0}},removeClass:function(element,classToRemove){element=wacss.getObject(element);if(undefined==element.className){return}
let currentClassValue=element.className;if(currentClassValue.indexOf(" "+classToRemove)!=-1){element.className=element.className.replace(" "+classToRemove,"");return}
if(currentClassValue.indexOf(classToRemove+" ")!=-1){element.className=element.className.replace(classToRemove+" ","");return}
if(currentClassValue.indexOf(classToRemove)!=-1){element.className=element.className.replace(classToRemove,"");return}},removeObj:function(obj){if(undefined==obj){return!1}
try{obj.remove();if(undefined==obj){return!0}}catch(e){}
try{if(undefined!=obj.parentNode){obj.parentNode.removeChild(obj);if(undefined==obj){return!0}}}catch(e){}
try{document.body.removeChild(obj);if(undefined==obj){return!0}}catch(e){}
try{document.getElementsByTagName('BODY')[0].removeChild(obj);if(undefined==obj){return!0}}catch(e){}
try{obj.parentNode.removeChild(obj);if(undefined==obj){return!0}}catch(e){}
return!1},scrollToBottom:function(el){el=wacss.getObject(el);if(undefined==el){return!1}
if(undefined==el.scrollHeight){return!1}
if(undefined!=el.clientHeight){el.scrollTop=el.scrollHeight-el.clientHeight}else{el.scrollTop=el.scrollHeight}
return!1},setActiveTab:function(el){let p=wacss.getParent(el,'ul','nav-tabs');if(p===null){return!1}
let list=p.querySelectorAll('li');for(let i=0;i<list.length;i++){wacss.removeClass(list[i],'active')}
if(el.nodeName.toLowerCase()=='li'){wacss.addClass(el,'active')}else{let li=wacss.getParent(el,'li');let lip=wacss.getParent(li,'ul');if(!lip.classList.contains('nav-tabs')){wacss.addClass(li,'active');li=wacss.getParent(lip,'li')}
wacss.addClass(li,'active')}
return!1},showImage:function(el,z){el=wacss.getObject(el);if(undefined==el){return!1}
z=z||10020;let d=document.createElement('div');d.id="modal1";d.tabindex=0;d.style.zIndex=z;d.style.display='block';d.style.background='#FFF';d.style.padding='15px';d.style.border='1px outset #747392';d.style.borderRadius='3px';d.style.position='absolute';d.style.maxWidth='60%';d.style.maxHeight='800px';d.style.transform='scaleX(1) scaleY(1)';let i=document.createElement('img');i.src=el.getAttribute('src');i.style.maxWidth='100%';i.style.maxHeight='770px';i.d=d;i.onload=function(){centerObject(this.d)}
d.appendChild(i)
document.body.appendChild(d);z=z-2;let v=document.createElement('div');v.style.zIndex=z;v.style.display='block';v.style.width='3000px';v.style.height='2000px';v.style.position='absolute';v.style.top='0px';v.style.left='0px';v.style.background='rgba(0,0,0,0.5)';v.id=d.id+'_overlay';v.setAttribute('data-target',d.id);v.onclick=function(){removeDiv(this.getAttribute('data-target'));removeDiv(this.id)};document.body.appendChild(v)},simulateEvent:function(element,eventName){element=getObject(element);if(undefined==element){return!1}
let evObj=document.createEvent('Event');evObj.initEvent(eventName,!0,!1);element.dispatchEvent(evObj);return!0},speak:function(txt,params){if(undefined==params){params={}}
params.txt=txt;if('speechSynthesis' in window){window.speechSynthesis.cancel();let voices=window.speechSynthesis.getVoices();if(undefined!=params.debug){console.log(voices)}
if(voices.length>0){let msg=new SpeechSynthesisUtterance();if(undefined!=params.name){for(let i=0;i<voices.length;i++){if(voices[i].name.toLowerCase().indexOf(params.name.toLowerCase())!=-1){msg.voice=voices[i];break}}}
if(undefined!=params.lang){msg.lang=params.lang}
if(undefined!=params.volume){msg.volume=params.volume}
if(undefined!=params.rate){msg.rate=params.rate}
if(undefined!=params.pitch){msg.pitch=params.pitch}
msg.text=params.txt;if(undefined!=params.debug){console.log(msg)}
window.speechSynthesis.speak(msg);return!1}else{window.speechSynthesis.params=params;window.speechSynthesis.onvoiceschanged=function(){let params=window.speechSynthesis.params;wacss.speak(params.txt,params)}}}else{console.log('wacss.speak error: speechSynthesis is not supported in your browser or OS')}
return!1},str_replace:function(search,replace,str){let f=search;let r=replace;let s=str;let ra=r instanceof Array;let sa=s instanceof Array;f=[].concat(f);r=[].concat(r);let i=(s=[].concat(s)).length;while(j=0,i--){if(s[i]){while(s[i]=s[i].split(f[j]).join(ra?r[j]||"":r[0]),++j in f){}}};return sa?s:s[0]},strtolower:function(str){return(str+'').toLowerCase()},strtoupper:function(str){return(str+'').toUpperCase()},toast:function(msg,params){if(undefined==params){params={color:'w_red',timer:3}}
if(undefined==params.color){params.color=wacss.color()}
if(undefined==params.timer){params.timer=3000}else{params.timer=parseInt(params.timer)*1000}
if(undefined==document.getElementById('wacss_toasts')){let ts=document.createElement('div');ts.id='wacss_toasts';document.body.appendChild(ts)}
let t=document.createElement('div');t.className='toast '+params.color;t.setAttribute('role','alert');t.innerHTML=msg;t.style.position='relative';t.timer=params.timer;let c=document.createElement('span');c.className='icon-close';c.pnode=t;c.title='Close';c.onclick=function(){wacss.removeObj(this.pnode)};t.appendChild(c);document.getElementById('wacss_toasts').appendChild(t);setTimeout(function(){wacss.dismiss(t)},params.timer)},toggleClass:function(id,class1,class2,myid,myclass1,myclass2){let obj=wacss.getObject(id);if(undefined==obj){return}
if(obj.className.indexOf(class1)!=-1){wacss.removeClass(obj,class1);wacss.addClass(obj,class2)}else if(obj.className.indexOf(class2)!=-1){wacss.removeClass(obj,class2);wacss.addClass(obj,class1)}else{wacss.addClass(obj,class1)}
if(undefined!=myid){obj=wacss.getObject(myid);if(undefined==obj){return}
if(obj.className.indexOf(myclass1)!=-1){wacss.removeClass(obj,myclass1);wacss.addClass(obj,myclass2)}else if(obj.className.indexOf(myclass2)!=-1){wacss.removeClass(obj,myclass2);wacss.addClass(obj,myclass1)}else{wacss.addClass(obj,myclass1)}}},trim:function(str){if(null!=str&&undefined!=str&&""!=str){let rval=str.replace(/^[\ \s\0\r\n\t]*/g,"");rval=rval.replace(/[\ \s\0\r\n\t]*$/g,"");return rval}else{return""}},ucfirst:function(str){let f=str.charAt(0).toUpperCase();return f+str.substr(1)},ucwords:function(str){str=str.toLowerCase().replace(/\b[a-z]/g,function(letter){return letter.toUpperCase()});return str},urlEncode:function(str){str=str+'';str=str.replace(/\//g,"%2F");str=str.replace(/\?/g,"%3F");str=str.replace(/\</g,"%3C");str=str.replace(/\>/g,"%3E");str=str.replace(/\"/g,"%22");str=str.replace(/=/g,"%3D");str=str.replace(/&/g,"%26");str=str.replace(/\#/g,"%23");return str},wacsseditHandleFiles(el){for(let f=0;f<el.files.length;f++){let reader=new FileReader();reader.filebox=el.filebox;reader.filename=el.files[f].name;reader.filesize=el.files[f].size;reader.filetype=el.files[f].type;reader.onload=function(){if(this.filetype.toLowerCase().indexOf('image')==0){let dataURL=this.result;let img=document.createElement('img');img.src=dataURL;img.style.width='32px';img.style.height='32px';img.style.margin='5px';img.title=this.filename;this.filebox.appendChild(img)}else if(this.filetype.toLowerCase().indexOf('audio')==0){let dataURL=this.result;let aud=document.createElement('audio');aud.src=dataURL;aud.controls=!0;aud.title=this.filename;aud.style.maxHeight='100px';aud.style.maxWidth='150px';this.filebox.appendChild(aud)}else if(this.filetype.toLowerCase().indexOf('video')==0){let dataURL=this.result;let vid=document.createElement('video');vid.src=dataURL;vid.controls=!0;vid.title=this.filename;vid.style.maxHeight='100px';vid.style.maxWidth='150px';this.filebox.appendChild(vid)}};reader.readAsDataURL(el.files[f])}}}
wacss.listen('load',window,function(){wacss.init()})