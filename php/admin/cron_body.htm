<view:default>
	<h2 style="margin:0px;padding:6px;" class="<?=configValue('admin_color');?>"><span class="icon-cron"></span> <translate>Cron Manager</translate></h2>
	<div id="cron_results" class="w_padtop">
		<?=renderView('list');?>
	</div>
</view:default>

<view:list>
	<a href="#" onclick="return ajaxGet('/php/admin.php','modal',{_menu:'cron',func:'add',title:this.title});" title="<translate>Add New Cron</translate>" class="w_right btn <?=configValue('admin_color');?>"><span class="icon-plus"></span> <translate>Add New</translate></a>
	<?=cronList();?>
	<?=buildOnLoad("wacss.modalClose();");?>
</view:list>

<view:addedit>
	<?=cronAddEdit($id);?>
</view:addedit>

<view:add_fields>
<div class="row">
	<div class="col s6 m5"><label class="w_red"><translate>Cron Name</translate></label>[name]</div>
	<div class="col s6 m1"><label><translate>Active</translate></label>[active]</div>
	<div class="col s6 m3"><label><translate>Begin Date</translate></label>[begin_date]</div>
	<div class="col s6 m3"><label><translate>End Date</translate></label>[end_date]</div>
</div>
<div class="row">
	<div class="col s12 m4"><label><translate>Quick Pick Frequency</translate></label>[frequency]</div>
	<div class="col s12 m1"><br />OR</div>
	<div class="col s12 m7"><label><translate>Custom Frequency</translate></label>[run_format]</div>
</div>
<div class="row">
	<div class="col s12 m8"><label class="w_red"><translate>Run Cmd: (command, page name, or url)</translate></label>[run_cmd]</div>
	<div class="col s12 m4"><label><translate>Run As</translate></label>[run_as]</div>
</div>
</view:add_fields>

<view:edit_fields>
<div class="row">
	<div class="col s12 m6"><label class="w_red"><translate>Cron Name</translate></label>[name]</div>
	<div class="col s12 m6"><label><translate>Groupname</translate></label>[groupname]</div>
</div>
<div class="row">
	<div class="col s6 m1"><label><translate>Paused</translate></label>[paused]</div>
	<div class="col s6 m1"><label><translate>Active</translate></label>[active]</div>
	<div class="col s6 m3"><label><translate>Records To Keep</translate></label>[records_to_keep]</div>
	<div class="col s6 m3"><label><translate>Begin Date</translate></label>[begin_date]</div>
	<div class="col s6 m3"><label><translate>End Date</translate></label>[end_date]</div>
</div>
<div class="row">
	<div class="col s12 m4"><label><translate>Quick Pick Frequency</translate></label>[frequency]</div>
	<div class="col s12 m1"><br />OR</div>
	<div class="col s12 m7"><label><translate>Custom Frequency</translate></label>[run_format]</div>
</div>
<div class="row">
	<div class="col s12"><label class="w_red"><translate>Run Cmd: (command, page name, or url)</translate></label>[run_cmd]</div>
</div>
<div class="row">
	<div class="col s6 m5"><label><translate>Run As</translate></label>[run_as]</div>
	<div class="col s6 m1"><label class="w_gray"><translate>Running</translate></label>[running]</div>
	<div class="col s6 m3"><label class="w_gray"><translate>Last Run Date</translate></label>[run_date]</div>
	<div class="col s6 m3"><label class="w_gray"><translate>Last Run Length</translate></label>[run_length]</div>
</div>
<div class="row">
	<div class="col s12"><label class="w_gray"><translate>Last Run Result</translate></label>[run_result]</div>
</div>
</view:edit_fields>


<view:details>
<div class="row">
	<div class="col s12">
		<table class="table condensed striped bordered <?=configValue('admin_color');?>">
			<tr>
				<th><translate>ID</translate></th>
				<th><translate>Group</translate></th>
				<th><translate>Name</translate></th>
				<th><translate>Paused</translate></th>
				<th><translate>Records To Keep</translate></th>
				<th><translate>Cmd</translate></th>
				<th><translate>Frequency</translate></th>
			</tr>
			<tr>
				<td class="w_small">
					<?=$cron['_id'];?>
					<a href="#" class="w_right w_link w_block" onclick="return ajaxGet('/php/admin.php','modal',{_menu:'cron',func:'edit',id:<?=$cron['_id'];?>,title:this.title});" title="Edit Cron"><span class="icon-edit"></span></a>
				</td>
				<td class="w_small"><?=$cron['groupname'];?></td>
				<td class="w_small"><?=$cron['name'];?></td>
				<td class="w_small"><?=$cron['paused'];?></td>
				<td class="w_small"><?=$cron['records_to_keep'];?></td>
				<td class="w_small"><?=$cron['run_cmd'];?></td>
				<td class="w_small"><?=$cron['run_format'];?></td>
			</tr>
		</table>
	</div>
</div>
<div class="row">
	<div class="col s4">
		<div style="max-height:400px;overflow:auto;padding-right:20px;">
		<table class="table condensed striped bordered <?=configValue('admin_color');?> hover">
		<tr>
			<th><translate>Run Date</translate></th>
			<th><translate>Run Length</translate></th>
		</tr>
		<view:log>
		<tr class="w_pointer" onclick="return ajaxGet('/php/admin.php','cron_result',{_menu:'cron',func:'cron_result',setprocessing:'setprocessing',id:<?=$log['_id'];?>,title:this.title});">
			<td class="w_nowrap"><?=$log['run_date'];?></td>
			<td class=""><?=verboseTime($log['run_length']);?></td>
		</tr>
		</view:log>
		<?=renderEach('log',$cron['logs'],'log');?>
		</table>
		</div>
	</div>
	<div class="col s8"><div id="cron_result" style="width:560px;">
		<?=renderView('cron_result',$cron,'log');?>
	</div></div>
</div>
</view:details>

<view:cron_result>
<div id="setprocessing" style="float:right;position:absolute;top:70px;right:20px;"></div>
<textarea style="border:0px;width:100%;height:400px;font-size:0.9rem;color:#000000CC" wrap="off">
<?=$log['run_result'];?>
</textarea>
</view:cron_result>